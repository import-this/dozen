!function(e,t,n,o){"use strict";function i(){}function r(e){return t.getElementById(e)}function a(e,t){return e.querySelector(t)}function s(e){return t.querySelectorAll(e)}function c(e){return t.querySelector(e)}function u(e,t){var n=Date.now()-t;return function(){var o=Date.now();o-n<t||(n=o,e())}}function l(e){var t,n,o;for(t=e.length-1;t>0;--t)n=Math.floor(Math.random()*(t+1)),o=e[t],e[t]=e[n],e[n]=o}function f(e){return e>0&&0==(e&e-1)}function d(e,t,n){return new Array(e).fill(null).map(function(e){return new Array(t).fill(n)})}function h(e,t,n,o){return e&&e.length&&t===e.length&&n===e[0].length?e.forEach(function(e){e.fill(o)}):e=d(t,n,o),e}function g(e,t){for(var n=0,o=e.length;n<o;++n)t[n]=e[n];t.length=e.length}function p(e,t){var n,o,i,r,a,s;for(n=0,i=e.length;n<i;++n)for(a=e[n],s=t[n],o=0,r=a.length;o<r;++o)s[o]=a[o]}function v(){function t(e,t){var n={};return n.slidesPerView=e,n.breakpoints={},t.forEach(function(e){n.breakpoints[e[0]]={slidesPerView:e[1]}}),n}var o=r("carousel-modes");if(o.classList.contains("initialized"))o.classList.contains("resize")&&(r("carousel-modes").swiper.update(),r("carousel-controls").swiper.update(),r("carousel-speeds").swiper.update(),o.classList.remove("resize"));else{o.classList.add("initialized"),e.MutationObserver||e.addEventListener("resize",debounce(function(){o.classList.add("resize")}));var i={grabCursor:!0,roundLengths:!0,watchOverflow:!0,longSwipesRatio:.25,resistanceRatio:.8,slideToClickedSlide:!0,observer:!0,observeParents:!0,setWrapperSize:!0,runCallbacksOnInit:!1,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}};new Swiper("#carousel-modes",n.extend(i,t(3,[[500,1],[820,2]]))),new Swiper("#carousel-controls",n.extend(i,t(3,[[550,1],[800,2]]))),new Swiper("#carousel-speeds",n.extend(i,t(4,[[600,1],[1280,2],[1920,3]])))}}function m(e,t){return"c-"+e+"-"+t}function T(e){var t=e.getBoundingClientRect(),n=e.offsetParent.getBoundingClientRect();return{top:t.top-n.top,left:t.left-n.left}}function S(e){return e.getBoundingClientRect().width}function w(e){return e.getBoundingClientRect().height}function b(e,t){var n=H.get(e,t);return n||(n=T(r(m(e,t))),H.set(e,t,n),n)}function E(e){return"translate("+e.left+"px,"+e.top+"px)"}function y(e){return Math.round(Math.log2(e))}function O(e){return e>0&&e%12==0}function L(e){for(var t=0,n=e.length;t<n;++t)if(e[t]!==e[0])return!1;return!0}function z(e){return e.every(O)&&L(e)}function N(e,t,n){e.style[_]=E(b(t,n))}function M(e,t){t.style[_]=e.style[_]}function x(e){return e>=4&&f(e)?4:e>=12?12*Math.pow(2,y(e/12)%3):e}function I(e,t){return e[0].classList.add("t"+x(t)),t>=100&&e[0].classList.add("large"),e.find(".n").text(t),e}function A(e,t,n){if(n){if(t===n)return;e.children().filter(".t"+t).removeClass("dead").end().filter(".t"+n).addClass("dead")}else e.children().addClass("dead").filter(".t"+t).removeClass("dead")}function C(e){function t(t,n){var o,i,r,a=n.length;for(o=t.length===a*(e.size.cols-2)?e.size.cols-1:e.size.cols-2,t.length=a*o,i=0;i<a;++i)for(r=0;r<o;++r)t[i*o+r]=n[i];l(t)}function n(e){return r.i===r.bag.length&&(t(r.bag,e),r.i=0),r.bag[r.i++]}function o(){switch(e.mode){case k.EVIL:i=J.EVIL;break;case k.FILTHY:i=J.FILTHY;break;case k.DIRTY:i=J.DIRTY;break;default:case k.CLEAN:i=J.CLEAN}}var i,r={bag:[],i:0},a={init:function(){o(),r.bag=new Array(i.length*(e.size.cols-2)),t(r.bag,i),r.i=Math.floor(3*Math.random())},getNext:function(){return n(i)}};return Object.defineProperty(a,"state",{get:function(){return r},set:function(e){r=e,o()}})}var R=function(){Function.prototype.apply.call(console.info,console,arguments)},P=function(){Function.prototype.apply.call(console.warn,console,arguments)};void 0===String.prototype.startsWith&&(P('Undefined "String.prototype.startsWith". Using incomplete polyfill...'),String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),Math.trunc||(P('Undefined "Math.trunc". Using polyfill.'),Math.trunc=function(e){return e>0?Math.floor(e):Math.ceil(e)}),Math.log2||(P('Undefined "Math.log2". Polyfill returns imprecise values on some inputs!'),Math.log2=function(e){return Math.log(e)*Math.LOG2E}),Array.prototype.fill||(P('Undefined "Array.prototype.fill". Using bad polyfill!'),Object.defineProperty(Array.prototype,"fill",{value:function(e){for(var t=0;t<this.length;++t)this[t]=e;return this}})),e.NodeList&&!NodeList.prototype.forEach&&(P('Undefined "NodeList.prototype.forEach". Using Array.prototype.forEach.'),NodeList.prototype.forEach=Array.prototype.forEach);var k=Object.freeze({CLEAN:0,DIRTY:1,FILTHY:2,EVIL:3}),D=Object.freeze({CLASSIC:0,SLOW:1,PRACTICE:2,FAST:3}),G=Object.freeze({VSHORT:0,SHORT:1,NORMAL:2,LONG:3,VLONG:4}),Y=function(t){function n(e,n){t.setItem(e,n)}function o(e){return t.getItem(e)}function i(e,t){return e+"_"+t.mode+"_"+t.speed+"_"+t.size.rows+"x"+t.size.cols}t=t||e.localStorage;var r="dozen_",a=Object.freeze({VERSION:r+"version",SETTINGS:r+"settings",GRID:r+"grid",TILES:r+"tiles",STATS:r+"stats",RNG:r+"rng",APP_STATE:r+"app_state",TIMES_PLAYED:r+"times_played",HAS_RATED:r+"has_rated"}),s=Object.freeze({VERSION:r+"0",SETTINGS:r+"1",GRID:r+"2",TILES:r+"3",PREV:r+"4",STATS:r+"5",RNG:r+"6",APP_STATE:r+"7",TIMES_PLAYED:r+"8",HAS_RATED:r+"9"});return function(){function e(){var e,n,o,i={};for(e=0,n=t.length;e<n;++e)(o=t.key(e)).startsWith(r)&&(i[o]=t.getItem(o));return i}function i(){var n=e();Object.keys(n).forEach(function(e){var o,i={};e.startsWith(a.STATS)?(o=JSON.parse(n[e]),i.level=o.level,i.lines=i.score={curr:o.score,best:o.best,prev:o.prevBest,isNew:o.isNewBest},n[e]=JSON.stringify(i)):e.startsWith(a.RNG)?((o=JSON.parse(n[e])).i=o.index,delete o.index,n[e]=JSON.stringify(o)):e.startsWith(a.SETTINGS)&&((o=JSON.parse(n[e])).controls=o.altControls||0,delete o.altControls,n[e]=JSON.stringify(o)),Object.keys(a).some(function(o){var i,r;return!!e.startsWith(a[o])&&(r=e.replace(a[o],s[o]),i=n[e],delete n[e],n[r]=i,t.setItem(r,i),t.removeItem(e),!0)})})}var c=+o(s.VERSION);1!==c&&(0===c&&null===o(a.SETTINGS)||function(e){switch(c){case 0:i()}}(),n(s.VERSION,1))}(),{saveGrid:function(e,t){n(i(s.GRID,e),JSON.stringify(t))},loadGrid:function(e){return JSON.parse(o(i(s.GRID,e)))},saveTiles:function(e,t){n(i(s.TILES,e),JSON.stringify(t))},loadTiles:function(e){return JSON.parse(o(i(s.TILES,e)))},saveRngState:function(e,t){n(i(s.RNG,e),JSON.stringify(t))},loadRngState:function(e){return JSON.parse(o(i(s.RNG,e)))},saveStats:function(e,t){n(i(s.STATS,e),JSON.stringify(t))},loadStats:function(e){return JSON.parse(o(i(s.STATS,e)))},savePrev:function(e,t){n(i(s.PREV,e),JSON.stringify(t))},loadPrev:function(e){return JSON.parse(o(i(s.PREV,e)))},hasSavedGame:function(e){return null!==o(i(s.TILES,e))},saveAppState:function(e){n(s.APP_STATE,JSON.stringify(e))},loadAppState:function(){return JSON.parse(o(s.APP_STATE))},clearAppState:function(){t.removeItem(s.APP_STATE)},saveSettings:function(e){n(s.SETTINGS,JSON.stringify(e))},loadSettings:function(){return JSON.parse(o(s.SETTINGS))},loadTimesPlayed:function(e){return+o(s.TIMES_PLAYED+"_"+e.mode)},loadTotalTimesPlayed:function(){return Object.keys(k).reduce(function(e,t){return e+ +o(s.TIMES_PLAYED+"_"+k[t])},0)},incTimesPlayed:function(e){n(s.TIMES_PLAYED+"_"+e.mode,this.loadTimesPlayed(e)+1)}}}();!function(){function e(e,t){e.filter(".selected").removeClass("selected"),e.filter('[data-option="'+t+'"]').addClass("selected")}var t=Y.loadSettings();null!==t&&(e(n("#sensitivities .item"),t.sensitivity),e(n("#sizes .item"),t.size),e(n("#speeds .item"),t.speed))}(),R("Dozen - Version:","1.4.0"),R("Welcome! Hope you enjoy! :)\n\n");var j=isAndroidStockBrowser?"tap":"tap click",_=function(e){var n=t.createElement("div").style,o="ms Moz Webkit".split(" "),i=o.length,r=e[0].toUpperCase()+e.slice(1);if(e in n)return e;for(;i--;)if((e=o[i]+r)in n)return e}("transform"),H=(function(){var e=t.createElement("div").style,n=["Moz","webkit"],o=n.length;if("perspective"in e)return!0;for(;o--;)if(n[o]+"Perspective"in e)return!0}(),function(){var e=[];return{invalidate:function(t,n){e=h(e,t,n,null)},get:function(t,n){return e[t][n]},set:function(t,n,o){e[t][n]=o}}}()),V=1e3/60,W=960,J={CLEAN:[1,2,3,6],DIRTY:[1,2,3,6],FILTHY:[1,2,3,6],EVIL:[1,2,3,4,6]},U=10;o.easings.ease=o.bezier(.25,.1,.25,1);var X={PULSE:{scale:[{value:.86,duration:79.25},{value:1.16,duration:158.5},{value:1,duration:79.25}],easing:"ease",duration:317},CLEAR:{scale:[{value:1.23,duration:125},{value:0,duration:375}],rotate:[{value:720,duration:375,delay:125}],easing:"linear",duration:500}},F=function(){function e(e,n,o,i,r){return t.targets=e,t.translateX=[n.left,o.left],t.translateY=[n.top,o.top],t.duration=i,t.complete=r,t}var t={targets:null,translateX:0,translateY:0,duration:0,complete:null,easing:"linear"};return function(t,n,i,r,a,s){o(e(t,b(n,r),b(i,r),a,s))}}(),B=function(){function e(e,n,o,i,r){return t.targets=e,t.translateX=[n.left,o.left],t.translateY=[n.top,o.top],t.offset=i,t.complete=r,t}var t={targets:null,translateX:0,translateY:0,offset:0,complete:null};return function(t,n,o,i,r,a,s){t.add(e(n,b(o,r),b(i,r),a,s))}}(),q=function(){var e={targets:null,translateX:0,translateY:0,scale:X.PULSE.scale,easing:X.PULSE.easing,duration:X.PULSE.duration};return function(t,n,o,i){var r=b(o,i),a=r.left,s=r.top;e.targets=n,e.translateX=[a,a],e.translateY=[s,s],t.add(e)}}(),Q=function(e){function t(t,n){r=t,i.targets=r,i.duration=n/2,o=e(i)}function n(){o.pause(),o=null,r.style.opacity="",r=null}var o,i={targets:null,opacity:[1,.5],duration:500,easing:"linear",direction:"alternate",loop:!0},r=null;return{add:function(e,o){r&&n(),t(e,o)},remove:function(){r&&n()}}}(o),Z=function(e,t,n){function o(e){return"n"+e}function i(e){return".n"+e}function r(e){e.classList.remove("dead")}function s(e){e.classList.add("dead")}function c(s){var c,u=a(e[0],i(s)+".dead");return u?(r(u),u):(c=(s<=6?n:t).clone().removeAttr("id"),I(c.removeClass("base-tile"),s).addClass(o(s)).appendTo(e)[0])}var u=[];return{init:function(e,t){u=h(u,e,t,null)},newTile:function(e){return c(e)},newTileAt:function(e,t,n){return u[e][t]=c(n)},add:function(e,t,n){u[t][n]=e},get:function(e,t){return u[e][t]},update:function(e,t,n,o){u[n][o]=u[e][t]},show:r,hide:s,hideAt:function(e,t){s(u[e][t])},hideAll:function(){e.children().addClass("dead")}}}(n("#tile-container"),n("#base-tile"),n("#base-tile-hl"));!function(e,t,n,o,l){function f(){(nt={level:0,lines:0,score:0,tile:1,next:1,grid:[],rng:null}).grid=h(nt.grid,tt.size.rows,tt.size.cols,0),nt.rng=n.extend(!0,{},ot.state),d()}function d(){nt.level=et.level,nt.lines=et.lines.curr,nt.score=et.score.curr,nt.tile=ct,nt.next=ut,p(rt,nt.grid),g(ot.state.bag,nt.rng.bag),nt.rng.i=ot.state.i}function m(){pt||(Y.saveStats(tt,et),Y.saveGrid(tt,rt),Y.saveTiles(tt,{tile:ct,next:ut,row:at,col:st}),Y.saveRngState(tt,ot.state),Y.savePrev(tt,nt))}function E(e,t){e in ft||(ft[e]=t,Y.saveSettings(ft))}function y(){"0"in this?this[0].classList.add("dead"):this.classList.add("dead")}function O(e){e.animate("rise",1500,"ease",y)}function L(e){}function x(e){var t;et.lines.curr+=e,Ze.text(et.lines.curr),O(n("#line-mod").text("+"+e).removeClass("dead")),et.lines.best<et.lines.curr&&(et.lines.best=et.lines.curr,et.lines.isNew&&(L(n("#new-line-score").removeClass("dead")),et.lines.isNew=!1)),et.lines.curr>=(et.level+1)*U&&(t=Math.floor(et.lines.curr/U),Qe.text(t),O(n("#level-mod").text("+"+(t-et.level)).removeClass("dead")),et.level=t)}function I(e,t,n){switch(e){default:case D.CLASSIC:return t-et.level*n;case D.FAST:return t-9*n;case D.SLOW:return t-3*n;case D.PRACTICE:return W}}function R(){var e=tt.size.rows-1,t=6*W/e,n=Math.round(333/e);return Math.max(I(tt.speed,t,(t-n)/13),n)}function _(e,t){return 0===rt[e][t]}function J(e,t){switch(tt.mode){case k.CLEAN:return e+t===3||e===t&&e>=3;case k.DIRTY:return e+t===3||e===t&&2!==e;case k.FILTHY:case k.EVIL:return e+t===3||e===t;default:throw new Error("Invalid mode!")}}function K(){var e=rt.length-1,t=Math.floor(rt[0].length/2),n=rt[e][t];return 0===n||J(n,ut)}function $(){N(it,at,st)}function ee(){pt=!1,gt=setTimeout(ze,R()),lt()}function te(){clearTimeout(gt)}function ne(){if(!K())return Nt.goTo(Nt.Transition,"End"),void m();at=rt.length-1,st=Math.floor(rt[0].length/2),ct=ut,ut=ot.getNext(),A($e,ut,ct),it=Z.newTile(ct),Q.add(it,R()),$(),ht.add(),_(at,st)?ee():fe()}function oe(){d(),rt[at][st]=ct,Z.add(it,at,st)}function ie(){oe(),ne()}function re(){var e,t,n=rt.length-1,o=rt[0].length;for(vt=[],t=0;t<o;++t)for(e=0;e<n&&!_(e+1,t);++e)if(J(rt[e][t],rt[e+1][t])){vt.push({row:e,col:t});break}return vt.length>0?(Tt(),!0):(Et(),!1)}function ae(e,t){var n=rt[e];rt[e]=rt[t],rt[t]=n}function se(){for(var e=St[St.length-1]+1,t=St[0],n=rt.length;e<n;)ae(t++,e++);re()}function ce(){var e=0,t=[];St.forEach(function(n){for(var o=0,i=rt[0].length;o<i;++o)Z.hideAt(n,o);e+=rt[n][0]/12,t.push(rt[n][0]),rt[n].fill(0)}),x(e),dt(t,tt.size.cols),wt()}function ue(){ht.remove(),Q.remove(),Z.hide(it),Z.hideAt(at,st),rt[at][st]+=ct,dt(rt[at][st]),yt(at,st,re)}function le(){$(),ee()}function fe(){pt=!0,d(),ue()}function de(){ht.remove(),at=Ot}function he(){de(),ie()}function ge(){de(),ue()}function pe(e,t){F(it,at,Ot,st,e,t)}function ve(e){pe(e,he)}function me(e){it.style.zIndex="1",Z.get(Ot,st).style.zIndex="0",pe(e,ge)}function Te(){var e;if(!pt)if(pt=!0,te(),d(),Q.remove(),0!==at&&(_(at-1,st)||J(ct,rt[at-1][st]))){for(e=at-1;e>=0&&_(e,st);--e);e<0||!J(ct,rt[e][st])?ve(V*(at-(Ot=e+1))):me(V*(at-(Ot=e)))}else ie()}function Se(e,t,n){at=e,st=t,n()}function we(e,t){return _(e,t)?(Se(e,t,$),!0):!!J(ct,rt[e][t])&&(Se(e,t,fe),te(),!1)}function be(e,t,n){do{if(!we(at+e,st+t))break}while(--n>0);return pt}function Ee(e){return 0!==st&&be(0,-1,Math.min(e,st))}function ye(e){return st!==rt[0].length-1&&be(0,1,Math.min(e,rt[0].length-1-st))}function Oe(e){return 0!==at&&be(-1,0,Math.min(e,at))}function Le(){if(!pt&&Mt===Nt.Playing){if(0!==at)return _(at-1,st)?(--at,void le()):J(ct,rt[at-1][st])?(--at,void fe()):void ie();ie()}}function ze(){tt.speed!==D.PRACTICE&&l(Le)}function Ne(e,t,n){function o(e,t){e.preventDefault(),t()}function i(){if(!pt&&Mt===Nt.Playing)for(var e=0,t=A.length;e<t;++e)switch(A[e]){case I.LEFT:if(Ee(C[e]))return;break;case I.RIGHT:if(ye(C[e]))return;break;case I.DOWN:if(Oe(C[e]))return;break;case I.DROP:return void Te()}}function a(e,t){pt||Mt!==Nt.Playing||A.length>9||(A.push(e),C.push(t||1),R())}function s(e,t){e.preventDefault(),a(t,1)}function u(e){switch(e.which){case 37:case 65:s(e,I.LEFT);break;case 39:case 68:s(e,I.RIGHT);break;case 40:case 83:s(e,I.DOWN);break;case 38:case 87:case 32:s(e,I.DROP)}}function l(e,t,n){return e+Math.trunc((t-e)/n)*n}function f(e,t,n,o){var i,r;return(i=Math.abs(e-P))>n?(r=Math.floor(i/n),e<P?a(I.LEFT,r):a(I.RIGHT,r),void(P=l(P,e,n))):(i=t-k)>o?(a(I.DOWN,Math.floor(i/o)),void(k=l(k,t,o))):void 0}function d(){var t=!1;e("#game-container").on({mousedown:function(e){0===e.button&&(e.preventDefault(),t=!0,P=e.clientX,k=e.clientY)},mousemove:function(e){t&&(e.preventDefault(),f(e.clientX,e.clientY,z,N))},mouseup:function(e){0===e.button&&(e.preventDefault(),t=!1)},mouseout:function(e){e.target===this&&(t=!1)},dblclick:function(e){0===e.button&&(e.preventDefault(),a(I.DROP))}})}function h(e){return e.clientY>5/8*O?I.DOWN:e.clientX<=y/2?I.LEFT:I.RIGHT}function g(){a(V,1),H=setTimeout(g,33.333)}function p(){e("#game-container").on({touchstart:function(e){var t=e.changedTouches[0];e.preventDefault(),e.touches.length>1||(P=Math.round(t.clientX),k=Math.round(t.clientY))},touchmove:function(e){var t=e.changedTouches[0];e.preventDefault(),e.touches.length>1||f(Math.round(t.clientX),Math.round(t.clientY),M,x)},"touchend touchcancel":function(e){e.preventDefault()},doubleTap:function(){a(I.DROP)}})}function v(){e("#game-container").on({touchstart:function(e){e.preventDefault(),e.touches.length>1||(V=h(e.changedTouches[0]),H=setTimeout(g,350),_.start(e.changedTouches[0]))},touchmove:function(e){var t=h(e.changedTouches[0]);e.preventDefault(),e.touches.length>1||(_.handleMove(e.changedTouches[0])?clearTimeout(H):t!==V&&(clearTimeout(H),V=t,g()))},touchend:function(e){e.preventDefault(),e.touches.length>0||(_.handleSwipe(e.changedTouches[0])===_.DOWN?a(I.DROP):a(V,1),clearTimeout(H),V=-1)},touchcancel:function(e){e.touches.length>0||(clearTimeout(H),V=-1)}})}function m(e){e?v():p()}function b(){e("#game-container").off("touchstart touchmove touchend touchcancel doubleTap")}function E(e){b(),m(e)}var y,O,L=debounce(function(){y=t.innerWidth,O=t.innerHeight});L(),t.addEventListener("resize",L),n.addEventListener("keydown",function(e){switch(e.which){case 80:o(e,Fe);break;case 78:o(e,Be);break;case 8:o(e,Xe)}});var z,N,M,x,I=Object.freeze({LEFT:0,RIGHT:1,DOWN:2,DROP:3}),A=[],C=[],R=debounce(function(){i(),A.length=C.length=0}),P=0,k=0,D=debounce(function(){var e,t=r("c-0-0"),n=T(t);ft.sensitivity,e=function(){switch(ft.sensitivity){case G.VSHORT:return.6;case G.SHORT:return.8;default:case G.NORMAL:return 1;case G.LONG:return 1.2;case G.VLONG:return 1.4}}(),z=Math.round(Math.abs(T(r("c-0-1")).left-n.left)*e),N=Math.round(Math.abs(T(r("c-1-0")).top-n.top)*e),e=function(){switch(ft.sensitivity){case G.VSHORT:return.5;case G.SHORT:return.75;default:case G.NORMAL:return.95;case G.LONG:return 1.1;case G.VLONG:return 1.2}}(),M=Math.round(S(t)*e),x=Math.round(w(t)*e)}),Y=debounce(D),_=function(){function e(){switch(ft.sensitivity){case G.VSHORT:return 20;case G.SHORT:return 30;default:case G.NORMAL:return 40;case G.LONG:return 60;case G.VLONG:return 80}}var t=0,n=0,o=0,i=0,r=0,a={LEFT:0,RIGHT:1,UP:2,DOWN:3,durationThreshold:550,start:function(e){t=Date.now(),n=Math.round(e.clientX),o=Math.round(e.clientY)},handleMove:function(i){var r,s,c=e();return r=Math.abs(i.clientX-n),s=Math.abs(i.clientY-o),Date.now()-t<a.durationThreshold&&(r>c&&s<c||s>c&&r<c)},handleSwipe:function(s){var c,u,l=e();if(i=s.clientX-n,r=s.clientY-o,c=Math.abs(i),u=Math.abs(r),Date.now()-t<a.durationThreshold){if(c>l&&u<l)return i<0?a.LEFT:a.RIGHT;if(u>l&&c<l)return r<0?a.UP:a.DOWN}}};return a}(),H=-1,V=-1;return{add:function(){D(),t.addEventListener("resize",D),e("#sensitivity").on(j,Y),n.addEventListener("keydown",u),d(),qe.on("contextmenu",!1),m(ft.controls),e("#controls").on("change","input",function(){E(parseInt(c("#controls input:checked").value,10))})},remove:function(){t.removeEventListener("resize",D),e("#sensitivity").off(j,Y),n.removeEventListener("keydown",u),e("#game-container").off(),qe.off("contextmenu"),e("#controls").off("change")}}}function Me(e){function t(e,t){e.style.width=t+"px"}var n,o,i,a=e[0];a.style.width="",n=e.find(".r0").children(":not(.hide)").get().map(S),o=Math.max.apply(null,n),(i=n.reduce(function(e,t){return e+(o-t)},0))>0&&t(a,S(a)+i),t(r("tile-container"),S(a))}function xe(e){function t(e,t,n){var o,i="",r=t-1;for(o=e-1;o<r;++o)i+=n+o+",";return i+n+o}e.find(t(5,tt.size.rows,".r")).removeClass("hide"),e.find(t(5,tt.size.cols,".c")).removeClass("hide"),e.find(t(tt.size.rows+1,11,".r")).addClass("hide"),e.find(t(tt.size.cols+1,9,".c")).addClass("hide"),Me(e)}function Ie(){var e=S(r("c-0-0"))+"px";s(".t").forEach(function(t){t.style.width=t.style.height=e})}function Ae(){rt.forEach(function(e,t){e.forEach(function(e,n){0!==e&&N(Z.newTileAt(t,n,e),t,n)})}),it&&N(it,at,st)}function Ce(){rt.forEach(function(e,t){e.forEach(function(e,n){0!==e&&N(Z.get(t,n),t,n)})}),it&&N(it,at,st)}function Re(){Z.hideAll(),ht.remove()}function Pe(){xe(n("#grid")),n("#grid, #tile-container").addClass("col"+tt.size.cols),n("#speed-container .speed").addClass("hide").filter('[data-option="'+tt.speed+'"]').removeClass("hide"),n("#mode-container .mode").addClass("hide").filter('[data-option="'+tt.mode+'"]').removeClass("hide"),Ie(),H.invalidate(tt.size.rows,tt.size.cols),Z.init(tt.size.rows,tt.size.cols)}function ke(){Qe.text(et.level),Ze.text(et.lines.curr),Ke.text(et.score.curr),A($e,ut)}function De(e){(e=e||!1)?et=Y.loadStats(tt):(et.lines.best=0,et.score.best=0),et.level=0,et.lines.curr=0,et.lines.isNew=!0,et.lines.prev=et.lines.best,et.score.curr=0,et.score.isNew=!0,et.score.prev=et.score.best,rt=h(rt,tt.size.rows,tt.size.cols,0),ot.init(),ut=ot.getNext(),f(),0===Y.loadTimesPlayed(tt)?Nt.goTo(Nt.Tutorial):Nt.goTo(Nt.Start,W/2)}function Ge(){var e=Y.loadTiles(tt);rt=Y.loadGrid(tt),et=Y.loadStats(tt),nt=Y.loadPrev(tt),ct=e.tile,ut=e.next,at=e.row,st=e.col,ot.state=Y.loadRngState(tt),it=Z.newTile(ct),Z.hide(it),l(function(){Z.show(it),Ae(),ht.add()}),nt||f(),K()?Nt.goTo(Nt.Loading):Nt.goTo(Nt.End,!0)}function Ye(){Pe(),Y.hasSavedGame(tt)?Ge():De(),l(ke),Lt.add()}function je(){Re(),De(!0),l(ke)}function _e(){Lt.remove(),Mt.stop(),Re()}function He(){Mt.pause()}function Ve(){Mt.resume()}function We(e,t){xt.exit(),(xt=e).enter(t)}function Je(e){r(e).style.display="block"}function Ue(e){r(e).style.display="none"}function Xe(){xt.goToMenu()}function Fe(){xt===Pt?xt.goToOptions():xt===kt&&xt.goToGame()}function Be(){xt!==Pt&&xt!==kt||(xt===kt&&xt.goToGame(),Mt.newGame())}var qe=n("#game"),Qe=n("#level"),Ze=n("#lines"),Ke=n("#score"),$e=n("#next"),et={level:0,lines:{curr:0,best:0,prev:0,isNew:!1},score:{curr:0,best:0,prev:0,isNew:!1}},tt={mode:0,speed:0,size:{rows:7,cols:5}},nt={},ot=C(tt),it=null,rt=[],at=0,st=0,ct=1,ut=1,lt=u(m,3e3),ft=Y.loadSettings();null===ft?(ft={highlight:r("highlight").checked,countdown:r("countdown").checked,controls:parseInt(c("#controls input:checked").value,10),sensitivity:n("#sensitivities > .selected").data("option"),size:n("#sizes > .selected").data("option"),speed:n("#speeds > .selected").data("option")},Y.saveSettings(ft)):(E("highlight",r("highlight").checked),E("countdown",r("countdown").checked),r("highlight").checked=ft.highlight,r("countdown").checked=ft.countdown,c('#controls input[value="'+ft.controls+'"]').checked=!0),n("#options input").change(function(){switch(this.name){case"controls":ft.controls=parseInt(c("#controls input:checked").value,10);break;case"highlight":this.checked?(ft[this.name]=this.checked,ht.add()):(ht.remove(),ft[this.name]=this.checked);break;default:ft[this.name]=this.checked}Y.saveSettings(ft)});var dt=function(e,t){function o(o){var i=a(e[0],".score-mod.dead");return(i?n(i):t.clone().appendTo(e)).text("+"+o).removeClass("dead")}function i(e){Ke.text(Math.min(et.score.curr,9999999)),O(o(e)),et.score.best<et.score.curr&&(et.score.best=et.score.curr,et.score.isNew&&(L(n("#new-high-score").removeClass("dead")),et.score.isNew=!1))}function r(e){return 0===e}function s(){return rt[1].every(r)}return function(e,t){var n;t?(n=e.reduce(function(e,n){return e+n/3*t},0),e.forEach(function(e){e>12&&(n*=e/12)}),n*=e.length,s()&&(n*=2*e.length)):n=e%3==0?e/3:0,0!==n&&(et.score.curr+=n,i(n))}}(n("#score-mod-container"),n(".score-mod").first()),ht=function(){function t(e,t){return!!(e+1<rt.length&&_(e+1,t))||!!(t-1>=0&&_(e,t-1))||!!(t+1<rt[0].length&&_(e,t+1))}function n(t,n){var o=Z.get(t,n).firstElementChild;e.getComputedStyle(o).opacity,o.classList.add("h")}function o(e,t){Z.get(e,t).firstElementChild.classList.remove("h")}function i(e){o(e.i,e.j)}function r(){var e,o,i=rt.length,r=rt[0].length;for(o=0;o<r;++o)for(e=0;e<i&&!_(e,o);++e)J(ct,rt[e][o])&&t(e,o)&&(s.push({i:e,j:o}),n(e,o))}function a(){s.forEach(i),s.length=0}var s=[];return{add:function(){ft.highlight&&(s.length>0&&a(),r())},remove:function(){ft.highlight&&a()}}}(),gt=-1,pt=!1,vt=[],mt=function(){function e(e){var t=e.row,n=e.col,o=rt.length-1;for(t=e.row+1;t<o&&!_(t+1,n);++t)rt[t][n]=rt[t+1][n],Z.update(t+1,n,t,n);rt[t][n]=0}return function(){vt.forEach(e),re()}}(),Tt=function(){function e(e,t,n,o){var i,r,a=Z.get(t+1,e),s=Z.get(t,e);for(a.style.zIndex="1",s.style.zIndex="0",B(n,a,t+1,t,e,0,function(){rt[t][e]+=rt[t+1][e],dt(rt[t][e]),Z.hideAt(t+1,e),Z.hideAt(t,e),Z.add(i,t,e),Z.show(i)}),i=Z.newTile(rt[t][e]+rt[t+1][e]),Z.hide(i),q(n,i,t,e),r=t+2;r<rt.length&&!_(r,e);++r)o+=33.333,B(n,Z.get(r,e),r,r-1,e,o)}var t={duration:7*V,easing:"easeInQuad",complete:mt};return function(){var n=o.timeline(t);vt.forEach(function(t){e(t.col,t.row,n,0)})}}(),St=[],wt=function(){var e={duration:7*V,easing:"easeInQuad",complete:se};return function(){var t,n,i,r,a,s=rt.length,c=rt[0].length;for(t=o.timeline(e),i=0;i<c;++i)for(a=St[0],r=St[St.length-1]+1,n=(16.666*i+o.random(0,100))*(r-a);r<s&&!_(r,i);++r,++a)B(t,Z.get(r,i),r,a,i,n),Z.update(r,i,a,i),n+=33.333;0===t.children.length&&se()}}(),bt=function(){function e(e){return 75*e}function t(t,n,o){var r=b(t,n),a=r.left,s=r.top;i.targets=Z.get(t,n),i.offset=e(n),i.translateX=[a,a],i.translateY=[s,s],o.add(i)}var n={easing:X.CLEAR.easing,duration:X.CLEAR.duration,complete:ce},i={targets:null,offset:0,translateX:0,translateY:0,scale:X.CLEAR.scale,rotate:X.CLEAR.rotate};return function(){var e=o.timeline(n);St.forEach(function(n){for(var o=0,i=rt[0].length;o<i;++o)t(n,o,e)})}}(),Et=function(){function e(e,t){z(e)&&St.push(t)}return function(){return St=[],rt.forEach(e),St.length>0?(bt(),!0):(ne(),!1)}}(),yt=function(){function e(e,t,n){var o=Z.get(e,t),i=Z.newTileAt(e,t,n);return M(o,i),i}var t={targets:null,translateX:0,translateY:0,scale:X.PULSE.scale,easing:X.PULSE.easing,duration:X.PULSE.duration,complete:null};return function(n,i,r){var a=b(n,i),s=a.left,c=a.top;t.targets=e(n,i,rt[n][i]),t.translateX=[s,s],t.translateY=[c,c],t.complete=r,o(t)}}(),Ot=0,Lt=null;n(function(n){Lt=Ne(n,e,t)});var zt=function(){function e(e){e.pause()}function t(e){e.play()}function n(e){return qe.find("."+e)}var i=[];return{pause:function(t){(i=o.running.slice()).forEach(e),n(t).addClass("paused")},resume:function(e){i.forEach(t),i=[],n(e).removeClass("paused")},clear:function(t){o.running.slice().forEach(e),i=[],n(t).removeClass("paused"),it&&(it.style.opacity=""),pt=!1}}}(),Nt=function(){var e=null,t=Object.freeze({enter:i,exit:i,pause:i,resume:i,stop:function(){e&&(Nt.pop(),Mt.resume()),Nt.goTo(Nt.Stop)},newGame:i});return Object.freeze({Transition:Object.freeze(n.extend({},t,function(){function e(e,t){c.addClass(o),s=setTimeout(e,t),r=Date.now()}function t(){clearTimeout(s),c.removeClass(o)}var o,i,r,a=0,s=-1,c=n("#grid, #tile-container"),u={End:{getEffect:function(){return"shake-hor"},callback:function(){Nt.goTo(Nt.End)}},Start:{getEffect:function(){return Math.random()<.5?"shake":"shake-rot"},callback:je}};return{enter:function(t){var n=u[t];o=n.getEffect(),e(i=n.callback,a=750)},exit:function(){t()},pause:function(){t(),a=Math.max(a-(Date.now()-r),0)},resume:function(){e(i,a)},newGame:function(){Date.now()-r>750&&(clearTimeout(s),e(i,a))}}}())),Tutorial:Object.freeze(n.extend({},t,{enter:function(){l(function(){function e(){Nt.goTo(Nt.Start)}function t(e,t,o){return function(){n("#tutorial-"+(e-1)).hide(),n("#tutorial-"+e).show(),n("#ok-"+e).off(j).on(j,t),o&&o()}}var o=t(2,e),i=t(1,function(){0===Y.loadTotalTimesPlayed()?o():e()},function(){}),r=qe.find(".tutorial");r.find(".mode").addClass("hide"),r.find(".m"+tt.mode).removeClass("hide"),0===tt.speed?r.find(".speed.classic").removeClass("hide"):r.find(".speed.classic").addClass("hide"),t(0,i,function(){})()})},exit:function(){n(".tutorial").hide(),zt.clear("anim2")},pause:function(){zt.pause("anim2")},resume:function(){zt.resume("anim2")}})),Start:Object.freeze(n.extend({},t,function(){function e(){n=-1,ne(),Y.incTimesPlayed(tt),Nt.goTo(Nt.Playing)}function t(){clearTimeout(n)}var n=-1;return{enter:function(t){t?n=setTimeout(e,t):e()},exit:t,pause:t,resume:function(){n=setTimeout(e,W/2)}}}())),Stop:Object.freeze(n.extend({},t)),Playing:Object.freeze(n.extend({},t,{_clear:function(){Q.remove(),clearTimeout(gt),m()},enter:function(){},exit:function(){this._clear(),zt.clear("anim")},pause:function(){this._clear(),zt.pause("anim"),Nt.push(Nt.Paused)},resume:function(){zt.resume("anim"),pt||(Q.add(it,R()),gt=setTimeout(ze))},newGame:function(){this.pause(),Nt.goTo(Nt.New)}})),Paused:Object.freeze(n.extend({},t,{resume:function(){Nt.goTo(Nt.Resuming)}})),Loading:Object.freeze(n.extend({},t,{enter:function(){Nt.goTo(Nt.Playing),Mt.pause(),Mt.resume()}})),Resuming:Object.freeze(n.extend({},t,function(){function e(){var e=3;!function t(){if(0===e)return Nt.pop(),void Mt.resume();n("#resume .countdown").text(e--),a=setTimeout(t,r)}(),n("#resume").show()}function t(e,t){return e-Math.floor(e/t)*t}function o(){ft.countdown&&(clearTimeout(a),-1===s?Q.remove():(clearTimeout(s),s=-1),n("#resume").hide())}function i(){if(!ft.countdown)return Nt.pop(),void Mt.resume();e(),pt||(s=setTimeout(function(){Q.add(it,R()),s=-1},t(3*r,R())))}var r=800,a=-1,s=-1;return{enter:i,exit:o,pause:o,resume:i,newGame:function(){Nt.goTo(Nt.New)}}}())),End:Object.freeze(n.extend({},t,{enter:function(e){var t,o=n("#msg-container");ht.remove(),Q.remove(),(t=n("#game-over > .msg").hide()).eq(Math.floor(Math.random()*t.length)).show(),o.find(".msg").hide(),et.score.prev<et.score.best?t=o.find(".high-score"):(t=o.find(".share"),Math.random()<.5&&t.add(o.find(".like"))),t.eq(Math.floor(Math.random()*t.length)).show(),e?n("#end").show():n("#end").fadeIn()},exit:function(){n("#end").hide()},newGame:function(){Nt.goTo(Nt.Transition,"Start")}})),New:Object.freeze(n.extend({},t,{enter:function(){n("#confirm").show()},exit:function(){n("#confirm").hide()},continue:function(){Nt.goTo(Nt.Resuming)}})),goTo:function(e,t){Mt.exit(),(Mt=e).enter(t)},push:function(t,n){e=Mt,(Mt=t).enter(n)},pop:function(){Mt.exit(),Mt=e,e=null}})}(),Mt=Nt.Stop;n(e).resize(debounce(function(){xt!==Pt&&xt!==kt||(Me(n("#grid")),Ie(),H.invalidate(tt.size.rows,tt.size.cols),Ce())}));var xt,It=function(){function t(t){return e.history?t:i}var n=!1,o=!1;return history.state&&history.replaceState(null,""),e.onpopstate=function(e){if(o)o=!1;else{if(n=!0,e.state)switch(e.state.section,e.state.section){case"howto":xt.goToOther("howto");break;case"about":xt.goToOther("about");break;case"game":xt.goToGame();break;case"options":xt.goToOptions();break;default:P("Unknown history state!")}else xt.goToMenu();n=!1}},{push:t(function(e){n||(e.toLowerCase(),history.pushState({section:e.toLowerCase()},e))}),pop:t(function(){n||(o=!0,history.back())})}}(),At=Object.freeze({goToOptions:i,goToMenu:i,goToGame:i,goToOther:i,enter:i,exit:i}),Ct=Object.seal(n.extend({},At,{section:"",goToMenu:function(){We(Rt)},enter:function(e){switch(Ct.section=e,Je(Ct.section),It.push(e),Ct.section){case"howto":l(v)}},exit:function(){Ue(Ct.section),It.pop()}})),Rt=Object.freeze(n.extend({},At,{goToOther:function(e){We(Ct,e)},goToGame:function(){We(Pt,!0)},enter:function(){Je("main-menu")},exit:function(){Ue("main-menu")}})),Pt=Object.freeze(n.extend({},At,{goToMenu:function(){_e(),Ue("game"),We(Rt),It.pop()},goToOptions:function(){He(),We(kt)},enter:function(e){e?(Je("game"),Ye()):Ve(),It.push("Game")},exit:function(){}})),kt=Object.freeze(n.extend({},At,{goToMenu:function(){We(Pt),Pt.goToMenu()},goToGame:function(){We(Pt)},enter:function(){Je("options"),r("pause-resume").classList.replace("pause","resume"),It.push("Options")},exit:function(){ft=Y.loadSettings(),It.pop(),r("pause-resume").classList.replace("resume","pause"),Ue("options")}}));xt=Rt,n(function(){function e(e,t){var n="selected";return function(o,i){var r=o.find("."+n).removeClass(n)[e]();0===r.length&&(r=o.children()[t]()),ft[i]=r.addClass(n).data("option"),Y.saveSettings(ft)}}n(".menu-button").on(j,Xe),n("#pause-resume").on(j,Fe),n("#new").on(j,Be),n("#confirm .no").on(j,function(){Mt.continue()}),n("#confirm .yes, #restart").on(j,function(){Nt.goTo(Nt.Transition,"Start")});var t=e("prev","last"),o=e("next","first");n("#size-left").on(j,function(){t(n("#sizes"),"size")}),n("#size-right").on(j,function(){o(n("#sizes"),"size")}),n("#speed-left").on(j,function(){t(n("#speeds"),"speed")}),n("#speed-right").on(j,function(){o(n("#speeds"),"speed")}),n("#sensitivity").on(j,function(){o(n("#sensitivities"),"sensitivity")})}),n(function(){xt.enter(),n("#other .nav-button").on(j,function(){xt.goToOther(this.name)}),n(".play-button").on(j,function(){var e=n("#sizes > .selected").data("option").split("x"),t=+e[0],o=+e[1];n("#grid, #tile-container").removeClass("col"+tt.size.cols),tt.mode=n(this).data("mode"),tt.speed=n("#speeds > .selected").data("option"),tt.size.rows=t,tt.size.cols=o,tt.mode,tt.speed,xt.goToGame()}),n(e).blur(function(){xt===Pt&&Mt!==Nt.End&&xt.goToOptions()}),n(e).unload(function(){xt===Pt&&Mt===Nt.Playing&&m()})})}(e,t,n,o,requestAnimationFrame)}(window,document,Zepto,anime);