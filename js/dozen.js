!function(e,t,n,o){"use strict";function i(){function e(e,t,n){return{breakpoint:e,settings:{slidesToShow:t,dots:void 0===n||n}}}var t={slidesToShow:1,infinite:!1,arrows:!1,dots:!0,waitForAnimate:!1,mobileFirst:!0,accessibility:!1};n(".carousel").hasClass("slick-initialized")||(jQuery("#carousel-modes").slick(n.extend(t,{responsive:[e(500,2),e(820,3,!1)]})),jQuery("#carousel-controls").slick(n.extend(t,{responsive:[e(550,2),e(800,3,!1)]})),jQuery("#carousel-speeds").slick(n.extend(t,{responsive:[e(600,2),e(1280,3),e(1920,4,!1)]})))}function a(t){this.localStorage=t||e.localStorage,+this.load(I.VERSION)!==E&&this._upgrade(this.load(I.VERSION))}function r(e,t){return void 0===t.speed&&(t.speed=""),void 0===t.size&&(t.size=a._size),e+"_"+t.mode+"_"+t.speed+"_"+t.size.rows+"x"+t.size.cols}function s(e){var t,n,o;for(t=e.length-1;t>0;--t)n=Math.floor(Math.random()*(t+1)),o=e[t],e[t]=e[n],e[n]=o}function c(e){return e>0&&0==(e&e-1)}function u(e,t){return e+"-"+t}function l(e,t){return"#c-"+e+"-"+t}function f(e,t){return n(l(e,t)).position()}function d(e){return e>=4&&c(e)?4:e>=12?12*Math.pow(2,Math.log2(e/12)%3):e}function h(e){var t="t"+d(e);return e>100&&(t+=" large"),t}function p(e){return e>0&&e%12==0}function m(e){for(var t=0,n=e.length;t<n;++t)if(e[t]!==e[0])return!1;return!0}function g(e){return e.every(p)&&m(e)}function v(e,t,n){e.style[z]=G(f(t,n))}function T(e,t){t.style[z]=e.style[z]}function A(e,t){var n=e.find(".number"),o=+n.text()||1;return e.removeClass(h(o)).addClass(h(t)),n.text(t),e}function S(e){return O&&(e.translateZ=0),e}var y=function(){Function.prototype.apply.call(console.log,console,arguments)},w=function(){Function.prototype.apply.call(console.warn,console,arguments)};Math.trunc||(w('Undefined "Math.trunc". Using polyfill.'),Math.trunc=function(e){return e>0?Math.floor(e):Math.ceil(e)}),Math.log2||(w('Undefined "Math.log2". Using polyfill.'),Math.log2=function(e){return Math.log(e)*Math.LOG2E}),Array.prototype.fill||(w('Undefined "Array.prototype.fill". Using bad polyfill!'),Object.defineProperty(Array.prototype,"fill",{value:function(e){for(var t=0;t<this.length;++t)this[t]=e;return this}}));var E=0,I=Object.freeze({VERSION:"dozen_version",SETTINGS:"dozen_settings",GRID:"dozen_grid",TILES:"dozen_tiles",STATS:"dozen_stats",RNG:"dozen_rng",APP_STATE:"dozen_app_state",TIMES_PLAYED:"dozen_times_played",HAS_LIKED:"dozen_has_liked"}),M=Object.freeze({CLEAN:0,DIRTY:1,FILTHY:2,EVIL:3}),N=Object.freeze({CLASSIC:0,SLOW:1,PRACTICE:2,FAST:3}),b=Object.freeze({VSHORT:0,SHORT:1,NORMAL:2,LONG:3,VLONG:4});a.prototype._upgrade=function(e){this.save(I.VERSION,E)},a._size={rows:"",cols:""},a.prototype.save=function(e,t){this.localStorage.setItem(e,t)},a.prototype.load=function(e){return this.localStorage.getItem(e)},a.prototype.saveGrid=function(e,t){this.save(r(I.GRID,e),JSON.stringify(t))},a.prototype.loadGrid=function(e){return JSON.parse(this.load(r(I.GRID,e)))},a.prototype.saveTiles=function(e,t,n,o,i){this.save(r(I.TILES,e),JSON.stringify({tile:t,next:n,row:o,col:i}))},a.prototype.loadTiles=function(e){return JSON.parse(this.load(r(I.TILES,e)))},a.prototype.saveRngState=function(e,t){this.save(r(I.RNG,e),JSON.stringify(t))},a.prototype.loadRngState=function(e){return JSON.parse(this.load(r(I.RNG,e)))},a.prototype.saveStats=function(e,t){this.save(r(I.STATS,e),JSON.stringify(t))},a.prototype.loadStats=function(e){return JSON.parse(this.load(r(I.STATS,e)))},a.prototype.hasSavedGame=function(e){return null!==this.load(r(I.TILES,e))},a.prototype.saveAppState=function(e){this.save(I.APP_STATE,JSON.stringify({mode:e}))},a.prototype.loadAppState=function(){return JSON.parse(this.load(I.APP_STATE))},a.prototype.clearAppState=function(){this.localStorage.removeItem(I.APP_STATE)},a.prototype.saveSettings=function(e){this.save(I.SETTINGS,JSON.stringify(e))},a.prototype.loadSettings=function(){return JSON.parse(this.load(I.SETTINGS))},a.prototype.incTimesPlayed=function(e){this.save(I.TIMES_PLAYED+"_"+e.mode,this.loadTimesPlayed(e)+1)},a.prototype.loadTimesPlayed=function(e){return+this.load(I.TIMES_PLAYED+"_"+e.mode)},a.prototype.loadTotalTimesPlayed=function(){var e=this,t=0;return Object.keys(M).forEach(function(n){t+=+e.load(I.TIMES_PLAYED+"_"+M[n])}),t};var C=new a;y("Dozen - Version:","1.3.2"),y("Welcome! Hope you enjoy! :)\n\n");var L=isAndroidStockBrowser?"tap":"tap click",z=function(e){var n=t.createElement("div").style,o=["ms","Moz","webkit"],i=o.length,a=e[0].toUpperCase()+e.slice(1);if(e in n)return e;for(;i--;)if((e=o[i]+a)in n)return e}("transform"),O=function(){var e=t.createElement("div").style,n=["Moz","webkit"],o=n.length;if("perspective"in e)return!0;for(;o--;)if(n[o]+"Perspective"in e)return!0;return!1}(),G=O?function(e){return"translateX("+e.left+"px) translateY("+e.top+"px) translateZ(0)"}:function(e){return"translateX("+e.left+"px) translateY("+e.top+"px)"},D=function(){function e(e,n,o,i){return t.targets=e,t.translateX=n.left,t.translateY=n.top,t.duration=o,t.complete=i,t}var t=S({targets:null,translateX:0,translateY:0,duration:0,complete:null,easing:"linear"});return function(t,n,i,a,r){o(e(t,f(n,i),a,r))}}(),P=function(){function e(e,n,o,i){return t.targets=e,t.translateX=n.left,t.translateY=n.top,t.offset=o,t.complete=i,t}var t=S({targets:null,translateX:0,translateY:0,offset:0,complete:null});return function(t,n,o,i,a,r){t.add(e(n,f(o,i),a,r))}}(),Y=function(e,t){function n(e){return"n"+e}function o(o){var i=e.children(".transparent."+n(o));return 0===i.length?A(t.clone().removeAttr("id"),o).addClass(n(o)).appendTo(e):i.first().removeClass("transparent")}var i={};return{newTile:function(e){return o(e)},newTileAt:function(e,t,n){var i=o(n);return this.add(i,e,t),i},add:function(e,t,n){i[u(t,n)]=e},get:function(e,t){return i[u(e,t)]},update:function(e,t,n,o){var a=u(e,t);i[u(n,o)]=i[a],delete i[a]},show:function(e){e.removeClass("transparent")},hide:function(e){e.addClass("transparent")},hideAt:function(e,t){this.hide(i[u(e,t)])},hideAll:function(){e.children().addClass("transparent")}}}(n("#tile-container"),n("#base-tile")),R=1e3/60,k=960,x={CLEAN:[1,2,3,6],DIRTY:[1,2,3,6],FILTHY:[1,2,3,6],EVIL:[1,2,3,4,6]};!function(e,t,n,o){function a(){C.saveSettings(ct)}function r(){C.saveGrid(et,tt)}function c(){C.saveTiles(et,it,at,nt,ot)}function u(){setTimeout(a)}function l(){setTimeout(r)}function f(){setTimeout(c)}function d(e,t){e.filter(".selected").removeClass("selected"),e.filter('[data-option="'+t+'"]').addClass("selected")}function h(){n(this).addClass("transparent")}function p(){$e.score+=rt,requestAnimationFrame(vt)}function m(e,t){switch(et.speed){default:case N.CLASSIC:return e-$e.level*t;case N.FAST:return e-9*t;case N.SLOW:return e-3*t;case N.PRACTICE:return k}}function y(){var e=et.size.rows-1,t=6*k/e,n=Math.round(333/e);return Math.max(m(t,(t-n)/13),n)}function w(e){Tt.targets=e[0],Tt.duration=y()/2,ut=o(Tt)}function E(e){ut.pause(),e[0].style.opacity=""}function I(e,t){return 0===tt[e][t]}function z(e,t){switch(et.mode){case M.CLEAN:return e+t===3||e===t&&e>=3;case M.DIRTY:return e+t===3||e===t&&2!==e;case M.FILTHY:case M.EVIL:return e+t===3||e===t;default:throw new Error("Invalid mode!")}}function O(){var e=tt.length-1,t=Math.floor(tt[0].length/2),n=tt[e][t];return 0===n||z(n,at)}function G(){v(We[0],nt,ot)}function F(){St=!1,At=setTimeout(de,y()),l(),f()}function _(){clearTimeout(At)}function q(){if(!O())return Pe(),l(),void f();nt=tt.length-1,ot=Math.floor(tt[0].length/2),it=at,at=gt.getNext(),A(Ke,at),We&&E(We),w(We=Y.newTile(it)),G(),I(nt,ot)?F():Z()}function V(){tt[nt][ot]=it,Y.add(We,nt,ot),q()}function X(){var e,t,n=tt.length-1,o=tt[0].length;for(It=[],t=0;t<o;++t)for(e=0;e<n&&!I(e+1,t);++e)if(z(tt[e][t],tt[e+1][t])){It.push({row:e,col:t});break}It.length>0?Nt():zt()}function U(e,t){var n=tt[e];tt[e]=tt[t],tt[t]=n}function H(){for(var e=bt[bt.length-1]+1,t=bt[0],n=tt.length;e<n;)U(t++,e++);X()}function j(){rt=0,bt.forEach(function(e){for(var t=0,n=tt[0].length;t<n;++t)Y.hideAt(e,t);rt+=tt[e][0]/12,tt[e].fill(0)}),p(),Ct()}function J(){tt[nt][ot]+=it,Y.hideAt(nt,ot),wt(nt,ot,X)}function W(){E(We),Y.hide(We),requestAnimationFrame(J)}function B(){G(),F()}function Q(){G(),st()}function Z(){St=!0,W()}function K(e,t){D(We[0],nt,ot,e,t)}function $(e){K(e,V)}function ee(e){We[0].style.zIndex="1",Y.get(nt,ot)[0].style.zIndex="0",K(e,W)}function te(){var e,t=nt;if(E(We),0!==nt&&(I(nt-1,ot)||z(it,tt[nt-1][ot]))){for(e=nt-1;e>=0&&I(e,ot);--e);e<0||!z(it,tt[e][ot])?$(R*(t-(nt=e+1))):ee(R*(t-(nt=e)))}else V()}function ne(){Gt===Ot.PLAYING&&(St||(St=!0,_(),requestAnimationFrame(te)))}function oe(e,t,n){nt=e,ot=t,n()}function ie(e,t){if(Gt===Ot.PLAYING&&!St){if(!I(e,t))return z(it,tt[e][t])?(oe(e,t,Z),void _()):void 0;oe(e,t,Q)}}function ae(){ie(nt,ot-1)}function re(){ie(nt,ot+1)}function se(){ie(nt-1,ot)}function ce(){Gt===Ot.PLAYING&&(St||0===ot||requestAnimationFrame(ae))}function ue(){Gt===Ot.PLAYING&&(St||ot===tt[0].length-1||requestAnimationFrame(re))}function le(){Gt===Ot.PLAYING&&(St||0===nt||requestAnimationFrame(se))}function fe(){if(Gt!==Ot.PAUSED&&!St&&!St){if(0!==nt)return I(nt-1,ot)?(--nt,void B()):z(it,tt[nt-1][ot])?(--nt,void Z()):void V();V()}}function de(){et.speed!==N.PRACTICE&&requestAnimationFrame(fe)}function he(e){switch(e.which){case 37:case 65:e.preventDefault(),ce();break;case 39:case 68:e.preventDefault(),ue();break;case 40:case 83:e.preventDefault(),le();break;case 38:case 87:case 32:e.preventDefault(),ne()}}function pe(){function e(){switch(ct.sensitivity){case b.VSHORT:return.6;case b.SHORT:return.8;default:case b.NORMAL:return 1;case b.LONG:return 1.2;case b.VLONG:return 1.4}}function t(){switch(ct.sensitivity){case b.VSHORT:return.5;case b.SHORT:return.75;default:case b.NORMAL:return.95;case b.LONG:return 1.1;case b.VLONG:return 1.2}}requestAnimationFrame(function(){var o,i=n("#c-0-0"),a=i.position();o=e(),dt=Math.round(Math.abs(n("#c-0-1").position().left-a.left)*o),ht=Math.round(Math.abs(n("#c-1-0").position().top-a.top)*o),o=t(),pt=Math.round(i.width()*o),mt=Math.round(i.height()*o)})}function me(){function o(e,t,n){return e+Math.trunc((t-e)/n)*n}function i(e,t,n){var i,a;if((i=Math.abs(e.clientX-d))>t){a=Math.floor(i/t);do{e.clientX<d?ce():ue()}while(0!=--a);d=o(d,e.clientX,t)}else if((i=e.clientY-h)>n){a=Math.floor(i/n);do{le()}while(0!=--a);h=o(h,e.clientY,n)}}function a(e){return e.clientY>5/8*ft?le:e.clientX<=lt/2?ce:ue}function r(){m(),p=setTimeout(r,33.333)}function s(){n("#game-container").on({touchstart:function(e){var t=e.changedTouches[0];e.preventDefault(),e.touches.length>1||(d=Math.round(t.clientX),h=Math.round(t.clientY))},touchmove:function(e){var t=e.changedTouches[0];e.preventDefault(),e.touches.length>1||i(t,pt,mt)},"touchend touchcancel":function(e){e.preventDefault()},doubleTap:function(){ne()}})}function c(){n("#game-container").on({touchstart:function(e){e.preventDefault(),e.touches.length>1||(m=a(e.changedTouches[0]),p=setTimeout(r,350),g.start(e.changedTouches[0]))},touchmove:function(e){var t=a(e.changedTouches[0]);e.preventDefault(),e.touches.length>1||(g.handleMove(e.changedTouches[0])?clearTimeout(p):t!==m&&(clearTimeout(p),m=t,r()))},touchend:function(e){e.preventDefault(),e.touches.length>0||(g.handleSwipe(e.changedTouches[0])===g.DOWN?ne():m(),clearTimeout(p),m=null)},touchcancel:function(e){e.touches.length>0||(clearTimeout(p),m=null)}})}function u(e){e?c():s()}function l(){n("#game-container").off("touchstart touchmove touchend touchcancel doubleTap")}function f(e){l(),u(e)}pe(),n(e).resize(pe),n(t).keydown(he),n("#game").on("contextmenu",!1);var d,h;!function(){var e=!1;n("#game-container").on({mousedown:function(t){0===t.button&&(t.preventDefault(),e=!0,d=t.clientX,h=t.clientY)},mousemove:function(t){e&&(t.preventDefault(),i(t,dt,ht))},mouseup:function(t){0===t.button&&(t.preventDefault(),e=!1)},mouseout:function(t){t.target===this&&(e=!1)},dblclick:function(e){0===e.button&&(e.preventDefault(),ne())}})}();var p,m,g=function(){function e(){switch(ct.sensitivity){case b.VSHORT:return 20;case b.SHORT:return 30;default:case b.NORMAL:return 40;case b.LONG:return 60;case b.VLONG:return 80}}var t=0,n=0,o=0,i=0,a=0,r={LEFT:0,RIGHT:1,UP:2,DOWN:3,durationThreshold:550,start:function(e){t=Date.now(),n=Math.round(e.clientX),o=Math.round(e.clientY)},handleMove:function(i){var a,s,c=e();return a=Math.abs(i.clientX-n),s=Math.abs(i.clientY-o),Date.now()-t<r.durationThreshold&&(a>c&&s<c||s>c&&a<c)},handleSwipe:function(s){var c,u,l=e();if(i=s.clientX-n,a=s.clientY-o,c=Math.abs(i),u=Math.abs(a),Date.now()-t<r.durationThreshold){if(c>l&&u<l)return i<0?r.LEFT:r.RIGHT;if(u>l&&c<l)return a<0?r.UP:r.DOWN}}};return r}();u(ct.altControls),n("#controls").on("change","input",function(){f(parseInt(n("#controls input:checked").val(),10))})}function ge(){n(e).off("resize",pe),n(t).off("keydown",he),n("#game-container").off(),n("#game").off("contextmenu"),n("#controls").off("change")}function ve(e,t){n("#grid, #tile-container").addClass(e),setTimeout(function(){requestAnimationFrame(function(){n("#grid, #tile-container").removeClass(e),t()})},750+1e3/60)}function Te(){var e;n("#grid .row, #grid .cell").addClass("hidden"),e=new Array(et.size.rows).fill(0).map(function(e,t){return".r"+t}).join(","),e+=","+new Array(et.size.cols).fill(0).map(function(e,t){return".c"+t}).join(","),n(e).removeClass("hidden")}function Ae(){var e;n("#grid .cell").css("width",""),e=n(".row.r0 .cell:not(.hidden)").map(function(){return n(this).width()}).get(),n("#grid .cell").css("width",Math.max.apply(null,e)),n("#tile-container").width(n("#grid").width())}function Se(){var e=n("#c-0-0").width();n(".tile").width(e)}function ye(){tt.forEach(function(e,t){e.forEach(function(e,n){0!==e&&v(Y.newTileAt(t,n,e)[0],t,n)})}),We&&v(We[0],nt,ot)}function we(){tt.forEach(function(e,t){e.forEach(function(e,n){0!==e&&v(Y.get(t,n)[0],t,n)})}),We&&v(We[0],nt,ot)}function Ee(){lt=n(e).width(),ft=n(e).height(),Ae(),Se(),we()}function Ie(){lt=n(e).width(),ft=n(e).height(),Y.hideAll(),Te(),Ae(),Se(),Be.text($e.level),Qe.text($e.score),Ze.text($e.best),A(Ke,at)}function Me(){C.hasSavedGame(et)?$e=C.loadStats(et):$e.best=0,$e.level=0,$e.score=0,$e.isNewBest=!0,$e.prevBest=$e.best,C.saveStats(et,$e),tt=function(e,t){var n,o,i,a=[];for(o=0;o<e;++o){for(n=[],i=0;i<t;++i)n.push(0);a.push(n)}return a}(et.size.rows,et.size.cols),gt.init(),at=gt.getNext(),Ie(),Dt=function(){requestAnimationFrame(function(){Gt=Ot.PLAYING,q(),C.incTimesPlayed(et)})},0===C.loadTimesPlayed(et)?(Gt=Ot.WAITING,requestAnimationFrame(function(){function e(){requestAnimationFrame(function(){n(".instruction-screen.ingame-screen").hide(),At=setTimeout(Dt,200)})}function t(){n("#instruction-screen-1").hide(),n("#instruction-screen-2").show(),n("#ok-button-2").off(L).on(L,e)}n("#instruction-screen-0").show(),n("#ok-button-0").off(L).on(L,function(){n("#instruction-screen-0").hide(),n("#instruction-screen-1").show(),n("#ok-button-1").off(L).on(L,function(){0===C.loadTotalTimesPlayed()?requestAnimationFrame(t):e()})})})):At=setTimeout(Dt,k)}function Ne(){var e;e=C.loadTiles(et),tt=C.loadGrid(et),$e=C.loadStats(et),it=e.tile,at=e.next,nt=e.row,ot=e.col,gt.load(),Ie(),requestAnimationFrame(function(){We=Y.newTile(it),ye(),w(We)}),O()?(Dt=function(){Gt=Ot.PLAYING,de()},At=setTimeout(Dt,2*k)):requestAnimationFrame(function(){Pe(!0)})}function be(){(Yt=o.running.slice()).forEach(function(e){e.pause()})}function Ce(){Yt.forEach(function(e){e.play()}),Yt=[]}function Le(){be(),Yt=[],We&&(We[0].style.opacity=""),St=!1}function ze(){n("#game .ingame-screen").hide(),Le(),n("#game .anim").removeClass("paused"),Gt=Ot.STARTING,C.hasSavedGame(et)?Ne():Me()}function Oe(){Le(),n("#game .anim").removeClass("paused"),Gt=Ot.STARTING,Me()}function Ge(){n("#game .anim").addClass("paused"),be(),clearTimeout(At),Gt!==Ot.STARTING&&Gt===Ot.PLAYING&&(Gt=Ot.PAUSED)}function De(){n("#game .anim").removeClass("paused"),Ce(),Gt!==Ot.STARTING?Gt===Ot.PAUSED&&(St||(ut.restart(),At=setTimeout(de,2*y())),Gt=Ot.PLAYING):At=setTimeout(Dt,k)}function Pe(e){var t;E(We),(t=n("#game-over > .msg").hide()).eq(Math.floor(Math.random()*t.length)).show(),n("#msg-container > .msg").hide(),$e.prevBest<$e.best?t=n("#msg-container > .high-score"):(t=n("#msg-container > .share"),Math.random()<.5&&t.add("#msg-container > .like")),t.eq(Math.floor(Math.random()*t.length)).show(),e?n("#end-screen").show():ve("shake-hor",function(){n("#end-screen").fadeIn()}),Gt=Ot.ENDED}function Ye(e,t){Pt.shutdown(),(Pt=e).create(t)}function Re(e){Ye(xt,e)}function ke(e){Ye(_t,e)}function xe(e){Ye(kt,e)}function Fe(e){Ye(Ft,e)}function _e(e){n(t).on("backbutton",e)}function qe(e){n(t).off("backbutton",e)}function Ve(){Pt===Ft?Pt.goToOptions():Pt===_t&&Pt.goToGame()}function Xe(){requestAnimationFrame(Ve)}function Ue(){}function He(e,t){requestAnimationFrame(function(){var o=n(e),i=o.removeClass("selected").prev();0===i.length&&(i=o.parent().children().last()),i.addClass("selected"),ct[t]=i.data("option"),u()})}function je(e,t){requestAnimationFrame(function(){var o=n(e),i=o.removeClass("selected").next();0===i.length&&(i=o.parent().children().first()),i.addClass("selected"),ct[t]=i.data("option"),u()})}function Je(){requestAnimationFrame(function(){n("#end-screen, #confirm-screen").hide(),ve(Math.random()<.5?"shake":"shake-rot",Oe)})}var We,Be=n("#level"),Qe=n("#score"),Ze=n("#best"),Ke=n("#next"),$e={level:0,score:0,best:0,prevBest:0,isNewBest:!1},et={mode:-1,speed:-1,size:{rows:-1,cols:-1}},tt=[],nt=0,ot=0,it=1,at=1,rt=0,st=function(){function e(){t=-1,c()}var t=-1;return function(){-1===t&&(t=setTimeout(e,100))}}(),ct=C.loadSettings();null===ct?(ct={altControls:parseInt(n("#controls input:checked").val(),10),sensitivity:n("#sensitivity-list .sensitivity.selected").data("option"),size:n("#sizes .size.selected").data("option"),speed:n("#speeds .speed.selected").data("option")},C.saveSettings(ct)):(n('#controls input[value="'+ct.altControls+'"]').prop("checked",!0),d(n("#sensitivity-list .sensitivity"),ct.sensitivity),d(n("#sizes .size"),ct.size),d(n("#speeds .speed"),ct.speed)),n("#options input").change(function(){switch(this.name){case"controls":ct.altControls=parseInt(n("#controls input:checked").val(),10);break;default:ct[this.name]=this.checked}u()});var ut,lt,ft,dt,ht,pt,mt,gt=function(e){function t(t,n){var o,i,a,r=n.length;for(o=t.length===r*(e.size.cols-2)?e.size.cols-1:e.size.cols-2,t.length=r*o,i=0;i<r;++i)for(a=0;a<o;++a)t[i*o+a]=n[i];s(t)}function n(e){return r.index===r.bag.length&&(t(r.bag,e),r.index=0),r.bag[r.index++]}function o(){switch(e.mode){case M.EVIL:a=x.EVIL;break;case M.FILTHY:a=x.FILTHY;break;case M.DIRTY:a=x.DIRTY;break;default:case M.CLEAN:a=x.CLEAN}}function i(){c.save()}var a,r={bag:[],index:0},c={init:function(){o(),r.bag=new Array(a.length*(e.size.cols-2)),t(r.bag,a),r.index=Math.floor(3*Math.random()),this.save()},load:function(){r=C.loadRngState(e),o()},save:function(){C.saveRngState(e,r)},getNext:function(){return setTimeout(i),n(a)}};return c}(et),vt=(n("#score-mod-container"),function(){Qe.text($e.score),$e.best<$e.score&&($e.best=$e.score,Ze.text($e.best),$e.isNewBest&&(n("#new-high-score").removeClass("transparent").animate("alert",2e3,h),$e.isNewBest=!1)),$e.score>=10*($e.level+1)&&($e.level=Math.floor($e.score/10),Be.text($e.level),n("#level-up").removeClass("transparent").animate("rise","ease",750,h)),C.saveStats(et,$e)}),Tt={targets:null,opacity:.5,duration:500,easing:"linear",direction:"alternate",loop:!0},At=-1,St=!1,yt={PULSE:{scale:[{value:.86,duration:79.25},{value:1.16,duration:158.5},{value:1,duration:79.25}],easing:{EASE:[.25,.1,.25,1]}.EASE,duration:317},CLEAR:{scale:[{value:1.23,duration:125},{value:0,duration:375}],rotate:[{value:720,duration:375,delay:125}],easing:"linear",duration:500}},wt=function(){function e(e,t,n){var o=Y.get(e,t)[0],i=Y.newTileAt(e,t,n)[0];return T(o,i),i}var t=S({targets:null,translateX:0,translateY:0,scale:yt.PULSE.scale,easing:yt.PULSE.easing,duration:yt.PULSE.duration,complete:null});return function(n,i,a){var r=e(n,i,tt[n][i]);t.targets=r,t.translateX=o.getValue(r,"translateX"),t.translateY=o.getValue(r,"translateY"),t.complete=a,o(t)}}(),Et=function(){var e=S({targets:null,translateX:0,translateY:0,scale:yt.PULSE.scale,easing:yt.PULSE.easing,duration:yt.PULSE.duration});return function(t,n,i,a){e.targets=n,e.translateX=o.getValue(n,"translateX"),e.translateY=o.getValue(n,"translateY"),t.add(e)}}(),It=[],Mt=function(){function e(e){var t=e.row,n=e.col,o=tt.length-1;for(t=e.row+1;t<o&&!I(t+1,n);++t)tt[t][n]=tt[t+1][n],Y.update(t+1,n,t,n);tt[t][n]=0}return function(){It.forEach(e),X()}}(),Nt=function(){function e(e,t,n,o){var i,a,r=Y.get(t+1,e)[0],s=Y.get(t,e)[0];for(r.style.zIndex="1",s.style.zIndex="0",P(n,r,t,e,0,function(){tt[t][e]+=tt[t+1][e],Y.hideAt(t+1,e),Y.hideAt(t,e),Y.add(i,t,e),Y.show(i)}),i=Y.newTile(tt[t][e]+tt[t+1][e]),Y.hide(i),T(s,i[0]),Et(n,i[0],t,e),a=t+2;a<tt.length&&!I(a,e);++a)P(n,Y.get(a,e)[0],a-1,e,o+=33.333)}var t={duration:7*R,easing:"easeInQuad",complete:Mt};return function(){var n=o.timeline(t);It.forEach(function(t){e(t.col,t.row,n,0)})}}(),bt=[],Ct=function(){var e={duration:7*R,easing:"easeInQuad",complete:H};return function(){var t,n,i,a,r,s=tt.length,c=tt[0].length;for(t=o.timeline(e),i=0;i<c;++i)for(n=16.666*i+o.random(0,100),r=bt[0],a=bt[bt.length-1]+1;a<s&&!I(a,i);++a,++r)P(t,Y.get(a,i)[0],r,i,n),Y.update(a,i,r,i),n+=33.333;0===t.children.length&&H()}}(),Lt=function(){function e(e){return 75*e}function t(t,n,a){var r=Y.get(t,n)[0];i.targets=r,i.offset=e(n),i.translateX=o.getValue(r,"translateX"),i.translateY=o.getValue(r,"translateY"),a.add(i)}var n={easing:yt.CLEAR.easing,duration:yt.CLEAR.duration,complete:j},i=S({targets:null,offset:0,translateX:0,translateY:0,scale:yt.CLEAR.scale,rotate:yt.CLEAR.rotate});return function(){var e=o.timeline(n);bt.forEach(function(n){for(var o=0,i=tt[0].length;o<i;++o)t(n,o,e)})}}(),zt=function(){function e(e,t){g(e)&&bt.push(t)}return function(){bt=[],tt.forEach(e),bt.length>0?Lt():q()}}(),Ot=Object.freeze({WAITING:0,STARTING:1,PLAYING:2,PAUSED:3,ENDED:4}),Gt=Ot.PAUSED;n(t).keydown(function(e){switch(e.which){case 80:e.preventDefault(),Xe()}}),n(e).resize(function(){Pt!==Ft&&Pt!==_t||requestAnimationFrame(Ee)});var Dt,Pt,Yt=[],Rt={goToOptions:Ue,goToMainMenu:Ue,goToGame:Ue,goToOther:Ue,create:Ue,shutdown:Ue};n(e).resize(function(){var e=jQuery(".carousel");Pt===kt&&"#howto"===kt.selector||e.hasClass("slick-initialized")&&e.slick("unslick")});var kt=n.extend({},Rt,{selector:"",goToMainMenu:function(){n(kt.selector).css("display","none"),qe(kt.goToMainMenu),Re()},create:function(e){kt.selector="#"+e,n(kt.selector).css("display","block"),_e(kt.goToMainMenu),"howto"===e&&requestAnimationFrame(i)}}),xt=n.extend({},Rt,{goToOther:function(e){n("#main-menu").hide(),xe(e)},goToGame:function(){n("#main-menu").hide(),Fe()},create:function(){n("#main-menu").show()}}),Ft=n.extend({},Rt,{goToMainMenu:function(){Ge(),ge(),n("#game").hide(),Re()},goToOptions:function(){n("#confirm-screen").hide(),Ge(),ke()},create:function(e){e||(n("#game").show(),me(),ze()),_e(Ft.goToOptions)},shutdown:function(){qe(Ft.goToOptions)}}),_t=n.extend({},Rt,{goToMainMenu:function(){Fe(!0),Ft.goToMainMenu()},goToGame:function(){Fe(!0),De()},create:function(){n("#options").show(),n("#pause-resume-button").removeClass("pause").addClass("resume"),_e(_t.goToGame)},shutdown:function(){ct=C.loadSettings(),qe(_t.goToGame),n("#options").hide(),n("#pause-resume-button").removeClass("resume").addClass("pause")}});Pt=xt,n("#pause-resume-button").on(L,Xe),n("#other button").on(L,function(){var e=this.name;requestAnimationFrame(function(){Pt.goToOther(e)})}),n("#size-left").on(L,function(){He("#sizes .size.selected","size")}),n("#size-right").on(L,function(){je("#sizes .size.selected","size")}),n("#speed-left").on(L,function(){He("#speeds .speed.selected","speed")}),n("#speed-right").on(L,function(){je("#speeds .speed.selected","speed")}),n("#sensitivity").on(L,function(){je("#sensitivity-list .sensitivity.selected","sensitivity"),pe()}),n(".play-button").on(L,function(){var e=n("#sizes .size.selected").data("option").split("x"),t=this,o=et.size.cols;et.mode=n(this).data("mode"),et.speed=n("#speeds .speed.selected").data("option"),et.size.rows=+e[0],et.size.cols=+e[1],requestAnimationFrame(function(){n("#game .mode").addClass("hidden"),n("#game ."+t.id).removeClass("hidden"),n("#speed-container .speed").addClass("hidden").filter('[data-option="'+et.speed+'"]').removeClass("hidden"),n("#mode-container .mode").addClass("hidden").filter('[data-option="'+et.mode+'"]').removeClass("hidden"),n("#grid, #tile-container").removeClass("col"+o).addClass("col"+et.size.cols),0===et.speed?n("#game .speed.classic").removeClass("hidden"):n("#game .speed.classic").addClass("hidden"),Pt.goToGame()})}),n(".menu-button").on(L,function(){requestAnimationFrame(function(){Pt.goToMainMenu()})}),n("#new-game-button").on(L,function(){Pt===_t&&Pt.goToGame(),Gt!==Ot.WAITING&&(Gt!==Ot.ENDED?(Ge(),requestAnimationFrame(function(){n("#confirm-screen").show()})):Je())}),n("#confirm-screen .yes").on(L,Je),n("#confirm-screen .no").on(L,function(){requestAnimationFrame(function(){n("#confirm-screen").hide(),De()})}),n("#restart-button").on(L,Je),Pt.create(),n(e).blur(function(){Pt===Ft&&Gt!==Ot.ENDED&&Pt.goToOptions()})}(e,t,n,o)}(window,document,Zepto,anime);