!function(e,n,t,o,r,i){"use strict";function s(){}function c(e){return n.getElementById(e)}function u(e){return n.querySelectorAll(e)}function a(e){return n.querySelector(e)}function l(e,n){e.classList.add(n)}function f(e,n){e.classList.remove(n)}function d(e,n){return e.classList.contains(n)}function h(e,n){e.textContent=n}function p(e){l(e,"hide")}function g(e){c(e).style.display="block"}function m(e){c(e).style.display="none"}function v(){function n(e,n){var t={};return t.slidesPerView=e,t.breakpoints={},n.forEach(function(e){t.breakpoints[e[0]]={slidesPerView:e[1]}}),t}var t=c("carousel-modes");if(d(t,"initialized"))d(t,"resize")&&(c("carousel-modes").swiper.update(),c("carousel-controls").swiper.update(),c("carousel-speeds").swiper.update(),f(t,"resize"));else{l(t,"initialized"),e.MutationObserver||e.on("resize",debounce(function(){l(t,"resize")}));var r={grabCursor:!0,roundLengths:!0,watchOverflow:!0,longSwipesRatio:.25,resistanceRatio:.8,slideToClickedSlide:!0,observer:!0,observeParents:!0,setWrapperSize:!0,runCallbacksOnInit:!1,pagination:{el:".swiper-pagination",clickable:!0},mousewheel:{releaseOnEdges:!0}};new Swiper("#carousel-modes",o.extend(r,n(3,[[500,1],[820,2]]))),new Swiper("#carousel-controls",o.extend(r,n(3,[[550,1],[800,2]]))),new Swiper("#carousel-speeds",o.extend(r,n(4,[[600,1],[1280,2],[1920,3]])))}}function T(e,n){return"c-"+e+"-"+n}function S(e){var n=e.getBoundingClientRect(),t=e.offsetParent.getBoundingClientRect();return{top:n.top-t.top,left:n.left-t.left}}function w(e){return e.getBoundingClientRect().width}function y(e){return e.getBoundingClientRect().height}function O(e,n){var t=fn.get(e,n);return t||(t=S(c(T(e,n))),fn.set(e,n,t),t)}function b(e){return Math.round(Math.log2(e))}function E(e){return e>0&&e%12==0}function N(e){for(var n=0,t=e.length;n<t;++n)if(e[n]!==e[0])return!1;return!0}function I(e){return e.every(E)&&N(e)}function M(e,n,t){e.style[an]=dn(O(n,t))}function x(e){return e>=4&&sn.isPowerOf2(e)?4:e>=12?12*Math.pow(2,b(e/12)%3):e}function A(e,n){l(e,"t"+x(n)),n>=100&&l(e,"large"),h(e,n)}function k(e,n,t){if(t){if(n===t)return;e.children().filter(".t"+n).removeClass("d").end().filter(".t"+t).addClass("d")}else e.children().addClass("d").filter(".t"+n).removeClass("d")}function C(e,n,t){return new i(t).set(e,{css:{x:n.left,y:n.top,scale:1,rotation:0}}).to(e,.25*mn,{css:{scale:.82},ease:Power1.easeInOut}).to(e,.5*mn,{css:{scale:1.16},ease:Power1.easeInOut}).to(e,.25*mn,{css:{scale:1},ease:Power1.easeInOut})}function R(e,n){return(new i).set(e,{css:{x:n.left,y:n.top,scale:1,rotation:0}}).to(e,.25*gn,{css:{scale:1.22,rotation:0}}).to(e,.75*gn,{css:{scale:0,rotation:720}})}function P(e,n,t){var o=1e3/60/1e3;return new TimelineMax({repeat:n/1e3/(5*o)-1,onComplete:t}).fromTo(e,o,{css:{transform:"translate(-0.1em, -0.1em)"}},{css:{transform:"translate(0, -0.2em)"},ease:Power1.easeInOut}).to(e,o,{css:{transform:"translate(0.2em, 0)"},ease:Power1.easeInOut}).to(e,o,{css:{transform:"translate(0, 0.2em)"},ease:Power1.easeInOut}).to(e,o,{css:{transform:"translate(-0.2em, 0)"},ease:Power1.easeInOut}).to(e,o,{css:{transform:"translate(-0.1em, -0.1em)",clearProps:"all"},ease:Power1.easeInOut})}function z(e,n,t){return TweenMax.fromTo(e,1e3/60/1e3*2,{css:{transform:"translateX(-0.125em)"}},{css:{transform:"translateX(0.125em)",clearProps:"all",force3D:"auto"},ease:Linear.easeNone,repeat:n/1e3/(1e3/60/1e3*2)-1,yoyo:!0,onComplete:t})}function L(e,n,t){return TweenMax.fromTo(e,1e3/60/1e3*2,{css:{rotation:1.5}},{css:{rotation:-1.5,clearProps:"all",force3D:"auto"},ease:Linear.easeNone,repeat:n/1e3/(1e3/60/1e3*2)-1,yoyo:!0,onComplete:t})}function D(e,n,t,o,r){e.add(C(n,O(t,o)),r)}function G(e){switch(e){case nn.FILTHY:return Tn.FILTHY;case nn.DIRTY:return Tn.DIRTY;default:case nn.CLEAN:return Tn.CLEAN}}function j(e){xn.row=Pn,xn.col=zn,e&&(xn.level=In.level,xn.lines=In.lines.curr,xn.score=In.score.curr,xn.tile=Ln,xn.next=Dn,cn.copy2d(Rn,xn.grid),cn.copy(kn.state.bag,xn.rng.bag),xn.rng.i=kn.state.i)}function _(){(xn={level:0,lines:0,score:0,tile:1,next:1,row:0,col:0,grid:[],rng:{}}).grid=cn.make2d(xn.grid,Mn.size.rows,Mn.size.cols,0),o.extend(!0,xn.rng,kn.state),j(!0)}function H(){_(),An=o.extend(!0,{},xn)}function Y(){var e=An;An=xn,xn=e,j(!0)}function V(){rn.saveStats(Mn,In),rn.saveGrid(Mn,Rn),rn.saveTiles(Mn,{tile:Ln,next:Dn,row:Pn,col:zn}),rn.saveRngState(Mn,kn.state),rn.savePrev(Mn,An)}function J(){var e;if(Vn)return e=o.extend(!0,{},In),e.level=xn.level,e.lines.curr=xn.lines,e.score.curr=xn.score,rn.saveStats(Mn,e),rn.saveGrid(Mn,xn.grid),rn.saveTiles(Mn,{tile:xn.tile,next:xn.next,row:xn.row,col:xn.col}),rn.saveRngState(Mn,xn.rng),void rn.savePrev(Mn,xn);V()}function W(e,n){e.filter(".selected").removeClass("selected"),e.filter('[data-option="'+n+'"]').addClass("selected")}function F(e,n){e in jn||(jn[e]=n,rn.saveSettings(jn))}function U(e){return 0===e}function X(e){return Rn[e].every(U)}function B(e,n){return 0===Rn[e][n]}function q(){l(this,"d")}function K(e){r.set(e,{css:{y:0,opacity:1}}),r.to(e,1.5,{css:{transform:"translateY(-1.5em)",opacity:0},ease:Power1.easeInOut,onComplete:q,onCompleteScope:e})}function Z(e,n){var t=c(e);return h(t,n),f(t,"d"),t}function Q(e){var n;In.lines.curr+=e,h(c("lines"),In.lines.curr),K(Z("line-mod","+"+e)),In.lines.best<In.lines.curr&&(In.lines.best=In.lines.curr,In.lines.isNew&&(In.lines.isNew=!1)),In.lines.curr>=(In.level+1)*Sn&&(n=Math.floor(In.lines.curr/Sn),h(c("level"),n),K(Z("level-mod","+"+(n-In.level))),In.level=n)}function $(e,n,t){switch(e){default:case tn.CLASSIC:return n-In.level*t;case tn.FAST:return n-9*t;case tn.SLOW:return n-3*t;case tn.PRACTICE:return vn}}function ee(){var e=Mn.size.rows-1,n=6*vn/e,t=Math.round(333/e);return Math.max($(Mn.speed,n,(n-t)/13),t)}function ne(e,n){switch(Mn.mode){case nn.CLEAN:return e+n===3||e===n&&e>=3;case nn.DIRTY:return e+n===3||e===n&&2!==e;case nn.FILTHY:return e+n===3||e===n;default:throw new Error("Invalid mode!")}}function te(){var e=Rn.length-1,n=Math.floor(Rn[0].length/2),t=Rn[e][n];return 0===t||ne(t,Dn)}function oe(){M(Cn,Pn,zn)}function re(){Vn=!1,Yn=setTimeout(ze,ee()),Gn()}function ie(){clearTimeout(Yn)}function se(){if(!te())return Vn=!1,J(),void Qn.goTo(Qn.Ending);Pn=Rn.length-1,zn=Math.floor(Rn[0].length/2),Ln=Dn,Dn=kn.getNext(),k(Nn,Dn,Ln),Y(),Cn=En.newTile(Ln),bn.mark(Cn,ee()),oe(),Hn.add(),B(Pn,zn)?re():we()}function ce(){Rn[Pn][zn]=Ln,En.add(Cn,Pn,zn)}function ue(){ce(),se()}function ae(e,n,t){var o=Rn.length;for(Rn[e][n]+=Rn[e+t][n],++e;e+t<o&&!B(e+t,n);++e)Rn[e][n]=Rn[e+t][n];Rn[e+t-1][n]=0}function le(e){ae(e.row,e.col,1)}function fe(e,n){e.forEach(le),he(n)}function de(e,n,t,o){var r,i,s,c=En.get(e+o,n),u=En.get(e,n),a=En.newTile(Rn[e][n]+Rn[e+o][n]),l=0,f=Rn.length;for(a.style.opacity="0",c.style.zIndex="2",u.style.zIndex="1",yn(t,c,e+o,e,n,l,function(){En.kill(c),En.kill(u),En.add(a,e,n),a.style.opacity=""}),s=t.recent().endTime(),D(t,a,e,n,s),i=(r=e+1)+o;i<f&&!B(i,n);++r,++i)l+=2*hn,yn(t,En.get(i,n),i,r,n,l),En.update(i,n,r,n);return s}function he(e){var n,t,o=Rn.length-1,r=Rn[0].length,i=[];for(t=0;t<r;++t)for(n=0;n<o&&!B(n+1,t);++n)if(ne(Rn[n][t],Rn[n+1][t])){i.push({row:n,col:t});break}return i.length>0?(Jn(i,e),!0):(Fn(e),!1)}function pe(e,n){var t=e[e.length-1]+1,o=e[0];Wn(o,t-o),he(n)}function ge(e,n,t,o){var r,i=(n*hn+sn.random(0,6*hn))*(t-o);for(r=Rn.length;t<r&&!B(t,n);++t,++o)yn(e,En.get(t,n),t,o,n,i),En.update(t,n,o,n),i+=2*hn}function me(e,n){var t,o,r=new i({onComplete:pe,onCompleteParams:[e,n]}),s=Rn[0].length;for(t=0;t<s;++t)o=e[0],ge(r,t,e[e.length-1]+1,o)}function ve(e,n){var t=0,o=[];e.forEach(function(e){for(var n=0,r=Rn[0].length;n<r;++n)En.killAt(e,n);t+=Rn[e][0]/12,o.push(Rn[e][0]),Rn[e].fill(0)}),Q(t),_n(o,Mn.size.cols),me(e,n)}function Te(e,n){var t=new i({onComplete:ve,onCompleteParams:[e,n]});e.forEach(function(e){for(var n=0,o=Rn[0].length;n<o;++n)On(t,e,n)})}function Se(){Hn.remove(),bn.unmark(),En.kill(Cn),En.killAt(Pn,zn),Rn[Pn][zn]+=Ln,_n(Rn[Pn][zn]),Un(Pn,zn)}function we(){Vn=!0,Se()}function ye(){Hn.remove(),Pn=Xn}function Oe(){ye(),ue()}function be(){ye(),Se()}function Ee(e){wn(Cn,Pn,Xn,zn,e,Oe)}function Ne(e){Cn.style.zIndex="2",En.get(Xn,zn).style.zIndex="1",wn(Cn,Pn,Xn,zn,e,be)}function Ie(){var e;if(!Vn)if(Vn=!0,ie(),j(),bn.unmark(),0!==Pn&&(B(Pn-1,zn)||ne(Ln,Rn[Pn-1][zn]))){for(e=Pn-1;e>=0&&B(e,zn);--e);e<0||!ne(Ln,Rn[e][zn])?Ee(pn*(Pn-(Xn=e+1))):Ne(pn*(Pn-(Xn=e)))}else ue()}function Me(e,n,t){j(),Pn=e,zn=n,t()}function xe(e,n){return B(e,n)?(Me(e,n,oe),!0):!!ne(Ln,Rn[e][n])&&(Me(e,n,we),ie(),!1)}function Ae(e,n,t){do{if(!xe(Pn+e,zn+n))break}while(--t>0);return Vn}function ke(e){return 0!==zn&&Ae(0,-1,Math.min(e,zn))}function Ce(e){return zn!==Rn[0].length-1&&Ae(0,1,Math.min(e,Rn[0].length-1-zn))}function Re(e){return 0!==Pn&&Ae(-1,0,Math.min(e,Pn))}function Pe(){return 0===Pn?(ue(),!0):(j(),B(Pn-1,zn)?(--Pn,oe(),re(),!1):ne(Ln,Rn[Pn-1][zn])?(--Pn,we(),!0):(ue(),!0))}function ze(){Mn.speed!==tn.PRACTICE&&qn(Bn.ADVANCE)}function Le(e){function n(e,n,t){var o,r="",i=n-1;for(o=e-1;o<i;++o)r+=t+o+",";return r+t+o}e.find(n(5,Mn.size.rows,".r")).removeClass("hide"),e.find(n(5,Mn.size.cols,".c")).removeClass("hide"),e.find(n(Mn.size.rows+1,11,".r")).addClass("hide"),e.find(n(Mn.size.cols+1,9,".c")).addClass("hide")}function De(){Rn.forEach(function(e,n){e.forEach(function(e,t){0!==e&&M(En.newTileAt(n,t,e),n,t)})}),Cn&&M(Cn,Pn,zn)}function Ge(){Rn.forEach(function(e,n){e.forEach(function(e,t){0!==e&&M(En.get(n,t),n,t)})}),Cn&&M(Cn,Pn,zn)}function je(){En.killAll(),Hn.remove()}function _e(){Le(o("#grid")),o("#grid").addClass("col"+Mn.size.cols),o("#speed-container .speed").addClass("hide").filter('[data-option="'+Mn.speed+'"]').removeClass("hide"),o("#mode-container .mode").addClass("hide").filter('[data-option="'+Mn.mode+'"]').removeClass("hide"),fn.invalidate(Mn.size.rows,Mn.size.cols),En.init(Mn.size.rows,Mn.size.cols)}function He(){h(c("level"),In.level),h(c("lines"),In.lines.curr),h(c("score"),In.score.curr),k(Nn,Dn)}function Ye(e){(e=e||!1)?In=rn.loadStats(Mn):(In.lines.best=0,In.score.best=0),In.level=0,In.lines.curr=0,In.lines.isNew=!0,In.lines.prev=In.lines.best,In.score.curr=0,In.score.isNew=!0,In.score.prev=In.score.best,In.continue=!1,Rn=cn.make2d(Rn,Mn.size.rows,Mn.size.cols,0),kn.init(G(Mn.mode)),Dn=kn.getNext(),H(),0===rn.loadTimesPlayed(Mn)?Qn.goTo(Qn.Tutorial):Qn.goTo(Qn.Start,vn/2)}function Ve(){var e=rn.loadTiles(Mn);Rn=rn.loadGrid(Mn),In=rn.loadStats(Mn),An=rn.loadPrev(Mn),Ln=e.tile,Dn=e.next,Pn=e.row,zn=e.col,kn.init(G(Mn.mode),rn.loadRngState(Mn)),Cn=En.newTile(Ln),oe(),t(De),An?_():H(),te()?(Hn.add(),Qn.goTo(Qn.Loading)):Qn.goTo(Qn.End,!0)}function Je(){_e(),rn.hasSavedGame(Mn)?Ve():Ye(),He()}function We(){je(),$n.stop(),Ye(!0),He()}function Fe(){$n.stop(),je()}function Ue(){$n.pause()}function Xe(){$n.resume()}function Be(e,n){et.exit(),(et=e).enter(n)}function qe(){et.goToMenu()}function Ke(){et===it?et.goToOptions():et===st&&et.goToGame()}function Ze(){et!==it&&et!==st||(et===st&&et.goToGame(),$n.newGame())}function Qe(){var n=c("logo");et.enter(),r.set(n,{css:{y:Math.round((e.innerHeight-n.offsetHeight)/2),scale:1}}),n.on(PREFIXED_ANIMATIONEND,function e(t){t.target===this&&(r.set(c("logo"),{css:{y:0,scale:1}}),u(".intro").forEach(function(e){f(e,"intro")}),n.off(PREFIXED_ANIMATIONEND,e))})}var $e=function(){Function.prototype.apply.call(console.info,console,arguments)},en=function(){Function.prototype.apply.call(console.warn,console,arguments)};void 0===String.prototype.startsWith&&(en('Undefined "String.prototype.startsWith". Using incomplete polyfill...'),String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),Math.trunc||(en('Undefined "Math.trunc". Using polyfill.'),Math.trunc=function(e){return e>0?Math.floor(e):Math.ceil(e)}),Math.log2||(en('Undefined "Math.log2". Polyfill returns imprecise values on some inputs!'),Math.log2=function(e){return Math.log(e)*Math.LOG2E}),Array.prototype.fill||(en('Undefined "Array.prototype.fill". Using bad polyfill!'),Object.defineProperty(Array.prototype,"fill",{value:function(e){for(var n=0;n<this.length;++n)this[n]=e;return this}})),e.NodeList&&!NodeList.prototype.forEach&&(en('Undefined "NodeList.prototype.forEach". Using Array.prototype.forEach.'),NodeList.prototype.forEach=Array.prototype.forEach);var nn=Object.freeze({CLEAN:0,DIRTY:1,FILTHY:2,EVIL:3}),tn=Object.freeze({CLASSIC:0,SLOW:1,PRACTICE:2,FAST:3}),on=Object.freeze({VSHORT:0,SHORT:1,NORMAL:2,LONG:3,VLONG:4}),rn=function(n){function t(e,t){n.setItem(e,t)}function o(e){return n.getItem(e)}function r(e,n){return e+"_"+n.mode+"_"+n.speed+"_"+n.size.rows+"x"+n.size.cols}n=n||e.localStorage;var i="dozen_",s=Object.freeze({VERSION:i+"version",SETTINGS:i+"settings",GRID:i+"grid",TILES:i+"tiles",STATS:i+"stats",RNG:i+"rng",APP_STATE:i+"app_state",TIMES_PLAYED:i+"times_played",HAS_RATED:i+"has_rated"}),c=Object.freeze({VERSION:i+"0",SETTINGS:i+"1",GRID:i+"2",TILES:i+"3",PREV:i+"4",STATS:i+"5",RNG:i+"6",APP_STATE:i+"7",TIMES_PLAYED:i+"8",HAS_RATED:i+"9",HAS_LIKED:i+"10",COINS:i+"11",LAST_TIME:i+"12"});return function(){function e(){var e,t,o,r={};for(e=0,t=n.length;e<t;++e)(o=n.key(e)).startsWith(i)&&(r[o]=n.getItem(o));return r}function r(){var t=e();Object.keys(t).forEach(function(e){var o,r={};e.startsWith(s.STATS)?(o=JSON.parse(t[e]),r.level=o.level,r.lines=r.score={curr:o.score,best:o.best,prev:o.prevBest,isNew:o.isNewBest},t[e]=JSON.stringify(r)):e.startsWith(s.RNG)?((o=JSON.parse(t[e])).i=o.index,delete o.index,t[e]=JSON.stringify(o)):e.startsWith(s.SETTINGS)&&((o=JSON.parse(t[e])).controls=o.altControls||0,delete o.altControls,t[e]=JSON.stringify(o)),Object.keys(s).some(function(o){var r,i;return!!e.startsWith(s[o])&&(i=e.replace(s[o],c[o]),r=t[e],delete t[e],t[i]=r,n.setItem(i,r),n.removeItem(e),!0)})})}var u=+o(c.VERSION);1!==u&&(0===u&&null===o(s.SETTINGS)||function(e){switch(u){case 0:r()}}(),t(c.VERSION,1))}(),{saveGrid:function(e,n){t(r(c.GRID,e),JSON.stringify(n))},loadGrid:function(e){return JSON.parse(o(r(c.GRID,e)))},saveTiles:function(e,n){t(r(c.TILES,e),JSON.stringify(n))},loadTiles:function(e){return JSON.parse(o(r(c.TILES,e)))},saveRngState:function(e,n){t(r(c.RNG,e),JSON.stringify(n))},loadRngState:function(e){return JSON.parse(o(r(c.RNG,e)))},saveStats:function(e,n){t(r(c.STATS,e),JSON.stringify(n))},loadStats:function(e){return JSON.parse(o(r(c.STATS,e)))},savePrev:function(e,n){t(r(c.PREV,e),JSON.stringify(n))},loadPrev:function(e){return JSON.parse(o(r(c.PREV,e)))},hasSavedGame:function(e){return null!==o(r(c.TILES,e))},saveAppState:function(e){t(c.APP_STATE,JSON.stringify(e))},loadAppState:function(){return JSON.parse(o(c.APP_STATE))},clearAppState:function(){n.removeItem(c.APP_STATE)},saveSettings:function(e){t(c.SETTINGS,JSON.stringify(e))},loadSettings:function(){return JSON.parse(o(c.SETTINGS))},loadTimesPlayed:function(e){return+o(c.TIMES_PLAYED+"_"+e.mode)},loadTotalTimesPlayed:function(){return Object.keys(nn).reduce(function(e,n){return e+ +o(c.TIMES_PLAYED+"_"+nn[n])},0)},incTimesPlayed:function(e){t(c.TIMES_PLAYED+"_"+e.mode,this.loadTimesPlayed(e)+1)},saveLastTime:function(e){t(c.LAST_TIME,JSON.stringify(e))},loadLastTime:function(){return JSON.parse(o(c.LAST_TIME))},hasRated:function(e){if(!e)return"true"===o(c.HAS_RATED);t(c.HAS_RATED,e)},hasLiked:function(e){if(!e)return"true"===o(c.HAS_LIKED);t(c.HAS_LIKED,e)},saveCoins:function(e){t(c.COINS,e)},loadCoins:function(){return+o(c.COINS)}}}(),sn={random:function(e,n){return Math.floor(Math.random()*(n-e+1))+e},isPowerOf2:function(e){return e>0&&0==(e&e-1)}},cn={random:function(e){return e[Math.floor(Math.random()*e.length)]},shuffle:function(e){var n,t,o;for(n=e.length-1;n>0;--n)t=Math.floor(Math.random()*(n+1)),o=e[n],e[n]=e[t],e[t]=o},new2d:function(e,n,t){return new Array(e).fill(null).map(function(e){return new Array(n).fill(t)})},make2d:function(e,n,t,o){return e&&e.length&&n===e.length&&t===e[0].length?e.forEach(function(e){e.fill(o)}):e=cn.new2d(n,t,o),e},copy:function(e,n){for(var t=0,o=e.length;t<o;++t)n[t]=e[t];n.length=e.length},copy2d:function(e,n){var t,o,r,i,s,c;for(t=0,r=e.length;t<r;++t)for(s=e[t],c=n[t],o=0,i=s.length;o<i;++o)c[o]=s[o]}};$e("Dozen - Version:","1.5.0"),$e("Welcome! Hope you enjoy! :)\n\n");var un="click",an=function(e){var t=n.createElement("div").style,o="ms Moz Webkit".split(" "),r=o.length,i=e[0].toUpperCase()+e.slice(1);if(e in t)return e;for(;r--;)if((e=o[r]+i)in t)return e}("transform"),ln=function(){var e=n.createElement("div").style,t=["Moz","webkit"],o=t.length;if("perspective"in e)return!0;for(;o--;)if(t[o]+"Perspective"in e)return!0;return!1}(),fn=function(){var e=[];return{invalidate:function(n,t){e=cn.make2d(e,n,t,null)},get:function(n,t){return e[n][t]},set:function(n,t,o){e[n][t]=o}}}(),dn=ln?function(e){return"translate3d("+e.left+"px,"+e.top+"px,0)"}:function(e){return"translate("+e.left+"px,"+e.top+"px)"},hn=1e3/60,pn=hn/1e3,gn=.5,mn=.333,vn=960,Tn={CLEAN:[1,2,3,6],DIRTY:[1,2,3,6],FILTHY:[1,2,3,6],EVIL:[1,2,3,4,6]},Sn=10;r.selector=u,r.defaultEase=Linear.easeNone,r.lagSmoothing(20*hn,2*hn),CSSPlugin.defaultForce3D=!0;var wn=function(){function e(e){return t.css.x=e.left,t.css.y=e.top,t}function n(e,n){return o.css.x=e.left,o.css.y=e.top,o.onComplete=n,o}var t={css:{x:0,y:0}},o={css:{x:0,y:0},onComplete:null};return function(t,o,i,s,c,u){r.set(t,e(O(o,s))),r.to(t,c,n(O(i,s),u))}}(),yn=function(){function e(e){return{css:{x:e.left,y:e.top}}}function n(e,n){return{css:{x:e.left,y:e.top,autoRound:isAndroidStockBrowser},ease:Power1.easeIn,onComplete:n}}return function(t,o,r,i,s,c,u){t.fromTo(o,8*pn*(r-i),e(O(r,s)),n(O(i,s),u),c/1e3)}}(),On=function(){function e(e){return 75*e/1e3}return function(n,t,o){n.add(R(En.get(t,o),O(t,o)),e(o))}}(),bn=function(e){function n(n,t){i=n,s=e.fromTo(i,t/2/1e3,o,r)}function t(){s.kill(),i.style.opacity="",i=s=null}var o={css:{opacity:.999}},r={css:{opacity:.5},repeat:-1,yoyo:!0},i=null,s=null;return{mark:function(e,o){i&&t(),n(e,o)},unmark:function(){i&&t()}}}(TweenMax),En=function(e){function n(e){return"n"+e}function t(e){return".n"+e}function r(e){f(e,"d")}function i(e){l(e,"d")}function s(o){var i=a(t(o)+".d");return i?(r(i),i):((i=u.cloneNode(!0)).removeAttribute("id"),f(i,"hide"),A(i,o),l(i,n(o)),e.appendChild(i),i)}var u=c("base-tile"),d=[];return{init:function(e,n){d=cn.make2d(d,e,n,null)},newTile:function(e){return s(e)},newTileAt:function(e,n,t){return d[e][n]=s(t)},add:function(e,n,t){d[n][t]=e},get:function(e,n){return d[e][n]},update:function(e,n,t,o){d[t][o]=d[e][n],d[e][n]=null},kill:i,killAt:function(e,n){var t=d[e][n];t&&i(t),d[e][n]=null},killAll:function(){o(e).children().addClass("d"),cn.make2d(d,d.length,d[0].length,null)}}}(c("tile-container")),Nn=o("#next"),In={level:0,lines:{curr:0,best:0,prev:0,isNew:!1},score:{curr:0,best:0,prev:0,isNew:!1},continue:!1},Mn={mode:0,speed:0,size:{rows:7,cols:5}},xn={},An={},kn=function(e){function n(n,t){var o,r,i,s=t.length;for(o=n.length===s*(e.size.cols-2)?e.size.cols-1:e.size.cols-2,n.length=s*o,r=0;r<s;++r)for(i=0;i<o;++i)n[r*o+i]=t[r];cn.shuffle(n)}function t(e){return r.i===r.bag.length&&(n(r.bag,e),r.i=0),r.bag[r.i++]}var o,r=Object.seal({bag:[],i:0});return Object.defineProperty({init:function(t,i){return o=t,i?r=Object.seal(i):(r.bag=new Array(o.length*(e.size.cols-2)),n(r.bag,o),r.i=Math.floor(3*Math.random())),this},getNext:function(){return t(o)}},"state",{get:function(){return r}})}(Mn),Cn=null,Rn=[],Pn=0,zn=0,Ln=1,Dn=1,Gn=function(e,n){var t=Date.now()-3e3;return function(){var n=Date.now();n-t<3e3||(t=n,e())}}(V),jn=rn.loadSettings();null===jn?(jn={highlight:c("highlight").checked,countdown:c("countdown").checked,controls:parseInt(a(".control:checked").value,10),sensitivity:o("#sensitivities > .selected").data("option"),size:o("#sizes > .selected").data("option"),speed:o("#speeds > .selected").data("option")},rn.saveSettings(jn)):(F("highlight",c("highlight").checked),F("countdown",c("countdown").checked),c("highlight").checked=jn.highlight,c("countdown").checked=jn.countdown,a('.control[value="'+jn.controls+'"]').checked=!0,W(o("#sensitivities .item"),jn.sensitivity),W(o("#sizes .item"),jn.size),W(o("#speeds .item"),jn.speed)),o(".option").change(function(){switch(this.name){case"controls":jn.controls=parseInt(a(".control:checked").value,10);break;case"highlight":this.checked?Hn.add():Hn.remove(),jn[this.name]=this.checked;break;default:jn[this.name]=this.checked}rn.saveSettings(jn)});var _n=function(e){function n(n){var t=a(".s"+n+".d");return t||(l(t=u.cloneNode(!0),"s"+n),h(t,"+"+n),e.appendChild(t)),f(t,"d"),t}function t(e){h(d,Math.min(In.score.curr,9999999)),K(n(e)),In.score.best<In.score.curr&&(In.score.best=In.score.curr,In.score.isNew&&(In.score.isNew=!1))}function o(){return X(1)}function r(e,n){var t=e.reduce(function(e,t){return e+t/3*n},0);return e.forEach(function(e){e>12&&(t*=e/12)}),t*=e.length,o()&&(t*=2*e.length),t}function i(e){return e.reduce(function(e,n){return e+n/3},0)*Math.pow(e.length,2)}function s(e){return e%3==0?e/3:0}var u=a(".score-mod.d"),d=c("score");return function(e,n){var o;0!==(o=n?r(e,n):0===n?i(e):s(e))&&(In.score.curr+=o,t(o))}}(c("score-mod-container")),Hn=function(e){function n(e,n){return!!(e+1<Rn.length&&B(e+1,n))||!!(n-1>=0&&B(e,n-1))||!!(n+1<Rn[0].length&&B(e,n+1))}function t(n){var t=a(".h"+n+".d");return t||((t=h.cloneNode(!0)).removeAttribute("id"),f(t,"hide"),l(t,"h"+n),e.appendChild(t),t)}function o(e,n,o){var r=t(o);return f(r,"d"),u(r),M(r,e,n),r}function r(e){d(e),l(e,"d")}function i(){var e,t,r=Rn.length,i=Rn[0].length;for(t=0;t<i;++t)for(e=0;e<r&&!B(e,t);++e)ne(Ln,Rn[e][t])&&n(e,t)&&p.push(o(e,t,Rn[e][t]))}function s(){p.forEach(r),p.length=0}var u,d,h=c("base-tile-hl");isAndroidStockBrowser?(u=function(e){e.style.opacity=.999},d=function(e){e.style.opacity=0}):(u=function(e){getComputedStyle(e).opacity,l(e,"h")},d=function(e){f(e,"h")});var p=[];return{add:function(){jn.highlight&&(p.length>0&&s(),i())},remove:function(){jn.highlight&&s()},replace:function(){jn.highlight&&(p.forEach(function(e){l(e,"d")}),p.length=0,i())}}}(c("tile-container")),Yn=-1,Vn=!1,Jn=function(e){function n(e){_n(e.map(function(e){return Rn[e.row][e.col]}),0)}return function(t,o){var r,i=new e({onComplete:fe,onCompleteParams:[t,o]});t.forEach(function(e){r=de(e.row,e.col,this,1)},i),i.call(n,[t],null,r)}}(i),Wn=function(){function e(e,n,t){var o=e[n];e[n]=e[t],e[t]=o}return function(n,t){for(var o=n+t,r=Rn.length;o<r;++o)e(Rn,o,o-t)}}(),Fn=function(){function e(e,n){I(e)&&this.push(n)}return function(n){var t=[];return Rn.forEach(e,t),t.length>0?(Te(t,n),!0):(n?n():se(),!1)}}(),Un=function(){function e(e,n,t){var o=En.newTileAt(e,n,t);return M(o,e,n),o}var n={onComplete:he};return function(t,o){C(e(t,o,Rn[t][o]),O(t,o),n)}}(),Xn=0,Bn=Object.freeze({ADVANCE:0,LEFT:1,RIGHT:2,DOWN:3,DROP:4}),qn=function(){function e(e,n){if(!Vn&&$n===Qn.Playing)for(var t=0,o=e.length;t<o;++t)switch(e[t]){case Bn.ADVANCE:if(Pe())return;break;case Bn.LEFT:if(ke(n[t]))return;break;case Bn.RIGHT:if(Ce(n[t]))return;break;case Bn.DOWN:if(Re(n[t]))return;break;case Bn.DROP:return void Ie()}}var n=[],t=[],o=debounce(function(){e(n,t),n.length=t.length=0});return function(e,r){Vn||$n===Qn.Playing&&(n.length>9&&e!==Bn.ADVANCE||(n.push(e),t.push(r||1),o()))}}(),Kn=function(e,n,t){function o(e,n){e.preventDefault(),n()}function r(e,n){e.preventDefault(),qn(n,1)}function i(e){switch(e.which){case 37:case 65:r(e,Bn.LEFT);break;case 39:case 68:r(e,Bn.RIGHT);break;case 40:case 83:r(e,Bn.DOWN);break;case 38:case 87:case 32:r(e,Bn.DROP)}}function s(e,n,t){return e+Math.trunc((n-e)/t)*t}function u(e,n,t,o){var r,i;return(r=Math.abs(e-N))>t?(i=Math.floor(r/t),e<N?qn(Bn.LEFT,i):qn(Bn.RIGHT,i),void(N=s(N,e,t))):(r=n-I)>o?(qn(Bn.DOWN,Math.floor(r/o)),void(I=s(I,n,o))):void 0}function a(){var n=!1;e("#game-container").on({mousedown:function(e){0===e.button&&(e.preventDefault(),n=!0,N=e.clientX,I=e.clientY)},mousemove:function(e){n&&(e.preventDefault(),u(e.clientX,e.clientY,T,O))},mouseup:function(e){0===e.button&&(e.preventDefault(),n=!1)},mouseout:function(e){e.target===this&&(n=!1)},dblclick:function(e){0===e.button&&(e.preventDefault(),qn(Bn.DROP))}})}function l(e){return e.clientY>2/3*m?Bn.DOWN:e.clientX<g/2?Bn.LEFT:Bn.RIGHT}function f(){qn(C,1),k=setTimeout(f,33.333)}function d(){e("#game-container").on({touchstart:function(e){var n=e.changedTouches[0];e.preventDefault(),e.touches.length>1||(N=Math.round(n.clientX),I=Math.round(n.clientY))},touchmove:function(e){var n=e.changedTouches[0];e.preventDefault(),e.touches.length>1||u(Math.round(n.clientX),Math.round(n.clientY),b,E)},touchend:function(e){var n=e.changedTouches[0],t=Date.now(),o=t-R;e.preventDefault(),e.touches.length>0||(R=t,o>0&&o<=250&&Math.abs(n.clientX-N)<25&&Math.abs(n.clientY-I)<25&&(qn(Bn.DROP),R=0))},touchcancel:function(e){e.preventDefault()}})}function h(){e("#game-container").on({touchstart:function(e){e.preventDefault(),e.touches.length>1||(C=l(e.changedTouches[0]),k=setTimeout(f,350),A.start(e.changedTouches[0]))},touchmove:function(e){var n=l(e.changedTouches[0]);e.preventDefault(),e.touches.length>1||(A.handleMove(e.changedTouches[0])?clearTimeout(k):n!==C&&(clearTimeout(k),C=n,f()))},touchend:function(e){e.preventDefault(),e.touches.length>0||(A.handleSwipe(e.changedTouches[0])===A.DOWN?qn(Bn.DROP):qn(C,1),clearTimeout(k),C=-1)},touchcancel:function(e){e.touches.length>0||(clearTimeout(k),C=-1)}})}function p(e){e?h():d()}var g,m,v=debounce(function(){g=n.innerWidth,m=n.innerHeight});e(v),n.on("resize",v),t.on("keydown",function(e){switch(e.which){case 80:o(e,Ke);break;case 78:o(e,Ze);break;case 8:o(e,qe)}});var T,O,b,E,N=0,I=0,M=debounce(function(){var e,n=c("c-0-0"),t=S(n);jn.sensitivity,e=function(){switch(jn.sensitivity){case on.VSHORT:return.6;case on.SHORT:return.8;default:case on.NORMAL:return 1;case on.LONG:return 1.2;case on.VLONG:return 1.4}}(),T=Math.round(Math.abs(S(c("c-0-1")).left-t.left)*e),O=Math.round(Math.abs(S(c("c-1-0")).top-t.top)*e),e=function(){switch(jn.sensitivity){case on.VSHORT:return.5;case on.SHORT:return.75;default:case on.NORMAL:return.95;case on.LONG:return 1.1;case on.VLONG:return 1.2}}(),b=Math.round(w(n)*e),E=Math.round(y(n)*e)}),x=debounce(M),A=function(){function e(){switch(jn.sensitivity){case on.VSHORT:return 20;case on.SHORT:return 30;default:case on.NORMAL:return 40;case on.LONG:return 60;case on.VLONG:return 80}}var n=0,t=0,o=0,r=0,i=0,s={LEFT:0,RIGHT:1,UP:2,DOWN:3,durationThreshold:550,start:function(e){n=Date.now(),t=Math.round(e.clientX),o=Math.round(e.clientY)},handleMove:function(r){var i,c,u=e();return i=Math.abs(r.clientX-t),c=Math.abs(r.clientY-o),Date.now()-n<s.durationThreshold&&(i>u&&c<u||c>u&&i<u)},handleSwipe:function(c){var u,a,l=e();if(r=c.clientX-t,i=c.clientY-o,u=Math.abs(r),a=Math.abs(i),Date.now()-n<s.durationThreshold){if(u>l&&a<l)return r<0?s.LEFT:s.RIGHT;if(a>l&&u<l)return i<0?s.UP:s.DOWN}}};return s}(),k=-1,C=-1,R=0,P=e("#game");return{add:function(){M(),n.on("resize",M),e("#sensitivity").on(un,x),t.on("keydown",i),a(),P.on("contextmenu",!1),p(jn.controls)},remove:function(){n.off("resize",M),e("#sensitivity").off(un,x),t.off("keydown",i),e("#game-container").off(),P.off("contextmenu")}}}(o,e,n),Zn=function(e){function n(e){return u("#game ."+e)}function t(e){l(e,"paused")}function o(e){f(e,"paused")}function r(e){e.style.opacity=0,l(e,"d")}var i=null;return{pause:function(o){i=e.exportRoot().pause(),o&&n(o).forEach(t)},resume:function(e){i.resume(),i=null,e&&n(e).forEach(o)},clear:function(t){e.exportRoot().kill(),u(".mod:not(.d)").forEach(r),i=null,t&&n(t).forEach(o),Cn&&(Cn.style.opacity=""),Vn=!1}}}(i),Qn=function(){var e=null,n=Object.freeze({enter:s,exit:s,pause:s,resume:s,newGame:s,stop:function(){Qn.goTo(Qn.Stopped),e&&(e.exit(),e=null)}}),r=Object.freeze(o.extend({},n,{effect:null,exit:function(){this.effect.totalProgress(1,!1).kill(),this.effect=null},pause:function(){this.effect.pause()},resume:function(){this.effect.resume()}})),i=Object.freeze(o.extend({},n,{enter:function(){Zn.resume("anim"),Qn.pop(),$n.resume()}}));return Object.freeze({goTo:function(e,n){$n.exit(),($n=e).enter(n)},push:function(n,t){e=$n,($n=n).enter(t)},pop:function(){$n.exit(),$n=e,e=null},Tutorial:Object.freeze(o.extend({},n,{enter:function(){t(function(){function e(){Qn.goTo(Qn.Start)}function n(e,n){return function(){e-1>=0&&m("tutorial-"+(e-1)),g("tutorial-"+e),o("#ok-"+e).off(un).on(un,n)}}var t=n(2,e),r=n(1,function(){0===rn.loadTotalTimesPlayed()?t():e()}),i=o("#game").find(".tutorial");i.find(".mode").addClass("hide"),i.find(".m"+Mn.mode).removeClass("hide"),Mn.speed===tn.CLASSIC?i.find(".speed.classic").removeClass("hide"):i.find(".speed.classic").addClass("hide"),n(0,r)()})},exit:function(){u(".tutorial").forEach(function(e){m(e.id)}),Zn.clear("anim2")},pause:function(){Zn.pause("anim2")},resume:function(){Zn.resume("anim2")}})),Stopped:Object.freeze(o.extend({},n)),Start:Object.freeze(o.extend({},n,function(){function e(){t=-1,se(),rn.incTimesPlayed(Mn),Qn.goTo(Qn.Playing)}function n(){clearTimeout(t)}var t=-1;return{enter:function(n){n?t=setTimeout(e,n):e()},exit:n,pause:n,resume:function(){t=setTimeout(e,vn/2)}}}())),Loading:Object.freeze(o.extend({},n,{enter:function(){Qn.goTo(Qn.Resuming,Qn.Resume)}})),Resume:Object.freeze(o.extend({},n,{enter:function(){bn.mark(Cn,ee()),Yn=setTimeout(ze,ee()),Qn.goTo(Qn.Playing)}})),Playing:Object.freeze(o.extend({},n,{_clear:function(){Kn.remove(),bn.unmark(),clearTimeout(Yn),J()},enter:function(){Kn.add()},exit:function(){this._clear(),Zn.clear("anim")},pause:function(){this._clear(),Qn.push(Qn.Paused,Qn.ResumedPlaying)},resume:function(){Kn.add()},newGame:function(){this.pause(),Qn.goTo(Qn.New,Qn.ResumedPlaying)}})),Powerup:Object.freeze(o.extend({},n,{enter:function(){Hn.remove()},exit:function(){Hn.add()},pause:function(){Qn.push(Qn.Paused,Qn.Resumed)},newGame:function(){this.pause(),Qn.goTo(Qn.New,Qn.Resumed)}})),Paused:Object.seal(o.extend({},n,{pausedState:null,enter:function(e){this.pausedState=e,Zn.pause("anim")},exit:function(){this.pausedState=null},resume:function(){Qn.goTo(Qn.Resuming,this.pausedState)}})),Resumed:Object.freeze(o.extend({},i)),ResumedPlaying:Object.freeze(o.extend({},i,{enter:function(){Vn||(bn.mark(Cn,ee()),Yn=setTimeout(ze,ee())),i.enter()}})),Resuming:Object.freeze(o.extend({},n,function(){function e(){var e=3;!function n(){0!==e?(h(c("resume-countdown"),e--),s=setTimeout(n,i)):Qn.goTo(r)}(),g("resume")}function n(e,n){return e-Math.floor(e/n)*n}function t(){jn.countdown&&(clearTimeout(s),-1===u?bn.unmark():(clearTimeout(u),u=-1),m("resume"))}function o(){jn.countdown?(e(),Vn||(u=setTimeout(function(){bn.mark(Cn,ee()),u=-1},n(3*i,ee())))):Qn.goTo(r)}var r,i=800,s=-1,u=-1;return{enter:function(e){r=e,o()},exit:function(){r=null,t()},pause:t,resume:o,newGame:function(){Qn.goTo(Qn.New,r)}}}())),Restarting:Object.seal(o.extend({},r,{enter:function(){var e=c("grid");r.enter(),Math.random()<.5?this.effect=P(e,750,We):this.effect=L(e,750,We)}})),Ending:Object.seal(o.extend({},r,{enter:function(){r.enter(),Hn.remove(),bn.unmark(),this.effect=z(c("grid"),750,function(){Qn.goTo(Qn.End)})}})),End:Object.freeze(o.extend({},n,{enter:function(e){var n,t=o("#msg-container");(n=o("#game-over > .msg").addClass("hide")).eq(Math.floor(Math.random()*n.length)).removeClass("hide"),t.find(".msg").addClass("hide"),In.score.prev<In.score.best?n=t.find(".high-score"):(n=t.find(".share"),Math.random()<.5&&n.add(t.find(".like"))),n.eq(Math.floor(Math.random()*n.length)).removeClass("hide"),e?g("end"):o("#end").fadeIn()},exit:function(){m("end")},newGame:function(){Qn.goTo(Qn.Restarting)}})),New:Object.seal(o.extend({},n,{pausedState:null,enter:function(e){this.pausedState=e,g("confirm")},exit:function(){this.pausedState=null,m("confirm")},new:function(){this.stop(),Qn.goTo(Qn.Restarting)},continue:function(){Qn.goTo(Qn.Resuming,this.pausedState)}}))})}(),$n=Qn.Stopped;e.on("resize",debounce(function(){et!==it&&et!==st||(fn.invalidate(Mn.size.rows,Mn.size.cols),Ge(),Hn.replace())}));var et,nt=function(){var n=!1,t=!1;return e.history?(history.state&&history.replaceState(null,""),e.onpopstate=function(e){if(t)t=!1;else{if(n=!0,e.state)switch(e.state.section,e.state.section){case"help":et.goToOther("help");break;case"about":et.goToOther("about");break;case"game":et.goToGame();break;case"options":et.goToOptions();break;default:en("Unknown history state!")}else et.goToMenu();n=!1}},{push:function(e){n||(e.toLowerCase(),history.pushState({section:e.toLowerCase()},e))},pop:function(){n||(t=!0,history.back())}}):{push:s,pop:s}}(),tt=Object.freeze({goToOptions:s,goToMenu:s,goToGame:s,goToOther:s,enter:s,exit:s}),ot=Object.seal(o.extend({},tt,{section:"",goToMenu:function(){Be(rt)},enter:function(e){switch(ot.section=e,g(ot.section),nt.push(e),e){case"help":t(v)}},exit:function(){m(ot.section),nt.pop()}})),rt=Object.freeze(o.extend({},tt,{goToOther:function(e){Be(ot,e)},goToGame:function(){Be(it,!0)},enter:function(){g("menu")},exit:function(){m("menu")}})),it=Object.freeze(o.extend({},tt,{goToMenu:function(){Fe(),m("game"),Be(rt),nt.pop()},goToOptions:function(){Ue(),Be(st)},enter:function(e){e?(g("game"),Je()):Xe(),nt.push("Game")},exit:function(){}})),st=Object.freeze(o.extend({},tt,{goToMenu:function(){Be(it),it.goToMenu()},goToGame:function(){Be(it)},enter:function(){g("options"),c("pause-resume").classList.replace("pause","resume"),nt.push("Options")},exit:function(){jn=rn.loadSettings(),nt.pop(),c("pause-resume").classList.replace("resume","pause"),m("options")}}));et=rt,o(function(){function e(e,n){var t="selected";return function(o,r){var i=o.find("."+t).removeClass(t)[e]();0===i.length&&(i=o.children()[n]()),jn[r]=i.addClass(t).data("option"),rn.saveSettings(jn)}}o("#daily .ok").on(un,function(){p(c("daily"))}),o("#welcomeback .ok").on(un,function(){p(c("welcomeback"))}),o(".home-button").on(un,qe),o("#pause-resume").on(un,Ke),o("#new").on(un,Ze),o("#restart").on(un,function(){$n.newGame()}),o("#confirm .no").on(un,function(){$n.continue()}),o("#confirm .yes").on(un,function(){$n.new()});var n=e("prev","last"),t=e("next","first");o("#size-left").on(un,function(){n(o("#sizes"),"size")}),o("#size-right").on(un,function(){t(o("#sizes"),"size")}),o("#speed-left").on(un,function(){n(o("#speeds"),"speed")}),o("#speed-right").on(un,function(){t(o("#speeds"),"speed")}),o("#sensitivity").on(un,function(){t(o("#sensitivities"),"sensitivity")})}),o(function(){Qe(),o("#other .nav-button").on(un,function(){et.goToOther(this.name)}),o(".play-button").on(un,function(){var e=o("#sizes > .selected").data("option").split("x"),n=+e[0],t=+e[1];o("#grid").removeClass("col"+Mn.size.cols),Mn.mode=o(this).data("mode"),Mn.speed=o("#speeds > .selected").data("option"),Mn.size.rows=n,Mn.size.cols=t,Mn.mode,Mn.speed,et.goToGame()}),o(e).blur(function(){et===it&&$n!==Qn.End&&et.goToOptions()}),o(e).unload(function(){et===it&&$n===Qn.Playing&&J()})})}(window,document,requestAnimationFrame,Zepto,TweenLite,TimelineLite);