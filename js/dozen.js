!function(e,n,t,o,i){"use strict";function r(){}function s(e){return n.getElementById(e)}function c(e){return n.querySelectorAll(e)}function a(e){return n.querySelector(e)}function u(e,n){var t=Date.now()-n;return function(){var o=Date.now();o-t<n||(t=o,e())}}function l(e,n){return Math.floor(Math.random()*(n-e+1))+e}function f(e){return e>0&&0==(e&e-1)}function d(e){var n,t,o;for(n=e.length-1;n>0;--n)t=Math.floor(Math.random()*(n+1)),o=e[n],e[n]=e[t],e[t]=o}function h(e,n,t){return new Array(e).fill(null).map(function(e){return new Array(n).fill(t)})}function p(e,n,t,o){return e&&e.length&&n===e.length&&t===e[0].length?e.forEach(function(e){e.fill(o)}):e=h(n,t,o),e}function g(e,n){for(var t=0,o=e.length;t<o;++t)n[t]=e[t];n.length=e.length}function v(e,n){var t,o,i,r,s,c;for(t=0,i=e.length;t<i;++t)for(s=e[t],c=n[t],o=0,r=s.length;o<r;++o)c[o]=s[o]}function m(){function n(e,n){var t={};return t.slidesPerView=e,t.breakpoints={},n.forEach(function(e){t.breakpoints[e[0]]={slidesPerView:e[1]}}),t}var o=s("carousel-modes");if(o.classList.contains("initialized"))o.classList.contains("resize")&&(s("carousel-modes").swiper.update(),s("carousel-controls").swiper.update(),s("carousel-speeds").swiper.update(),o.classList.remove("resize"));else{o.classList.add("initialized"),e.MutationObserver||e.addEventListener("resize",debounce(function(){o.classList.add("resize")}));var i={grabCursor:!0,roundLengths:!0,watchOverflow:!0,longSwipesRatio:.25,resistanceRatio:.8,slideToClickedSlide:!0,observer:!0,observeParents:!0,setWrapperSize:!0,runCallbacksOnInit:!1,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}};new Swiper("#carousel-modes",t.extend(i,n(3,[[500,1],[820,2]]))),new Swiper("#carousel-controls",t.extend(i,n(3,[[550,1],[800,2]]))),new Swiper("#carousel-speeds",t.extend(i,n(4,[[600,1],[1280,2],[1920,3]])))}}function T(e,n){return"c-"+e+"-"+n}function w(e){var n=e.getBoundingClientRect(),t=e.offsetParent.getBoundingClientRect();return{top:n.top-t.top,left:n.left-t.left}}function S(e){return e.getBoundingClientRect().width}function y(e){return e.getBoundingClientRect().height}function b(e,n){var t=F.get(e,n);return t||(t=w(s(T(e,n))),F.set(e,n,t),t)}function O(e){return Math.round(Math.log2(e))}function E(e){return e>0&&e%12==0}function x(e){for(var n=0,t=e.length;n<t;++n)if(e[n]!==e[0])return!1;return!0}function L(e){return e.every(E)&&x(e)}function N(e,n,t){e.style[W]=U(b(n,t))}function C(e){return e>=4&&f(e)?4:e>=12?12*Math.pow(2,O(e/12)%3):e}function k(e,n){e.classList.add("t"+C(n)),n>=100&&e.classList.add("large"),e.textContent=n}function z(e,n,t){if(t){if(n===t)return;e.children().filter(".t"+n).removeClass("dead").end().filter(".t"+t).addClass("dead")}else e.children().addClass("dead").filter(".t"+n).removeClass("dead")}function M(e,n,t){return new i(t).set(e,{css:{x:n.left,y:n.top,scale:1}}).to(e,.25*q,{css:{scale:.82},ease:Power1.easeInOut}).to(e,.5*q,{css:{scale:1.16},ease:Power1.easeInOut}).to(e,.25*q,{css:{scale:1},ease:Power1.easeInOut})}function A(e,n){return(new i).set(e,{css:{x:n.left,y:n.top,scale:1,rotation:0}}).to(e,.25*X,{css:{scale:1.22,rotation:0}}).to(e,.75*X,{css:{scale:0,rotation:720}})}function I(e,n,t,o,i){e.add(M(n,b(t,o)),i)}function R(e){function n(n,t){var o,i,r,s=t.length;for(o=n.length===s*(e.size.cols-2)?e.size.cols-1:e.size.cols-2,n.length=s*o,i=0;i<s;++i)for(r=0;r<o;++r)n[i*o+r]=t[i];d(n)}function t(e){return i.i===i.bag.length&&(n(i.bag,e),i.i=0),i.bag[i.i++]}var o,i=Object.seal({bag:[],i:0});return Object.defineProperty({init:function(t,r){return o=t,r?i=Object.seal(r):(i.bag=new Array(o.length*(e.size.cols-2)),n(i.bag,o),i.i=Math.floor(3*Math.random())),this},getNext:function(){return t(o)}},"state",{get:function(){return i}})}function P(e){switch(e){case j.FILTHY:return K.FILTHY;case j.DIRTY:return K.DIRTY;default:case j.CLEAN:return K.CLEAN}}var D=function(){Function.prototype.apply.call(console.info,console,arguments)},G=function(){Function.prototype.apply.call(console.warn,console,arguments)};void 0===String.prototype.startsWith&&(G('Undefined "String.prototype.startsWith". Using incomplete polyfill...'),String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),Math.trunc||(G('Undefined "Math.trunc". Using polyfill.'),Math.trunc=function(e){return e>0?Math.floor(e):Math.ceil(e)}),Math.log2||(G('Undefined "Math.log2". Polyfill returns imprecise values on some inputs!'),Math.log2=function(e){return Math.log(e)*Math.LOG2E}),Array.prototype.fill||(G('Undefined "Array.prototype.fill". Using bad polyfill!'),Object.defineProperty(Array.prototype,"fill",{value:function(e){for(var n=0;n<this.length;++n)this[n]=e;return this}})),e.NodeList&&!NodeList.prototype.forEach&&(G('Undefined "NodeList.prototype.forEach". Using Array.prototype.forEach.'),NodeList.prototype.forEach=Array.prototype.forEach);var j=Object.freeze({CLEAN:0,DIRTY:1,FILTHY:2,EVIL:3}),H=Object.freeze({CLASSIC:0,SLOW:1,PRACTICE:2,FAST:3}),_=Object.freeze({VSHORT:0,SHORT:1,NORMAL:2,LONG:3,VLONG:4}),V=function(n){function t(e,t){n.setItem(e,t)}function o(e){return n.getItem(e)}function i(e,n){return e+"_"+n.mode+"_"+n.speed+"_"+n.size.rows+"x"+n.size.cols}n=n||e.localStorage;var r="dozen_",s=Object.freeze({VERSION:r+"version",SETTINGS:r+"settings",GRID:r+"grid",TILES:r+"tiles",STATS:r+"stats",RNG:r+"rng",APP_STATE:r+"app_state",TIMES_PLAYED:r+"times_played",HAS_RATED:r+"has_rated"}),c=Object.freeze({VERSION:r+"0",SETTINGS:r+"1",GRID:r+"2",TILES:r+"3",PREV:r+"4",STATS:r+"5",RNG:r+"6",APP_STATE:r+"7",TIMES_PLAYED:r+"8",HAS_RATED:r+"9"});return function(){function e(){var e,t,o,i={};for(e=0,t=n.length;e<t;++e)(o=n.key(e)).startsWith(r)&&(i[o]=n.getItem(o));return i}function i(){var t=e();Object.keys(t).forEach(function(e){var o,i={};e.startsWith(s.STATS)?(o=JSON.parse(t[e]),i.level=o.level,i.lines=i.score={curr:o.score,best:o.best,prev:o.prevBest,isNew:o.isNewBest},t[e]=JSON.stringify(i)):e.startsWith(s.RNG)?((o=JSON.parse(t[e])).i=o.index,delete o.index,t[e]=JSON.stringify(o)):e.startsWith(s.SETTINGS)&&((o=JSON.parse(t[e])).controls=o.altControls||0,delete o.altControls,t[e]=JSON.stringify(o)),Object.keys(s).some(function(o){var i,r;return!!e.startsWith(s[o])&&(r=e.replace(s[o],c[o]),i=t[e],delete t[e],t[r]=i,n.setItem(r,i),n.removeItem(e),!0)})})}var a=+o(c.VERSION);1!==a&&(0===a&&null===o(s.SETTINGS)||function(e){switch(a){case 0:i()}}(),t(c.VERSION,1))}(),{saveGrid:function(e,n){t(i(c.GRID,e),JSON.stringify(n))},loadGrid:function(e){return JSON.parse(o(i(c.GRID,e)))},saveTiles:function(e,n){t(i(c.TILES,e),JSON.stringify(n))},loadTiles:function(e){return JSON.parse(o(i(c.TILES,e)))},saveRngState:function(e,n){t(i(c.RNG,e),JSON.stringify(n))},loadRngState:function(e){return JSON.parse(o(i(c.RNG,e)))},saveStats:function(e,n){t(i(c.STATS,e),JSON.stringify(n))},loadStats:function(e){return JSON.parse(o(i(c.STATS,e)))},savePrev:function(e,n){t(i(c.PREV,e),JSON.stringify(n))},loadPrev:function(e){return JSON.parse(o(i(c.PREV,e)))},hasSavedGame:function(e){return null!==o(i(c.TILES,e))},saveAppState:function(e){t(c.APP_STATE,JSON.stringify(e))},loadAppState:function(){return JSON.parse(o(c.APP_STATE))},clearAppState:function(){n.removeItem(c.APP_STATE)},saveSettings:function(e){t(c.SETTINGS,JSON.stringify(e))},loadSettings:function(){return JSON.parse(o(c.SETTINGS))},loadTimesPlayed:function(e){return+o(c.TIMES_PLAYED+"_"+e.mode)},loadTotalTimesPlayed:function(){return Object.keys(j).reduce(function(e,n){return e+ +o(c.TIMES_PLAYED+"_"+j[n])},0)},incTimesPlayed:function(e){t(c.TIMES_PLAYED+"_"+e.mode,this.loadTimesPlayed(e)+1)}}}();!function(){function e(e,n){e.filter(".selected").removeClass("selected"),e.filter('[data-option="'+n+'"]').addClass("selected")}var n=V.loadSettings();null!==n&&(e(t("#sensitivities .item"),n.sensitivity),e(t("#sizes .item"),n.size),e(t("#speeds .item"),n.speed))}(),D("Dozen - Version:","1.4.1"),D("Welcome! Hope you enjoy! :)\n\n");var Y=isAndroidStockBrowser?"tap":"tap click",W=function(e){var t=n.createElement("div").style,o="ms Moz Webkit".split(" "),i=o.length,r=e[0].toUpperCase()+e.slice(1);if(e in t)return e;for(;i--;)if((e=o[i]+r)in t)return e}("transform"),J=function(){var e=n.createElement("div").style,t=["Moz","webkit"],o=t.length;if("perspective"in e)return!0;for(;o--;)if(t[o]+"Perspective"in e)return!0;return!1}(),F=function(){var e=[];return{invalidate:function(n,t){e=p(e,n,t,null)},get:function(n,t){return e[n][t]},set:function(n,t,o){e[n][t]=o}}}(),U=J?function(e){return"translate3d("+e.left+"px,"+e.top+"px,0)"}:function(e){return"translate("+e.left+"px,"+e.top+"px)"},B=1e3/60/1e3,X=.5,q=.333,Z=960,K={CLEAN:[1,2,3,6],DIRTY:[1,2,3,6],FILTHY:[1,2,3,6],EVIL:[1,2,3,4,6]},Q=10;o.selector=c,o.defaultEase=Linear.easeNone,o.lagSmoothing(333,1e3/60*2),CSSPlugin.defaultForce3D=!0;var $=function(){function e(e){return t.css.x=e.left,t.css.y=e.top,t}function n(e,n){return i.css.x=e.left,i.css.y=e.top,i.onComplete=n,i}var t={css:{x:0,y:0}},i={css:{x:0,y:0},onComplete:null};return function(t,i,r,s,c,a){o.set(t,e(b(i,s))),o.to(t,c,n(b(r,s),a))}}(),ee=function(){function e(e){return{css:{x:e.left,y:e.top}}}function n(e,n){return{css:{x:e.left,y:e.top,autoRound:isAndroidStockBrowser},ease:Power1.easeIn,onComplete:n}}return function(t,o,i,r,s,c,a){t.fromTo(o,8*B*(i-r),e(b(i,s)),n(b(r,s),a),c/1e3)}}(),ne=function(){function e(e){return 75*e/1e3}return function(n,t,o){n.add(A(oe.get(t,o),b(t,o)),e(o))}}(),te=function(e){function n(n,t){r=n,s=e.fromTo(r,t/2/1e3,o,i)}function t(){s.kill(),r.style.opacity="",r=s=null}var o={css:{opacity:.999}},i={css:{opacity:.5},onComplete:function(){s.reverse()},onReverseComplete:function(){s.play()}},r=null,s=null;return{mark:function(e,o){r&&t(),n(e,o)},unmark:function(){r&&t()}}}(o),oe=function(e,n){function o(e){return"n"+e}function i(e){return".n"+e}function r(e){e.classList.remove("d")}function s(e){e.classList.add("d")}function c(t){var s=a(i(t)+".d");return s?(r(s),s):((s=n.cloneNode(!0)).removeAttribute("id"),s.classList.remove("base-tile"),k(s,t),s.classList.add(o(t)),e.appendChild(s),s)}var u=[];return{init:function(e,n){u=p(u,e,n,null)},newTile:function(e){return c(e)},newTileAt:function(e,n,t){return u[e][n]=c(t)},add:function(e,n,t){u[n][t]=e},get:function(e,n){return u[e][n]},update:function(e,n,t,o){u[t][o]=u[e][n]},kill:s,killAt:function(e,n){s(u[e][n])},killAll:function(){t(e).children().addClass("d")}}}(s("tile-container"),s("base-tile"));!function(e,n,t,o,i,f){function d(e){rn.row=ln,rn.col=fn,e&&(rn.level=tn.level,rn.lines=tn.lines.curr,rn.score=tn.score.curr,rn.tile=dn,rn.next=hn,v(un,rn.grid),g(cn.state.bag,rn.rng.bag),rn.rng.i=cn.state.i)}function h(){(rn={level:0,lines:0,score:0,tile:1,next:1,row:0,col:0,grid:[],rng:{}}).grid=p(rn.grid,on.size.rows,on.size.cols,0),t.extend(!0,rn.rng,cn.state),d(!0)}function T(){h(),sn=t.extend(!0,{},rn)}function O(){var e=sn;sn=rn,rn=e,d(!0)}function E(){V.saveStats(on,tn),V.saveGrid(on,un),V.saveTiles(on,{tile:dn,next:hn,row:ln,col:fn}),V.saveRngState(on,cn.state),V.savePrev(on,sn)}function x(){var e;if(wn)return e=t.extend(!0,{},tn),e.level=rn.level,e.lines.curr=rn.lines,e.score.curr=rn.score,V.saveStats(on,e),V.saveGrid(on,rn.grid),V.saveTiles(on,{tile:rn.tile,next:rn.next,row:rn.row,col:rn.col}),V.saveRngState(on,rn.rng),void V.savePrev(on,rn);E()}function C(e,n){e in gn||(gn[e]=n,V.saveSettings(gn))}function k(){this.classList.add("dead")}function A(e){o.set(e,{css:{y:0,opacity:1}}),o.to(e,1.5,{css:{transform:"translateY(-1.5em)",opacity:0},ease:Power1.easeInOut,onComplete:k,onCompleteScope:e})}function D(e,n){var t=s(e);return t.textContent=n,t.classList.remove("dead"),t}function W(e){var n;tn.lines.curr+=e,s("lines").textContent=tn.lines.curr,A(D("line-mod","+"+e)),tn.lines.best<tn.lines.curr&&(tn.lines.best=tn.lines.curr,tn.lines.isNew&&(tn.lines.isNew=!1)),tn.lines.curr>=(tn.level+1)*Q&&(n=Math.floor(tn.lines.curr/Q),s("level").textContent=n,A(D("level-mod","+"+(n-tn.level))),tn.level=n)}function J(e,n,t){switch(e){default:case H.CLASSIC:return n-tn.level*t;case H.FAST:return n-9*t;case H.SLOW:return n-3*t;case H.PRACTICE:return Z}}function U(){var e=on.size.rows-1,n=6*Z/e,t=Math.round(333/e);return Math.max(J(on.speed,n,(n-t)/13),t)}function X(e,n){return 0===un[e][n]}function q(e,n){switch(on.mode){case j.CLEAN:return e+n===3||e===n&&e>=3;case j.DIRTY:return e+n===3||e===n&&2!==e;case j.FILTHY:return e+n===3||e===n;default:throw new Error("Invalid mode!")}}function K(){var e=un.length-1,n=Math.floor(un[0].length/2),t=un[e][n];return 0===t||q(t,hn)}function ie(){N(an,ln,fn)}function re(){wn=!1,Tn=setTimeout(Me,U()),pn()}function se(){clearTimeout(Tn)}function ce(){if(!K())return Mn.goTo(Mn.Transition,"End"),void x();ln=un.length-1,fn=Math.floor(un[0].length/2),dn=hn,hn=cn.getNext(),z(nn,hn,dn),O(),an=oe.newTile(dn),te.mark(an,U()),ie(),mn.add(),X(ln,fn)?re():me()}function ae(){un[ln][fn]=dn,oe.add(an,ln,fn)}function ue(){ae(),ce()}function le(){var e,n,t=un.length-1,o=un[0].length;for(Sn.length=0,n=0;n<o;++n)for(e=0;e<t&&!X(e+1,n);++e)if(q(un[e][n],un[e+1][n])){Sn.push({row:e,col:n});break}return Sn.length>0?(bn(),!0):(En(),!1)}function fe(e,n){var t=un[e];un[e]=un[n],un[n]=t}function de(){for(var e=On[On.length-1]+1,n=On[0],t=un.length;e<t;)fe(n++,e++);le()}function he(){var e,n,t,o,r,s=un.length,c=un[0].length;for(e=new i({onComplete:de}),t=0;t<c;++t)for(r=On[0],o=On[On.length-1]+1,n=(16.666*t+l(0,100))*(o-r);o<s&&!X(o,t);++o,++r)ee(e,oe.get(o,t),o,r,t,n),oe.update(o,t,r,t),n+=33.333}function pe(){var e=0,n=[];On.forEach(function(t){for(var o=0,i=un[0].length;o<i;++o)oe.killAt(t,o);e+=un[t][0]/12,n.push(un[t][0]),un[t].fill(0)}),W(e),vn(n,on.size.cols),he()}function ge(){var e=new i({onComplete:pe});On.forEach(function(n){for(var t=0,o=un[0].length;t<o;++t)ne(e,n,t)})}function ve(){mn.remove(),te.unmark(),oe.kill(an),oe.killAt(ln,fn),un[ln][fn]+=dn,vn(un[ln][fn]),xn(ln,fn)}function me(){wn=!0,ve()}function Te(){mn.remove(),ln=Ln}function we(){Te(),ue()}function Se(){Te(),ve()}function ye(e){$(an,ln,Ln,fn,e,we)}function be(e){an.style.zIndex="1",oe.get(Ln,fn).style.zIndex="0",$(an,ln,Ln,fn,e,Se)}function Oe(){var e;if(!wn)if(wn=!0,se(),d(),te.unmark(),0!==ln&&(X(ln-1,fn)||q(dn,un[ln-1][fn]))){for(e=ln-1;e>=0&&X(e,fn);--e);e<0||!q(dn,un[e][fn])?ye(B*(ln-(Ln=e+1))):be(B*(ln-(Ln=e)))}else ue()}function Ee(e,n,t){d(),ln=e,fn=n,t()}function xe(e,n){return X(e,n)?(Ee(e,n,ie),!0):!!q(dn,un[e][n])&&(Ee(e,n,me),se(),!1)}function Le(e,n,t){do{if(!xe(ln+e,fn+n))break}while(--t>0);return wn}function Ne(e){return 0!==fn&&Le(0,-1,Math.min(e,fn))}function Ce(e){return fn!==un[0].length-1&&Le(0,1,Math.min(e,un[0].length-1-fn))}function ke(e){return 0!==ln&&Le(-1,0,Math.min(e,ln))}function ze(){return 0===ln?(ue(),!0):(d(),X(ln-1,fn)?(--ln,ie(),re(),!1):q(dn,un[ln-1][fn])?(--ln,me(),!0):(ue(),!0))}function Me(){on.speed!==H.PRACTICE&&Cn(Nn.ADVANCE)}function Ae(e,n,t){function o(e,n){e.preventDefault(),n()}function i(e,n){e.preventDefault(),Cn(n,1)}function r(e){switch(e.which){case 37:case 65:i(e,Nn.LEFT);break;case 39:case 68:i(e,Nn.RIGHT);break;case 40:case 83:i(e,Nn.DOWN);break;case 38:case 87:case 32:i(e,Nn.DROP)}}function c(e,n,t){return e+Math.trunc((n-e)/t)*t}function u(e,n,t,o){var i,r;return(i=Math.abs(e-C))>t?(r=Math.floor(i/t),e<C?Cn(Nn.LEFT,r):Cn(Nn.RIGHT,r),void(C=c(C,e,t))):(i=n-k)>o?(Cn(Nn.DOWN,Math.floor(i/o)),void(k=c(k,n,o))):void 0}function l(){var n=!1;e("#game-container").on({mousedown:function(e){0===e.button&&(e.preventDefault(),n=!0,C=e.clientX,k=e.clientY)},mousemove:function(e){n&&(e.preventDefault(),u(e.clientX,e.clientY,E,x))},mouseup:function(e){0===e.button&&(e.preventDefault(),n=!1)},mouseout:function(e){e.target===this&&(n=!1)},dblclick:function(e){0===e.button&&(e.preventDefault(),Cn(Nn.DROP))}})}function f(e){return e.clientY>5/8*b?Nn.DOWN:e.clientX<=T/2?Nn.LEFT:Nn.RIGHT}function d(){Cn(R,1),I=setTimeout(d,33.333)}function h(){e("#game-container").on({touchstart:function(e){var n=e.changedTouches[0];e.preventDefault(),e.touches.length>1||(C=Math.round(n.clientX),k=Math.round(n.clientY))},touchmove:function(e){var n=e.changedTouches[0];e.preventDefault(),e.touches.length>1||u(Math.round(n.clientX),Math.round(n.clientY),L,N)},"touchend touchcancel":function(e){e.preventDefault()},doubleTap:function(){Cn(Nn.DROP)}})}function p(){e("#game-container").on({touchstart:function(e){e.preventDefault(),e.touches.length>1||(R=f(e.changedTouches[0]),I=setTimeout(d,350),A.start(e.changedTouches[0]))},touchmove:function(e){var n=f(e.changedTouches[0]);e.preventDefault(),e.touches.length>1||(A.handleMove(e.changedTouches[0])?clearTimeout(I):n!==R&&(clearTimeout(I),R=n,d()))},touchend:function(e){e.preventDefault(),e.touches.length>0||(A.handleSwipe(e.changedTouches[0])===A.DOWN?Cn(Nn.DROP):Cn(R,1),clearTimeout(I),R=-1)},touchcancel:function(e){e.touches.length>0||(clearTimeout(I),R=-1)}})}function g(e){e?p():h()}function v(){e("#game-container").off("touchstart touchmove touchend touchcancel doubleTap")}function m(e){v(),g(e)}var T,b,O=debounce(function(){T=n.innerWidth,b=n.innerHeight});O(),n.addEventListener("resize",O),t.addEventListener("keydown",function(e){switch(e.which){case 80:o(e,Qe);break;case 78:o(e,$e);break;case 8:o(e,Ke)}});var E,x,L,N,C=0,k=0,z=debounce(function(){var e,n=s("c-0-0"),t=w(n);gn.sensitivity,e=function(){switch(gn.sensitivity){case _.VSHORT:return.6;case _.SHORT:return.8;default:case _.NORMAL:return 1;case _.LONG:return 1.2;case _.VLONG:return 1.4}}(),E=Math.round(Math.abs(w(s("c-0-1")).left-t.left)*e),x=Math.round(Math.abs(w(s("c-1-0")).top-t.top)*e),e=function(){switch(gn.sensitivity){case _.VSHORT:return.5;case _.SHORT:return.75;default:case _.NORMAL:return.95;case _.LONG:return 1.1;case _.VLONG:return 1.2}}(),L=Math.round(S(n)*e),N=Math.round(y(n)*e)}),M=debounce(z),A=function(){function e(){switch(gn.sensitivity){case _.VSHORT:return 20;case _.SHORT:return 30;default:case _.NORMAL:return 40;case _.LONG:return 60;case _.VLONG:return 80}}var n=0,t=0,o=0,i=0,r=0,s={LEFT:0,RIGHT:1,UP:2,DOWN:3,durationThreshold:550,start:function(e){n=Date.now(),t=Math.round(e.clientX),o=Math.round(e.clientY)},handleMove:function(i){var r,c,a=e();return r=Math.abs(i.clientX-t),c=Math.abs(i.clientY-o),Date.now()-n<s.durationThreshold&&(r>a&&c<a||c>a&&r<a)},handleSwipe:function(c){var a,u,l=e();if(i=c.clientX-t,r=c.clientY-o,a=Math.abs(i),u=Math.abs(r),Date.now()-n<s.durationThreshold){if(a>l&&u<l)return i<0?s.LEFT:s.RIGHT;if(u>l&&a<l)return r<0?s.UP:s.DOWN}}};return s}(),I=-1,R=-1;return{add:function(){z(),n.addEventListener("resize",z),e("#sensitivity").on(Y,M),t.addEventListener("keydown",r),l(),en.on("contextmenu",!1),g(gn.controls),e("#controls").on("change","input",function(){m(parseInt(a("#controls input:checked").value,10))})},remove:function(){n.removeEventListener("resize",z),e("#sensitivity").off(Y,M),t.removeEventListener("keydown",r),e("#game-container").off(),en.off("contextmenu"),e("#controls").off("change")}}}function Ie(e){function n(e,n){e.style.width=n+"px"}var t,o,i,r=e[0];r.style.width="",t=e.find(".r0").children(":not(.hide)").get().map(S),o=Math.max.apply(null,t),(i=t.reduce(function(e,n){return e+(o-n)},0))>0&&n(r,S(r)+i),c(".tile-container").forEach(function(e){n(e,S(r))})}function Re(e){function n(e,n,t){var o,i="",r=n-1;for(o=e-1;o<r;++o)i+=t+o+",";return i+t+o}e.find(n(5,on.size.rows,".r")).removeClass("hide"),e.find(n(5,on.size.cols,".c")).removeClass("hide"),e.find(n(on.size.rows+1,11,".r")).addClass("hide"),e.find(n(on.size.cols+1,9,".c")).addClass("hide"),Ie(e)}function Pe(){var e=S(s("c-0-0"))+"px";c(".t, .hl").forEach(function(n){var t=n.style;t.width=t.height=t.lineHeight=e})}function De(){un.forEach(function(e,n){e.forEach(function(e,t){0!==e&&N(oe.newTileAt(n,t,e),n,t)})}),an&&N(an,ln,fn)}function Ge(){un.forEach(function(e,n){e.forEach(function(e,t){0!==e&&N(oe.get(n,t),n,t)})}),an&&N(an,ln,fn)}function je(){oe.killAll(),mn.remove()}function He(){Re(t("#grid")),t("#grid, .tile-container").addClass("col"+on.size.cols),t("#speed-container .speed").addClass("hide").filter('[data-option="'+on.speed+'"]').removeClass("hide"),t("#mode-container .mode").addClass("hide").filter('[data-option="'+on.mode+'"]').removeClass("hide"),Pe(),F.invalidate(on.size.rows,on.size.cols),oe.init(on.size.rows,on.size.cols)}function _e(){s("level").textContent=tn.level,s("lines").textContent=tn.lines.curr,s("score").textContent=tn.score.curr,z(nn,hn)}function Ve(e){(e=e||!1)?tn=V.loadStats(on):(tn.lines.best=0,tn.score.best=0),tn.level=0,tn.lines.curr=0,tn.lines.isNew=!0,tn.lines.prev=tn.lines.best,tn.score.curr=0,tn.score.isNew=!0,tn.score.prev=tn.score.best,un=p(un,on.size.rows,on.size.cols,0),cn.init(P(on.mode)),hn=cn.getNext(),T(),0===V.loadTimesPlayed(on)?Mn.goTo(Mn.Tutorial):Mn.goTo(Mn.Start,Z/2)}function Ye(){var e=V.loadTiles(on);un=V.loadGrid(on),tn=V.loadStats(on),sn=V.loadPrev(on),dn=e.tile,hn=e.next,ln=e.row,fn=e.col,cn.init(P(on.mode),V.loadRngState(on)),an=oe.newTile(dn),ie(),f(function(){De(),mn.add()}),sn?h():T(),K()?Mn.goTo(Mn.Loading):Mn.goTo(Mn.End,!0)}function We(){He(),V.hasSavedGame(on)?Ye():Ve(),f(_e),kn.add()}function Je(){je(),An.stop(),Ve(!0),f(_e)}function Fe(){kn.remove(),An.stop(),je()}function Ue(){An.pause()}function Be(){An.resume()}function Xe(e,n){In.exit(),(In=e).enter(n)}function qe(e){s(e).style.display="block"}function Ze(e){s(e).style.display="none"}function Ke(){In.goToMenu()}function Qe(){In===jn?In.goToOptions():In===Hn&&In.goToGame()}function $e(){In!==jn&&In!==Hn||(In===Hn&&In.goToGame(),An.newGame())}var en=t("#game"),nn=t("#next"),tn={level:0,lines:{curr:0,best:0,prev:0,isNew:!1},score:{curr:0,best:0,prev:0,isNew:!1}},on={mode:0,speed:0,size:{rows:7,cols:5}},rn={},sn={},cn=R(on),an=null,un=[],ln=0,fn=0,dn=1,hn=1,pn=u(E,3e3),gn=V.loadSettings();null===gn?(gn={highlight:s("highlight").checked,countdown:s("countdown").checked,controls:parseInt(a("#controls input:checked").value,10),sensitivity:t("#sensitivities > .selected").data("option"),size:t("#sizes > .selected").data("option"),speed:t("#speeds > .selected").data("option")},V.saveSettings(gn)):(C("highlight",s("highlight").checked),C("countdown",s("countdown").checked),s("highlight").checked=gn.highlight,s("countdown").checked=gn.countdown,a('#controls input[value="'+gn.controls+'"]').checked=!0),t("#options input").change(function(){switch(this.name){case"controls":gn.controls=parseInt(a("#controls input:checked").value,10);break;case"highlight":this.checked?(gn[this.name]=this.checked,mn.add()):(mn.remove(),gn[this.name]=this.checked);break;default:gn[this.name]=this.checked}V.saveSettings(gn)});var vn=function(e,n){function t(t){var o=a(".score-mod.dead");return o||(o=n.cloneNode(!0),e.appendChild(o)),o.textContent="+"+t,o.classList.remove("dead"),o}function o(e){f.textContent=Math.min(tn.score.curr,9999999),A(t(e)),tn.score.best<tn.score.curr&&(tn.score.best=tn.score.curr,tn.score.isNew&&(tn.score.isNew=!1))}function i(e){return 0===e}function r(){return un[1].every(i)}function c(e,n){var t=e.reduce(function(e,t){return e+t/3*n},0);return e.forEach(function(e){e>12&&(t*=e/12)}),t*=e.length,r()&&(t*=2*e.length),t}function u(e){return e.reduce(function(e,n){return e+n/3},0)*Math.pow(e.length,2)}function l(e){return e%3==0?e/3:0}var f=s("score");return function(e,n){var t;0!==(t=n?c(e,n):0===n?u(e):l(e))&&(tn.score.curr+=t,o(t))}}(s("score-mod-container"),a(".score-mod")),mn=function(e,n){function t(e,n){return!!(e+1<un.length&&X(e+1,n))||!!(n-1>=0&&X(e,n-1))||!!(n+1<un[0].length&&X(e,n+1))}function o(t){var o=a(".h"+t+".d");return o||((o=n.cloneNode(!0)).removeAttribute("id"),o.classList.remove("base-tile"),o.classList.add("h"+t),e.appendChild(o),o)}function i(e,n,t){var i=o(t);return i.classList.remove("d"),u(i),N(i,e,n),i}function r(e){l(e),e.classList.add("d")}function s(){var e,n,o=un.length,r=un[0].length;for(n=0;n<r;++n)for(e=0;e<o&&!X(e,n);++e)q(dn,un[e][n])&&t(e,n)&&f.push(i(e,n,un[e][n]))}function c(){f.forEach(r),f.length=0}var u,l;isAndroidStockBrowser?(u=function(e){e.style.opacity=.999},l=function(e){e.style.opacity=0}):(u=function(e){getComputedStyle(e).opacity,e.classList.add("h")},l=function(e){e.classList.remove("h")});var f=[];return{add:function(){gn.highlight&&(f.length>0&&c(),s())},remove:function(){gn.highlight&&c()}}}(s("tile-container"),s("base-tile-hl")),Tn=-1,wn=!1,Sn=[],yn=function(){function e(e){var n=e.row,t=e.col,o=un.length-1;for(n=e.row+1;n<o&&!X(n+1,t);++n)un[n][t]=un[n+1][t],oe.update(n+1,t,n,t);un[n][t]=0}return function(){Sn.forEach(e),le()}}(),bn=function(e){function n(e,n,t,o){var i,r,s=oe.get(n+1,e),c=oe.get(n,e),a=oe.newTile(un[n][e]+un[n+1][e]);for(a.style.opacity="0",s.style.zIndex="1",c.style.zIndex="0",ee(t,s,n+1,n,e,o,function(){un[n][e]+=un[n+1][e],oe.kill(s),oe.kill(c),oe.add(a,n,e),a.style.opacity=""}),r=t.recent().endTime(),I(t,a,n,e,r),i=n+2;i<un.length&&!X(i,e);++i)o+=33.333,ee(t,oe.get(i,e),i,i-1,e,o);return r}function t(){vn(Sn.map(function(e){return un[e.row][e.col]}),0)}return function(){var o=new e({onComplete:yn}),i=0;Sn.forEach(function(e){i=n(e.col,e.row,o,0)}),o.call(t,null,null,i)}}(i),On=[],En=function(){function e(e,n){L(e)&&On.push(n)}return function(){return On=[],un.forEach(e),On.length>0?(ge(),!0):(ce(),!1)}}(),xn=function(){function e(e,n,t){var o=oe.newTileAt(e,n,t);return N(o,e,n),o}var n={onComplete:le};return function(t,o){M(e(t,o,un[t][o]),b(t,o),n)}}(),Ln=0,Nn=Object.freeze({ADVANCE:0,LEFT:1,RIGHT:2,DOWN:3,DROP:4}),Cn=function(){function e(e,n){if(!wn&&An===Mn.Playing)for(var t=0,o=e.length;t<o;++t)switch(e[t]){case Nn.ADVANCE:if(ze())return;break;case Nn.LEFT:if(Ne(n[t]))return;break;case Nn.RIGHT:if(Ce(n[t]))return;break;case Nn.DOWN:if(ke(n[t]))return;break;case Nn.DROP:return void Oe()}}var n=[],t=[],o=debounce(function(){e(n,t),n.length=t.length=0});return function(e,i){wn||An===Mn.Playing&&(n.length>9&&e!==Nn.ADVANCE||(n.push(e),t.push(i||1),o()))}}(),kn=null;t(function(t){kn=Ae(t,e,n)});var zn=function(e){function n(e){return en.find("."+e)}function t(e){e.style.opacity=0,e.classList.add("dead")}var o=null;return{pause:function(t){o=e.exportRoot().pause(),t&&n(t).addClass("paused")},resume:function(e){o.resume(),o=null,e&&n(e).removeClass("paused")},clear:function(i){e.exportRoot().kill(),c(".mod:not(.dead)").forEach(t),o=null,i&&n(i).removeClass("paused"),an&&(an.style.opacity=""),wn=!1}}}(i),Mn=function(){var e=[],n=Object.freeze({enter:r,exit:r,pause:r,resume:r,stop:function(){for(;e.length>0;)Mn.pop(),An.resume();Mn.goTo(Mn.Stop)},newGame:r});return Object.freeze({goTo:function(e,n){An.exit(),(An=e).enter(n)},push:function(n,t){e.push(An),(An=n).enter(t)},pop:function(){An.exit(),An=e.pop()},Transition:Object.freeze(t.extend({},n,function(){function e(e,n){a.addClass(o),c=setTimeout(e,n),r=Date.now()}function n(){clearTimeout(c),a.removeClass(o)}var o,i,r,s=0,c=-1,a=t("#grid, .tile-container"),u={End:{getEffect:function(){return"shake-hor"},callback:function(){Mn.goTo(Mn.End)}},Start:{getEffect:function(){return Math.random()<.5?"shake":"shake-rot"},callback:Je}};return{enter:function(n){var t=u[n];o=t.getEffect(),e(i=t.callback,s=750)},exit:function(){n()},pause:function(){n(),s=Math.max(s-(Date.now()-r),0)},resume:function(){e(i,s)},newGame:function(){Date.now()-r>750&&(clearTimeout(c),e(i,s))}}}())),Tutorial:Object.freeze(t.extend({},n,{enter:function(){f(function(){function e(){Mn.goTo(Mn.Start)}function n(e,n){return function(){t("#tutorial-"+(e-1)).hide(),t("#tutorial-"+e).show(),t("#ok-"+e).off(Y).on(Y,n)}}var o=n(2,e),i=n(1,function(){0===V.loadTotalTimesPlayed()?o():e()}),r=en.find(".tutorial");r.find(".mode").addClass("hide"),r.find(".m"+on.mode).removeClass("hide"),0===on.speed?r.find(".speed.classic").removeClass("hide"):r.find(".speed.classic").addClass("hide"),n(0,i)()})},exit:function(){t(".tutorial").hide(),zn.clear("anim2")},pause:function(){zn.pause("anim2")},resume:function(){zn.resume("anim2")}})),Start:Object.freeze(t.extend({},n,function(){function e(){t=-1,ce(),V.incTimesPlayed(on),Mn.goTo(Mn.Playing)}function n(){clearTimeout(t)}var t=-1;return{enter:function(n){n?t=setTimeout(e,n):e()},exit:n,pause:n,resume:function(){t=setTimeout(e,Z/2)}}}())),Stop:Object.freeze(t.extend({},n)),Playing:Object.freeze(t.extend({},n,{_clear:function(){te.unmark(),clearTimeout(Tn),x()},enter:function(){},exit:function(){this._clear(),zn.clear("anim")},pause:function(){this._clear(),zn.pause("anim"),Mn.push(Mn.Paused)},resume:function(){zn.resume("anim"),wn||(te.mark(an,U()),Tn=setTimeout(Me,U()))},newGame:function(){this.pause(),Mn.goTo(Mn.New)}})),Paused:Object.freeze(t.extend({},n,{resume:function(){Mn.goTo(Mn.Resuming)}})),Loading:Object.freeze(t.extend({},n,{enter:function(){Mn.goTo(Mn.Playing),An.pause(),An.resume()}})),Resuming:Object.freeze(t.extend({},n,function(){function e(){var e=3;!function n(){if(0===e)return Mn.pop(),void An.resume();t("#resume .countdown").text(e--),s=setTimeout(n,r)}(),t("#resume").show()}function n(e,n){return e-Math.floor(e/n)*n}function o(){gn.countdown&&(clearTimeout(s),-1===c?te.unmark():(clearTimeout(c),c=-1),t("#resume").hide())}function i(){if(!gn.countdown)return Mn.pop(),void An.resume();e(),wn||(c=setTimeout(function(){te.mark(an,U()),c=-1},n(3*r,U())))}var r=800,s=-1,c=-1;return{enter:i,exit:o,pause:o,resume:i,newGame:function(){Mn.goTo(Mn.New)}}}())),End:Object.freeze(t.extend({},n,{enter:function(e){var n,o=t("#msg-container");mn.remove(),te.unmark(),(n=t("#game-over > .msg").hide()).eq(Math.floor(Math.random()*n.length)).show(),o.find(".msg").hide(),tn.score.prev<tn.score.best?n=o.find(".high-score"):(n=o.find(".share"),Math.random()<.5&&n.add(o.find(".like"))),n.eq(Math.floor(Math.random()*n.length)).show(),e?t("#end").show():t("#end").fadeIn()},exit:function(){t("#end").hide()},newGame:function(){Mn.goTo(Mn.Transition,"Start")}})),New:Object.freeze(t.extend({},n,{enter:function(){t("#confirm").show()},exit:function(){t("#confirm").hide()},continue:function(){Mn.goTo(Mn.Resuming)}}))})}(),An=Mn.Stop;t(e).resize(debounce(function(){In!==jn&&In!==Hn||(Ie(t("#grid")),Pe(),F.invalidate(on.size.rows,on.size.cols),Ge())}));var In,Rn=function(){function n(n){return e.history?n:r}var t=!1,o=!1;return history.state&&history.replaceState(null,""),e.onpopstate=function(e){if(o)o=!1;else{if(t=!0,e.state)switch(e.state.section,e.state.section){case"howto":In.goToOther("howto");break;case"about":In.goToOther("about");break;case"game":In.goToGame();break;case"options":In.goToOptions();break;default:G("Unknown history state!")}else In.goToMenu();t=!1}},{push:n(function(e){t||(e.toLowerCase(),history.pushState({section:e.toLowerCase()},e))}),pop:n(function(){t||(o=!0,history.back())})}}(),Pn=Object.freeze({goToOptions:r,goToMenu:r,goToGame:r,goToOther:r,enter:r,exit:r}),Dn=Object.seal(t.extend({},Pn,{section:"",goToMenu:function(){Xe(Gn)},enter:function(e){switch(Dn.section=e,qe(Dn.section),Rn.push(e),Dn.section){case"howto":f(m)}},exit:function(){Ze(Dn.section),Rn.pop()}})),Gn=Object.freeze(t.extend({},Pn,{goToOther:function(e){Xe(Dn,e)},goToGame:function(){Xe(jn,!0)},enter:function(){qe("main-menu")},exit:function(){Ze("main-menu")}})),jn=Object.freeze(t.extend({},Pn,{goToMenu:function(){Fe(),Ze("game"),Xe(Gn),Rn.pop()},goToOptions:function(){Ue(),Xe(Hn)},enter:function(e){e?(qe("game"),We()):Be(),Rn.push("Game")},exit:function(){}})),Hn=Object.freeze(t.extend({},Pn,{goToMenu:function(){Xe(jn),jn.goToMenu()},goToGame:function(){Xe(jn)},enter:function(){qe("options"),s("pause-resume").classList.replace("pause","resume"),Rn.push("Options")},exit:function(){gn=V.loadSettings(),Rn.pop(),s("pause-resume").classList.replace("resume","pause"),Ze("options")}}));In=Gn,t(function(){function e(e,n){var t="selected";return function(o,i){var r=o.find("."+t).removeClass(t)[e]();0===r.length&&(r=o.children()[n]()),gn[i]=r.addClass(t).data("option"),V.saveSettings(gn)}}t(".menu-button").on(Y,Ke),t("#pause-resume").on(Y,Qe),t("#new").on(Y,$e),t("#confirm .no").on(Y,function(){An.continue()}),t("#confirm .yes, #restart").on(Y,function(){Mn.goTo(Mn.Transition,"Start")});var n=e("prev","last"),o=e("next","first");t("#size-left").on(Y,function(){n(t("#sizes"),"size")}),t("#size-right").on(Y,function(){o(t("#sizes"),"size")}),t("#speed-left").on(Y,function(){n(t("#speeds"),"speed")}),t("#speed-right").on(Y,function(){o(t("#speeds"),"speed")}),t("#sensitivity").on(Y,function(){o(t("#sensitivities"),"sensitivity")})}),t(function(){In.enter(),t("#other .nav-button").on(Y,function(){In.goToOther(this.name)}),t(".play-button").on(Y,function(){var e=t("#sizes > .selected").data("option").split("x"),n=+e[0],o=+e[1];t("#grid, .tile-container").removeClass("col"+on.size.cols),on.mode=t(this).data("mode"),on.speed=t("#speeds > .selected").data("option"),on.size.rows=n,on.size.cols=o,on.mode,on.speed,In.goToGame()}),t(e).blur(function(){In===jn&&An!==Mn.End&&In.goToOptions()}),t(e).unload(function(){In===jn&&An===Mn.Playing&&x()})})}(e,n,t,o,i,requestAnimationFrame)}(window,document,Zepto,TweenLite,TimelineLite);