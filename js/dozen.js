!function(e,t,n,o){"use strict";function i(){}function r(e){return t.getElementById(e)}function a(e,t){return e.querySelectorAll(t)}function u(e,t){return e.querySelector(t)}function s(e){var t,n,o;for(t=e.length-1;t>0;--t)n=Math.floor(Math.random()*(t+1)),o=e[t],e[t]=e[n],e[n]=o}function c(e){return e>0&&0==(e&e-1)}function l(){function e(e,t,n){return{breakpoint:e,settings:{slidesToShow:t,dots:void 0===n||n}}}var t={slidesToShow:1,infinite:!1,arrows:!1,dots:!0,waitForAnimate:!1,mobileFirst:!0,accessibility:!1};n(".carousel").hasClass("slick-initialized")||(jQuery("#carousel-modes").slick(n.extend(t,{responsive:[e(500,2),e(820,3,!1)]})),jQuery("#carousel-controls").slick(n.extend(t,{responsive:[e(550,2),e(800,3,!1)]})),jQuery("#carousel-speeds").slick(n.extend(t,{responsive:[e(600,2),e(1280,3),e(1920,4,!1)]})))}function f(e,t){return e+"-"+t}function d(e,t){return"c-"+e+"-"+t}function h(e){var t=e.getBoundingClientRect(),n=e.offsetParent.getBoundingClientRect();return{top:t.top-n.top,left:t.left-n.left}}function g(e){return e.getBoundingClientRect().width}function p(e){return e.getBoundingClientRect().height}function v(e,t){var n=Y.get(e,t);return n||(n=h(r(d(e,t))),Y.set(e,t,n),n)}function m(e){return e>=4&&c(e)?4:e>=12?12*Math.pow(2,Math.round(Math.log2(e/12))%3):e}function T(e){var t="t"+m(e);return e>=100&&(t+=" large"),t}function w(e){return e>0&&e%12==0}function S(e){for(var t=0,n=e.length;t<n;++t)if(e[t]!==e[0])return!1;return!0}function y(e){return e.every(w)&&S(e)}function b(e,t,n){e.style[P]=D(v(t,n))}function E(e,t){t.style[P]=e.style[P]}function z(e,t){var n=e.find(".n"),o=+n.text()||1;return e.removeClass(T(o)).addClass(T(t)),n.text(t),e}function C(e,t,n){if(n){if(t===n)return;e.children().filter(".t"+t).removeClass("dead").end().filter(".t"+n).addClass("dead")}else e.children().addClass("dead").filter(".t"+t).removeClass("dead")}function O(e){return G&&(e.translateZ=0),e}function x(e){function t(t,n){var o,i,r,a=n.length;for(o=t.length===a*(e.size.cols-2)?e.size.cols-1:e.size.cols-2,t.length=a*o,i=0;i<a;++i)for(r=0;r<o;++r)t[i*o+r]=n[i];s(t)}function n(e){return a.index===a.bag.length&&(t(a.bag,e),a.index=0),a.bag[a.index++]}function o(){switch(e.mode){case L.EVIL:r=V.EVIL;break;case L.FILTHY:r=V.FILTHY;break;case L.DIRTY:r=V.DIRTY;break;default:case L.CLEAN:r=V.CLEAN}}function i(){u.save()}var r,a={bag:[],index:0},u={init:function(){o(),a.bag=new Array(r.length*(e.size.cols-2)),t(a.bag,r),a.index=Math.floor(3*Math.random()),this.save()},load:function(){a=N.loadRngState(e),o()},save:function(){N.saveRngState(e,a)},getNext:function(){return setTimeout(i),n(r)}};return u}var M=function(){Function.prototype.apply.call(console.info,console,arguments)},A=function(){Function.prototype.apply.call(console.warn,console,arguments)};Math.trunc||(A('Undefined "Math.trunc". Using polyfill.'),Math.trunc=function(e){return e>0?Math.floor(e):Math.ceil(e)}),Math.log2||(A('Undefined "Math.log2". Polyfill returns imprecise values on some inputs!'),Math.log2=function(e){return Math.log(e)*Math.LOG2E}),Array.prototype.fill||(A('Undefined "Array.prototype.fill". Using bad polyfill!'),Object.defineProperty(Array.prototype,"fill",{value:function(e){for(var t=0;t<this.length;++t)this[t]=e;return this}})),e.NodeList&&!NodeList.prototype.forEach&&(A('Undefined "NodeList.prototype.forEach". Using Array.prototype.forEach.'),NodeList.prototype.forEach=Array.prototype.forEach);var L=Object.freeze({CLEAN:0,DIRTY:1,FILTHY:2,EVIL:3}),k=Object.freeze({CLASSIC:0,SLOW:1,PRACTICE:2,FAST:3}),I=Object.freeze({VSHORT:0,SHORT:1,NORMAL:2,LONG:3,VLONG:4}),N=function(t){function n(e,n){t.setItem(e,n)}function o(e){return t.getItem(e)}function i(e,t){return void 0===t.speed&&(t.speed=""),void 0===t.size&&(t.size=a),e+"_"+t.mode+"_"+t.speed+"_"+t.size.rows+"x"+t.size.cols}var r=Object.freeze({VERSION:"dozen_version",SETTINGS:"dozen_settings",GRID:"dozen_grid",TILES:"dozen_tiles",STATS:"dozen_stats",RNG:"dozen_rng",APP_STATE:"dozen_app_state",TIMES_PLAYED:"dozen_times_played",HAS_LIKED:"dozen_has_liked"});t=t||e.localStorage,0!=+o(r.VERSION)&&(o(r.VERSION),n(r.VERSION,0));var a={rows:"",cols:""};return{saveGrid:function(e,t){n(i(r.GRID,e),JSON.stringify(t))},loadGrid:function(e){return JSON.parse(o(i(r.GRID,e)))},saveTiles:function(e,t,o,a,u){n(i(r.TILES,e),JSON.stringify({tile:t,next:o,row:a,col:u}))},loadTiles:function(e){return JSON.parse(o(i(r.TILES,e)))},saveRngState:function(e,t){n(i(r.RNG,e),JSON.stringify(t))},loadRngState:function(e){return JSON.parse(o(i(r.RNG,e)))},saveStats:function(e,t){n(i(r.STATS,e),JSON.stringify(t))},loadStats:function(e){return JSON.parse(o(i(r.STATS,e)))},hasSavedGame:function(e){return null!==o(i(r.TILES,e))},saveAppState:function(e){n(r.APP_STATE,JSON.stringify(e))},loadAppState:function(){return JSON.parse(o(r.APP_STATE))},clearAppState:function(){t.removeItem(r.APP_STATE)},saveSettings:function(e){n(r.SETTINGS,JSON.stringify(e))},loadSettings:function(){return JSON.parse(o(r.SETTINGS))},loadTimesPlayed:function(e){return+o(r.TIMES_PLAYED+"_"+e.mode)},loadTotalTimesPlayed:function(){return Object.keys(L).reduce(function(e,t){return e+ +o(r.TIMES_PLAYED+"_"+L[t])},0)},incTimesPlayed:function(e){n(r.TIMES_PLAYED+"_"+e.mode,this.loadTimesPlayed(e)+1)}}}();M("Dozen - Version:","1.3.7"),M("Welcome! Hope you enjoy! :)\n\n");var R=isAndroidStockBrowser?"tap":"tap click",P=function(e){var n=t.createElement("div").style,o="ms Moz Webkit".split(" "),i=o.length,r=e[0].toUpperCase()+e.slice(1);if(e in n)return e;for(;i--;)if((e=o[i]+r)in n)return e}("transform"),G=function(){var e=t.createElement("div").style,n=["Moz","webkit"],o=n.length;if("perspective"in e)return!0;for(;o--;)if(n[o]+"Perspective"in e)return!0;return!1}(),Y=function(e,t){function n(e){e.fill(null)}function o(e,t){e===i.length&&t===i[0].length?i.forEach(n):i=new Array(e).fill(null).map(function(e){return new Array(t).fill(null)})}var i=[];return{invalidate:function(e,t){o(e,t)},get:function(e,t){return i[e][t]},set:function(e,t,n){i[e][t]=n}}}(),D=G?function(e){return"translateX("+e.left+"px) translateY("+e.top+"px) translateZ(0)"}:function(e){return"translateX("+e.left+"px) translateY("+e.top+"px)"},j=1e3/60,_=960,V={CLEAN:[1,2,3,6],DIRTY:[1,2,3,6],FILTHY:[1,2,3,6],EVIL:[1,2,3,4,6]};o.easings.ease=o.bezier(.25,.1,.25,1);var X={PULSE:{scale:[{value:.86,duration:79.25},{value:1.16,duration:158.5},{value:1,duration:79.25}],easing:"ease",duration:317},CLEAR:{scale:[{value:1.23,duration:125},{value:0,duration:375}],rotate:[{value:720,duration:375,delay:125}],easing:"linear",duration:500}},H=function(){function e(e,n,o,i){return t.targets=e,t.translateX=n.left,t.translateY=n.top,t.duration=o,t.complete=i,t}var t=O({targets:null,translateX:0,translateY:0,duration:0,complete:null,easing:"linear"});return function(t,n,i,r,a){o(e(t,v(n,i),r,a))}}(),U=function(){function e(e,n,o,i){return t.targets=e,t.translateX=n.left,t.translateY=n.top,t.offset=o,t.complete=i,t}var t=O({targets:null,translateX:0,translateY:0,offset:0,complete:null});return function(t,n,o,i,r,a){t.add(e(n,v(o,i),r,a))}}(),F=function(){var e=O({targets:null,translateX:0,translateY:0,scale:X.PULSE.scale,easing:X.PULSE.easing,duration:X.PULSE.duration});return function(t,n,i,r){e.targets=n,e.translateX=o.getValue(n,"translateX"),e.translateY=o.getValue(n,"translateY"),t.add(e)}}(),B=function(e){function t(t,n){r=t,i.targets=r,i.duration=n/2,o=e(i)}function n(){o.pause(),o=null,r.style.opacity="",r=null}var o,i={targets:null,opacity:[1,.5],duration:500,easing:"linear",direction:"alternate",loop:!0},r=null;return{add:function(e,o){r&&n(),t(e[0],o)},remove:function(){r&&n()}}}(o),J=function(e,t,o){function i(e){return"n"+e}function r(e){return".n"+e}function a(a){var s,c=u(e[0],r(a)+".dead");return c?n(c).removeClass("dead"):(s=(a<=6?o:t).clone().removeAttr("id"),z(s.removeClass("base-tile"),a).addClass(i(a)).appendTo(e))}var s={};return{newTile:function(e){return a(e)},newTileAt:function(e,t,n){var o=a(n);return this.add(o,e,t),o},add:function(e,t,n){s[f(t,n)]=e},get:function(e,t){return s[f(e,t)]},update:function(e,t,n,o){var i=f(e,t);s[f(n,o)]=s[i],delete s[i]},show:function(e){e.removeClass("dead")},hide:function(e){e.addClass("dead")},hideAt:function(e,t){this.hide(s[f(e,t)])},hideAll:function(){e.children().addClass("dead")}}}(n("#tile-container"),n("#base-tile"),n("#base-tile-hl"));!function(e,t,n,o,u){function s(){N.saveSettings(rt)}function c(){N.saveGrid(qe,Ke)}function f(){N.saveTiles(qe,tt,nt,$e,et)}function d(){setTimeout(s)}function v(){setTimeout(c)}function m(){setTimeout(f)}function T(e,t){e.filter(".selected").removeClass("selected"),e.filter('[data-option="'+t+'"]').addClass("selected")}function w(e,t){e in rt||(rt[e]=t,N.saveSettings(rt))}function S(){Qe.score+=ot,u(ut)}function z(e,t,n){switch(e){default:case k.CLASSIC:return t-Qe.level*n;case k.FAST:return t-9*n;case k.SLOW:return t-3*n;case k.PRACTICE:return _}}function M(){var e=qe.size.rows-1,t=6*_/e,n=Math.round(333/e);return Math.max(z(qe.speed,t,(t-n)/13),n)}function P(e,t){return 0===Ke[e][t]}function G(e,t){switch(qe.mode){case L.CLEAN:return e+t===3||e===t&&e>=3;case L.DIRTY:return e+t===3||e===t&&2!==e;case L.FILTHY:case L.EVIL:return e+t===3||e===t;default:throw new Error("Invalid mode!")}}function D(){var e=Ke.length-1,t=Math.floor(Ke[0].length/2),n=Ke[e][t];return 0===n||G(n,nt)}function V(){b(He[0],$e,et)}function W(){lt=!1,ct=setTimeout(Se,M()),v(),m()}function Q(){clearTimeout(ct)}function q(){if(!D())return yt.goTo(yt.Transition,"End"),v(),void m();$e=Ke.length-1,et=Math.floor(Ke[0].length/2),tt=nt,nt=Ze.getNext(),C(We,nt,tt),He=J.newTile(tt),B.add(He,M()),V(),st.add(),P($e,et)?W():re()}function Z(){Ke[$e][et]=tt,J.add(He,$e,et),q()}function K(){var e,t,n=Ke.length-1,o=Ke[0].length;for(ft=[],t=0;t<o;++t)for(e=0;e<n&&!P(e+1,t);++e)if(G(Ke[e][t],Ke[e+1][t])){ft.push({row:e,col:t});break}ft.length>0?ht():mt()}function $(e,t){var n=Ke[e];Ke[e]=Ke[t],Ke[t]=n}function ee(){for(var e=gt[gt.length-1]+1,t=gt[0],n=Ke.length;e<n;)$(t++,e++);K()}function te(){ot=0,gt.forEach(function(e){for(var t=0,n=Ke[0].length;t<n;++t)J.hideAt(e,t);ot+=Ke[e][0]/12,Ke[e].fill(0)}),S(),pt()}function ne(){st.remove(),B.remove(),J.hide(He),J.hideAt($e,et),Ke[$e][et]+=tt,Tt($e,et,K)}function oe(){wt(),W()}function ie(){wt(),it()}function re(){lt=!0,u(ne)}function ae(e,t){H(He[0],$e,et,e,t)}function ue(e){ae(e,Z)}function se(e){He[0].style.zIndex="1",J.get($e,et)[0].style.zIndex="0",ae(e,ne)}function ce(){var e,t=$e;if(bt===yt.Playing)if(st.remove(),B.remove(),0!==$e&&(P($e-1,et)||G(tt,Ke[$e-1][et]))){for(e=$e-1;e>=0&&P(e,et);--e);e<0||!G(tt,Ke[e][et])?ue(j*(t-($e=e+1))):se(j*(t-($e=e)))}else Z()}function le(){bt===yt.Playing&&(lt||(lt=!0,Q(),u(ce)))}function fe(e,t,n){$e=e,et=t,n()}function de(e,t){if(!lt){if(!P(e,t))return G(tt,Ke[e][t])?(fe(e,t,re),void Q()):void 0;fe(e,t,ie)}}function he(){de($e,et-1)}function ge(){de($e,et+1)}function pe(){de($e-1,et)}function ve(e,t){if(bt===yt.Playing)do{t()}while(--e>0)}function me(e){lt||0===et||ve(Math.min(e||1,et),he)}function Te(e){lt||et===Ke[0].length-1||ve(Math.min(e||1,Ke[0].length-1-et),ge)}function we(e){lt||0===$e||ve(Math.min(e||1,$e),pe)}function Se(){if(qe.speed!==k.PRACTICE){if(0!==$e)return P($e-1,et)?(--$e,void oe()):G(tt,Ke[$e-1][et])?(--$e,void re()):void Z();Z()}}function ye(e){function t(e,t){e.style.width=t+"px"}var n,o,i,a=e[0];a.style.width="",n=e.find(".r0").children(":not(.hide)").get().map(g),o=Math.max.apply(null,n),(i=n.reduce(function(e,t){return e+(o-t)},0))>0&&t(a,g(a)+i),t(r("tile-container"),g(a))}function be(e){function t(e,t,n){var o,i="",r=t-1;for(o=e-1;o<r;++o)i+=n+o+",";return i+n+o}e.find(t(5,qe.size.rows,".r")).removeClass("hide"),e.find(t(5,qe.size.cols,".c")).removeClass("hide"),e.find(t(qe.size.rows+1,11,".r")).addClass("hide"),e.find(t(qe.size.cols+1,9,".c")).addClass("hide"),ye(e)}function Ee(){var e=g(r("c-0-0"));a(t,".t").forEach(function(t){t.style.width=e+"px",t.style.height=e+"px"})}function ze(){Ke.forEach(function(e,t){e.forEach(function(e,n){0!==e&&b(J.newTileAt(t,n,e)[0],t,n)})}),He&&b(He[0],$e,et)}function Ce(){Ke.forEach(function(e,t){e.forEach(function(e,n){0!==e&&b(J.get(t,n)[0],t,n)})}),He&&b(He[0],$e,et)}function Oe(){J.hideAll(),st.remove()}function xe(){be(n("#grid")),n("#grid, #tile-container").addClass("col"+qe.size.cols),n("#speed-container .speed").addClass("hide").filter('[data-option="'+qe.speed+'"]').removeClass("hide"),n("#mode-container .mode").addClass("hide").filter('[data-option="'+qe.mode+'"]').removeClass("hide"),Ee(),Y.invalidate(qe.size.rows,qe.size.cols)}function Me(){Fe.text(Qe.level),Be.text(Qe.score),Je.text(Qe.best),C(We,nt)}function Ae(e,t){return new Array(e).fill(0).map(function(e){return new Array(t).fill(0)})}function Le(e){(e=e||!1)?Qe=N.loadStats(qe):Qe.best=0,Qe.level=0,Qe.score=0,Qe.isNewBest=!0,Qe.prevBest=Qe.best,N.saveStats(qe,Qe),Ke=Ae(qe.size.rows,qe.size.cols),Ze.init(),nt=Ze.getNext(),0===N.loadTimesPlayed(qe)?yt.goTo(yt.Tutorial):yt.goTo(yt.Start,_/2)}function ke(){var e=N.loadTiles(qe);Ke=N.loadGrid(qe),Qe=N.loadStats(qe),tt=e.tile,nt=e.next,$e=e.row,et=e.col,Ze.load(),He=J.newTile(tt),J.hide(He),u(function(){J.show(He),ze(),st.add()}),D()?yt.goTo(yt.Loading):yt.goTo(yt.End,!0)}function Ie(){xe(),N.hasSavedGame(qe)?ke():Le(),u(Me),at.add()}function Ne(){Oe(),Le(!0),u(Me)}function Re(){at.remove(),bt.stop(),Oe()}function Pe(){bt.pause()}function Ge(){bt.resume()}function Ye(e,t){Et.exit(),(Et=e).enter(t)}function De(e){r(e).style.display="block"}function je(e){r(e).style.display="none"}function _e(){Et.goToMenu()}function Ve(){Et===Mt?Et.goToOptions():Et===At&&Et.goToGame()}function Xe(){Et!==Mt&&Et!==At||(Et===At&&Et.goToGame(),bt.newGame())}var He,Ue=n("#game"),Fe=n("#level"),Be=n("#score"),Je=n("#best"),We=n("#next"),Qe={level:0,score:0,best:0,prevBest:0,isNewBest:!1},qe={mode:0,speed:0,size:{rows:7,cols:5}},Ze=x(qe),Ke=[],$e=0,et=0,tt=1,nt=1,ot=0,it=function(){function e(){t=-1,f()}var t=-1;return function(){-1===t&&(t=setTimeout(e,150))}}(),rt=N.loadSettings();null===rt?(rt={highlight:n("#highlight").is(":checked"),countdown:n("#countdown").is(":checked"),altControls:parseInt(n("#controls input:checked").val(),10),sensitivity:n("#sensitivities > .selected").data("option"),size:n("#sizes > .selected").data("option"),speed:n("#speeds > .selected").data("option")},N.saveSettings(rt)):(w("highlight",!0),w("countdown",!0),n("#highlight").prop("checked",rt.highlight),n("#countdown").prop("checked",rt.countdown),n('#controls input[value="'+rt.altControls+'"]').prop("checked",!0),T(n("#sensitivities .item"),rt.sensitivity),T(n("#sizes .item"),rt.size),T(n("#speeds .item"),rt.speed)),n("#options input").change(function(){switch(this.name){case"controls":rt.altControls=parseInt(n("#controls input:checked").val(),10);break;case"highlight":this.checked?(rt[this.name]=this.checked,st.add()):(st.remove(),rt[this.name]=this.checked);break;default:rt[this.name]=this.checked}d()});var at,ut=function(e){function t(){n(this).addClass("dead")}return function(){var e=Math.min(ot,999999);Be.text(e),Qe.best<Qe.score&&(Qe.best=Qe.score,Je.text(Qe.best),Qe.isNewBest&&(n("#new-high-score").removeClass("dead").animate("alert",2e3,t),Qe.isNewBest=!1)),Qe.score>=10*(Qe.level+1)&&(Qe.level=Math.floor(Qe.score/10),Fe.text(Qe.level),n("#level-up").removeClass("dead").animate("rise","ease",750,t)),N.saveStats(qe,Qe)}}(n("#score-mod-container")),st=function(){function t(e,t){return!!(e+1<Ke.length&&P(e+1,t))||!!(t-1>=0&&P(e,t-1))||!!(t+1<Ke[0].length&&P(e,t+1))}function o(t,o){var i=J.get(t,o)[0].firstElementChild;e.getComputedStyle(i).opacity,n(i).addClass("h")}function i(e,t){n(J.get(e,t)[0].firstElementChild).removeClass("h")}function r(e){i(e.i,e.j)}function a(){var e,n,i=Ke.length,r=Ke[0].length;for(n=0;n<r;++n)for(e=0;e<i&&!P(e,n);++e)G(tt,Ke[e][n])&&t(e,n)&&(s.push({i:e,j:n}),o(e,n))}function u(){s.forEach(r),s.length=0}var s=[];return{add:function(){rt.highlight&&(s.length>0&&u(),a())},remove:function(){rt.highlight&&u()}}}(),ct=-1,lt=!1,ft=[],dt=function(){function e(e){var t=e.row,n=e.col,o=Ke.length-1;for(t=e.row+1;t<o&&!P(t+1,n);++t)Ke[t][n]=Ke[t+1][n],J.update(t+1,n,t,n);Ke[t][n]=0}return function(){ft.forEach(e),K()}}(),ht=function(){function e(e,t,n,o){var i,r,a=J.get(t+1,e)[0],u=J.get(t,e)[0];for(a.style.zIndex="1",u.style.zIndex="0",U(n,a,t,e,0,function(){Ke[t][e]+=Ke[t+1][e],J.hideAt(t+1,e),J.hideAt(t,e),J.add(i,t,e),J.show(i)}),i=J.newTile(Ke[t][e]+Ke[t+1][e]),J.hide(i),E(u,i[0]),F(n,i[0],t,e),r=t+2;r<Ke.length&&!P(r,e);++r)U(n,J.get(r,e)[0],r-1,e,o+=33.333)}var t={duration:7*j,easing:"easeInQuad",complete:dt};return function(){var n=o.timeline(t);ft.forEach(function(t){e(t.col,t.row,n,0)})}}(),gt=[],pt=function(){var e={duration:7*j,easing:"easeInQuad",complete:ee};return function(){var t,n,i,r,a,u=Ke.length,s=Ke[0].length;for(t=o.timeline(e),i=0;i<s;++i)for(n=16.666*i+o.random(0,100),a=gt[0],r=gt[gt.length-1]+1;r<u&&!P(r,i);++r,++a)U(t,J.get(r,i)[0],a,i,n),J.update(r,i,a,i),n+=33.333;0===t.children.length&&ee()}}(),vt=function(){function e(e){return 75*e}function t(t,n,r){var a=J.get(t,n)[0];i.targets=a,i.offset=e(n),i.translateX=o.getValue(a,"translateX"),i.translateY=o.getValue(a,"translateY"),r.add(i)}var n={easing:X.CLEAR.easing,duration:X.CLEAR.duration,complete:te},i=O({targets:null,offset:0,translateX:0,translateY:0,scale:X.CLEAR.scale,rotate:X.CLEAR.rotate});return function(){var e=o.timeline(n);gt.forEach(function(n){for(var o=0,i=Ke[0].length;o<i;++o)t(n,o,e)})}}(),mt=function(){function e(e,t){y(e)&&gt.push(t)}return function(){gt=[],Ke.forEach(e),gt.length>0?vt():q()}}(),Tt=function(){function e(e,t,n){var o=J.get(e,t)[0],i=J.newTileAt(e,t,n)[0];return E(o,i),i}var t=O({targets:null,translateX:0,translateY:0,scale:X.PULSE.scale,easing:X.PULSE.easing,duration:X.PULSE.duration,complete:null});return function(n,i,r){var a=e(n,i,Ke[n][i]);t.targets=a,t.translateX=o.getValue(a,"translateX"),t.translateY=o.getValue(a,"translateY"),t.complete=r,o(t)}}(),wt=function(e){function t(){e(),n=!1}var n=!1;return function(){n||(n=!0,u(t))}}(V);n(function(){function o(){S=e.innerWidth,y=e.innerHeight}function i(e,t){e.preventDefault(),t()}function a(e){switch(e.which){case 37:case 65:i(e,me);break;case 39:case 68:i(e,Te);break;case 40:case 83:i(e,we);break;case 38:case 87:case 32:i(e,le)}}function u(e,t,n){return e+Math.trunc((t-e)/n)*n}function s(e,t,n){var o,i;return(o=Math.abs(e.clientX-O))>t?(i=Math.floor(o/t),e.clientX<O?me(i):Te(i),void(O=u(O,e.clientX,t))):(o=e.clientY-x)>n?(we(Math.floor(o/n)),void(x=u(x,e.clientY,n))):void 0}function c(){var e=!1;n("#game-container").on({mousedown:function(t){0===t.button&&(t.preventDefault(),e=!0,O=t.clientX,x=t.clientY)},mousemove:function(t){e&&(t.preventDefault(),s(t,b,E))},mouseup:function(t){0===t.button&&(t.preventDefault(),e=!1)},mouseout:function(t){t.target===this&&(e=!1)},dblclick:function(e){0===e.button&&(e.preventDefault(),le())}})}function l(e){return e.clientY>5/8*y?we:e.clientX<=S/2?me:Te}function f(){A(),M=setTimeout(f,33.333)}function d(){n("#game-container").on({touchstart:function(e){var t=e.changedTouches[0];e.preventDefault(),e.touches.length>1||(O=Math.round(t.clientX),x=Math.round(t.clientY))},touchmove:function(e){var t=e.changedTouches[0];e.preventDefault(),e.touches.length>1||s(t,z,C)},"touchend touchcancel":function(e){e.preventDefault()},doubleTap:function(){le()}})}function v(){n("#game-container").on({touchstart:function(e){e.preventDefault(),e.touches.length>1||(A=l(e.changedTouches[0]),M=setTimeout(f,350),N.start(e.changedTouches[0]))},touchmove:function(e){var t=l(e.changedTouches[0]);e.preventDefault(),e.touches.length>1||(N.handleMove(e.changedTouches[0])?clearTimeout(M):t!==A&&(clearTimeout(M),A=t,f()))},touchend:function(e){e.preventDefault(),e.touches.length>0||(N.handleSwipe(e.changedTouches[0])===N.DOWN?le():A(),clearTimeout(M),A=null)},touchcancel:function(e){e.touches.length>0||(clearTimeout(M),A=null)}})}function m(e){e?v():d()}function T(){n("#game-container").off("touchstart touchmove touchend touchcancel doubleTap")}function w(e){T(),m(e)}var S,y;o(),n(e).resize(throttleHandler(o)),n(t).keydown(function(e){switch(e.which){case 80:i(e,Ve);break;case 78:i(e,Xe);break;case 8:i(e,_e)}});var b,E,z,C,O,x,M,A,L=throttleHandler(function(){var e,t=r("c-0-0"),n=h(t);rt.sensitivity,e=function(){switch(rt.sensitivity){case I.VSHORT:return.6;case I.SHORT:return.8;default:case I.NORMAL:return 1;case I.LONG:return 1.2;case I.VLONG:return 1.4}}(),b=Math.round(Math.abs(h(r("c-0-1")).left-n.left)*e),E=Math.round(Math.abs(h(r("c-1-0")).top-n.top)*e),e=function(){switch(rt.sensitivity){case I.VSHORT:return.5;case I.SHORT:return.75;default:case I.NORMAL:return.95;case I.LONG:return 1.1;case I.VLONG:return 1.2}}(),z=Math.round(g(t)*e),C=Math.round(p(t)*e)}),k=throttleHandler(function(){L()}),N=function(){function e(){switch(rt.sensitivity){case I.VSHORT:return 20;case I.SHORT:return 30;default:case I.NORMAL:return 40;case I.LONG:return 60;case I.VLONG:return 80}}var t=0,n=0,o=0,i=0,r=0,a={LEFT:0,RIGHT:1,UP:2,DOWN:3,durationThreshold:550,start:function(e){t=Date.now(),n=Math.round(e.clientX),o=Math.round(e.clientY)},handleMove:function(i){var r,u,s=e();return r=Math.abs(i.clientX-n),u=Math.abs(i.clientY-o),Date.now()-t<a.durationThreshold&&(r>s&&u<s||u>s&&r<s)},handleSwipe:function(u){var s,c,l=e();if(i=u.clientX-n,r=u.clientY-o,s=Math.abs(i),c=Math.abs(r),Date.now()-t<a.durationThreshold){if(s>l&&c<l)return i<0?a.LEFT:a.RIGHT;if(c>l&&s<l)return r<0?a.UP:a.DOWN}}};return a}();at={add:function(){L(),n(e).resize(L),n("#sensitivity").on(R,k),n(t).keydown(a),c(),Ue.on("contextmenu",!1),m(rt.altControls),n("#controls").on("change","input",function(){w(parseInt(n("#controls input:checked").val(),10))})},remove:function(){n("#sensitivity").off(R,k),n(e).off("resize",L),n(t).off("keydown",a),Ue.off("contextmenu"),n("#game-container").off(),n("#controls").off("change")}}});var St=function(){function e(e){e.pause()}function t(e){e.play()}function n(e){return Ue.find("."+e)}var i=[];return{pause:function(t){(i=o.running.slice()).forEach(e),n(t).addClass("paused")},resume:function(e){i.forEach(t),i=[],n(e).removeClass("paused")},clear:function(t){o.running.slice().forEach(e),i=[],n(t).removeClass("paused"),He&&(He[0].style.opacity=""),lt=!1}}}(),yt=function(){var e=null,t=Object.freeze({enter:i,exit:i,pause:i,resume:i,stop:function(){e&&(yt.pop(),bt.resume()),yt.goTo(yt.Stop)},newGame:i});return Object.freeze({Transition:Object.freeze(n.extend({},t,function(){function e(e,t){s.addClass(o),u=setTimeout(e,t),r=Date.now()}function t(){clearTimeout(u),s.removeClass(o)}var o,i,r,a=0,u=-1,s=n("#grid, #tile-container"),c={End:{getEffect:function(){return"shake-hor"},callback:function(){yt.goTo(yt.End)}},Start:{getEffect:function(){return Math.random()<.5?"shake":"shake-rot"},callback:Ne}};return{enter:function(t){var n=c[t];o=n.getEffect(),e(i=n.callback,a=750)},exit:function(){t()},pause:function(){t(),a=Math.max(a-(Date.now()-r),0)},resume:function(){e(i,a)},newGame:function(){Date.now()-r>750&&(clearTimeout(u),e(i,a))}}}())),Tutorial:Object.freeze(n.extend({},t,{enter:function(){u(function(){function e(){yt.goTo(yt.Start)}function t(e,t,o){return function(){n("#tutorial-"+(e-1)).hide(),n("#tutorial-"+e).show(),n("#ok-"+e).off(R).on(R,t),o&&o()}}var o=t(2,e),i=t(1,function(){0===N.loadTotalTimesPlayed()?o():e()},function(){}),r=Ue.find(".tutorial");r.find(".mode").addClass("hide"),r.find(".m"+qe.mode).removeClass("hide"),0===qe.speed?r.find(".speed.classic").removeClass("hide"):r.find(".speed.classic").addClass("hide"),t(0,i,function(){})()})},exit:function(){n(".tutorial").hide(),St.clear("anim2")},pause:function(){St.pause("anim2")},resume:function(){St.resume("anim2")}})),Start:Object.freeze(n.extend({},t,function(){function e(){n=-1,q(),N.incTimesPlayed(qe),yt.goTo(yt.Playing)}function t(){clearTimeout(n)}var n=-1;return{enter:function(t){t?n=setTimeout(e,t):e()},exit:t,pause:t,resume:function(){n=setTimeout(e,_/2)}}}())),Stop:Object.freeze(n.extend({},t)),Playing:Object.freeze(n.extend({},t,{_clear:function(){B.remove(),clearTimeout(ct)},enter:function(){},exit:function(){this._clear(),St.clear("anim")},pause:function(){this._clear(),St.pause("anim"),yt.push(yt.Paused)},resume:function(){St.resume("anim"),lt||(B.add(He,M()),ct=setTimeout(Se))},newGame:function(){this.pause(),yt.goTo(yt.New)}})),Paused:Object.freeze(n.extend({},t,{resume:function(){yt.goTo(yt.Resuming)}})),Loading:Object.freeze(n.extend({},t,{enter:function(){yt.goTo(yt.Playing),bt.pause(),bt.resume()}})),Resuming:Object.freeze(n.extend({},t,function(){function e(){var e=3;!function t(){if(0===e)return yt.pop(),void bt.resume();n("#resume .countdown").text(e--),a=setTimeout(t,r)}(),n("#resume").show()}function t(e,t){return e-Math.floor(e/t)*t}function o(){rt.countdown&&(clearTimeout(a),-1===u?B.remove():(clearTimeout(u),u=-1),n("#resume").hide())}function i(){if(!rt.countdown)return yt.pop(),void bt.resume();e(),lt||(u=setTimeout(function(){B.add(He,M()),u=-1},t(3*r,M())))}var r=800,a=-1,u=-1;return{enter:i,exit:o,pause:o,resume:i,newGame:function(){yt.goTo(yt.New)}}}())),End:Object.freeze(n.extend({},t,{enter:function(e){var t,o=n("#msg-container");st.remove(),B.remove(),(t=n("#game-over > .msg").hide()).eq(Math.floor(Math.random()*t.length)).show(),o.find(".msg").hide(),Qe.prevBest<Qe.best?t=o.find(".high-score"):(t=o.find(".share"),Math.random()<.5&&t.add(o.find(".like"))),t.eq(Math.floor(Math.random()*t.length)).show(),e?n("#end").show():n("#end").fadeIn()},exit:function(){n("#end").hide()},newGame:function(){yt.goTo(yt.Transition,"Start")}})),New:Object.freeze(n.extend({},t,{enter:function(){n("#confirm").show()},exit:function(){n("#confirm").hide()},continue:function(){yt.goTo(yt.Resuming)}})),goTo:function(e,t){bt.exit(),(bt=e).enter(t)},push:function(t,n){e=bt,(bt=t).enter(n)},pop:function(){bt.exit(),bt=e,e=null}})}(),bt=yt.Stop;n(e).resize(throttleHandler(function(){Et!==Mt&&Et!==At||(ye(n("#grid")),Ee(),Y.invalidate(qe.size.rows,qe.size.cols),Ce())}));var Et,zt=function(){function t(t){return e.history?t:i}var n=!1,o=!1;return e.onpopstate=function(e){if(o)o=!1;else{if(n=!0,e.state)switch(e.state.section,e.state.section){case"howto":Et.goToOther("howto");break;case"about":Et.goToOther("about");break;case"game":Et.goToGame();break;case"options":Et.goToOptions();break;default:A("Unknown history state!")}else Et.goToMenu();n=!1}},{push:t(function(e){n||history.pushState({section:e.toLowerCase()},e)}),pop:t(function(){n||(o=!0,history.back())})}}(),Ct=Object.freeze({goToOptions:i,goToMenu:i,goToGame:i,goToOther:i,enter:i,exit:i});n(e).resize(throttleHandler(function(){var e=jQuery(".carousel");Et===Ot&&"#howto"===Ot.selector||e.hasClass("slick-initialized")&&e.slick("unslick")}));var Ot=Object.seal(n.extend({},Ct,{section:"",goToMenu:function(){Ye(xt)},enter:function(e){switch(Ot.section=e,De(Ot.section),zt.push(e),Ot.section){case"howto":u(l)}},exit:function(){je(Ot.section),zt.pop()}})),xt=Object.freeze(n.extend({},Ct,{goToOther:function(e){Ye(Ot,e)},goToGame:function(){Ye(Mt,!0)},enter:function(){De("main-menu")},exit:function(){je("main-menu")}})),Mt=Object.freeze(n.extend({},Ct,{goToMenu:function(){Re(),je("game"),Ye(xt),zt.pop()},goToOptions:function(){Pe(),Ye(At)},enter:function(e){e?(De("game"),Ie()):Ge(),zt.push("Game")},exit:function(){}})),At=Object.freeze(n.extend({},Ct,{goToMenu:function(){Ye(Mt),Mt.goToMenu()},goToGame:function(){Ye(Mt)},enter:function(){De("options"),n("#pause-resume").removeClass("pause").addClass("resume"),zt.push("Options")},exit:function(){rt=N.loadSettings(),zt.pop(),n("#pause-resume").removeClass("resume").addClass("pause"),je("options")}}));Et=xt,n(function(){function e(e,t){var n="selected";return function(o,i){var r=o.find("."+n).removeClass(n)[e]();0===r.length&&(r=o.children()[t]()),rt[i]=r.addClass(n).data("option"),d()}}n(".menu-button").on(R,_e),n("#pause-resume").on(R,Ve),n("#new").on(R,Xe),n("#confirm .no").on(R,function(){bt.continue()}),n("#confirm .yes, #restart").on(R,function(){yt.goTo(yt.Transition,"Start")});var t=e("prev","last"),o=e("next","first");n("#size-left").on(R,function(){t(n("#sizes"),"size")}),n("#size-right").on(R,function(){o(n("#sizes"),"size")}),n("#speed-left").on(R,function(){t(n("#speeds"),"speed")}),n("#speed-right").on(R,function(){o(n("#speeds"),"speed")}),n("#sensitivity").on(R,function(){o(n("#sensitivities"),"sensitivity")})}),n(function(){Et.enter(),n("#other .nav-button").on(R,function(){Et.goToOther(this.name)}),n(".play-button").on(R,function(){var e=n("#sizes > .selected").data("option").split("x"),t=+e[0],o=+e[1];n("#grid, #tile-container").removeClass("col"+qe.size.cols),qe.mode=n(this).data("mode"),qe.speed=n("#speeds > .selected").data("option"),qe.size.rows=t,qe.size.cols=o,qe.mode,qe.speed,Et.goToGame()}),n(e).blur(function(){Et===Mt&&bt!==yt.End&&Et.goToOptions()})})}(e,t,n,o,requestAnimationFrame)}(window,document,Zepto,anime);